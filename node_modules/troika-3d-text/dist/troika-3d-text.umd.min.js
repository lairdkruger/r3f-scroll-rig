'use strict';(function(C,x){"object"===typeof exports&&"undefined"!==typeof module?x(exports,require("three"),require("troika-worker-utils"),require("troika-three-utils"),require("troika-3d")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","troika-three-utils","troika-3d"],x):(C=C||self,x(C.troika_3d_text={},C.THREE,C.troika_worker_utils,C.troika_three_utils,C.troika_3d))})(this,function(C,x,G,ja,T){function ka(k,f){k=la({},k);k.font=Aa(k.font||O.defaultFontURL);
k.text=""+k.text;if(null!=k.colorRanges){var b={},a;for(a in k.colorRanges)if(k.colorRanges.hasOwnProperty(a)){var c=k.colorRanges[a];"number"!==typeof c&&(c=Ba.set(c).getHex());b[a]=c}k.colorRanges=b}Object.freeze(k);var d=O.sdfGlyphSize;b=O.textureWidth;var g=ma[k.font];g||(g=ma[k.font]={sdfTexture:new x.DataTexture(new Uint8Array(d*b),b,d,x.LuminanceFormat,void 0,void 0,void 0,void 0,x.LinearFilter,x.LinearFilter)},g.sdfTexture.font=k.font);Ca(k).then(function(a){a.newGlyphSDFs&&(a.newGlyphSDFs.forEach(function(a){var b=
a.textureData;a=a.atlasIndex;for(var c=g.sdfTexture.image;c.data.length<(a+1)*d*d;){var e=new Uint8Array(2*c.data.length);e.set(c.data);c.data=e;c.height*=2}e=c.width/d;for(var f=0;f<d;f++)for(var h=f*d,p=c.width*d*Math.floor(a/e)+a%e*d+f*c.width,q=0;q<d;q++)c.data[p+q]=b[h+q]}),g.sdfTexture.needsUpdate=!0);f(Object.freeze({parameters:k,sdfTexture:g.sdfTexture,sdfGlyphSize:d,sdfMinDistancePercent:.125,glyphBounds:a.glyphBounds,glyphAtlasIndices:a.glyphAtlasIndices,glyphColors:a.glyphColors,caretPositions:a.caretPositions,
caretHeight:a.caretHeight,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,topBaseline:a.topBaseline,totalBounds:a.totalBounds,totalBlockSize:a.totalBlockSize,timings:a.timings}))})}function la(k,f){for(var b in f)f.hasOwnProperty(b)&&(k[b]=f[b]);return k}function Aa(k){P||(P="undefined"===typeof document?{}:document.createElement("a"));P.href=k;return P.href}function Da(k){var f=na[k];f||(f=na[k]=(new x.PlaneBufferGeometry(1,1,k,k)).translate(.5,.5,
0));return f}function Z(k,f,b,a){var c=k.getAttribute(f);b?c&&c.array.length===b.length?(c.array.set(b),c.needsUpdate=!0):k.setAttribute(f,new x.InstancedBufferAttribute(b,a)):c&&k.deleteAttribute(f)}function oa(k,f){k[k.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=f}function Ea(k){k=ja.createDerivedMaterial(k,{extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new x.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFMinDistancePct:{value:0},
uTroikaTotalBounds:{value:new x.Vector4(0,0,0,0)},uTroikaClipRect:{value:new x.Vector4(0,0,0,0)},uTroikaOrient:{value:new x.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaGlyphColor;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 clippedBounds = vec4(\n  clamp(bounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(bounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\nvTroikaGlyphUV = clippedXY.xy;\n\nfloat cols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvTroikaSDFTextureUV = vec2(\n  mod(aTroikaGlyphIndex, cols) + clippedXY.x,\n  floor(aTroikaGlyphIndex / cols) + clippedXY.y\n) * uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = vec2(\n  (position.x - uTroikaTotalBounds.x) / (uTroikaTotalBounds.z - uTroikaTotalBounds.x),\n  (position.y - uTroikaTotalBounds.y) / (uTroikaTotalBounds.w - uTroikaTotalBounds.y)\n);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform float uTroikaSDFMinDistancePct;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\n\nfloat troikaGetTextAlpha() {\n  float troikaSDFValue = texture2D(uTroikaSDFTexture, vTroikaSDFTextureUV).r;\n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(0.5, troikaSDFValue);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = min(\n    0.5,\n    0.5 * min(\n      fwidth(vTroikaGlyphUV.x),\n      fwidth(vTroikaGlyphUV.y)\n    )\n  ) / uTroikaSDFMinDistancePct;\n  #else\n  float aaDist = 0.01;\n  #endif\n  \n  float alpha = uTroikaSDFDebug ? troikaSDFValue : smoothstep(\n    0.5 - aaDist,\n    0.5 + aaDist,\n    troikaSDFValue\n  );\n  #endif\n  \n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat troikaAlphaMult = troikaGetTextAlpha();\nif (troikaAlphaMult == 0.0) {\n  discard;\n} else {\n  gl_FragColor.a *= troikaAlphaMult;\n}\n",customRewriter:function(f){var b=f.vertexShader;f=f.fragmentShader;var a=/\buniform\s+vec3\s+diffuse\b/;a.test(f)&&(f=f.replace(a,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),a.test(b)||(b=b.replace(ja.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));
return{vertexShader:b,fragmentShader:f}}});k.transparent=!0;Object.defineProperties(k,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}});return k}function aa(k,f,b){var a=null,c=k.caretHeight;k=Fa(k);var d=Infinity;k.forEach(function(a,e){Math.abs(b-(e+c/2))<Math.abs(b-(d+c/2))&&(d=e)});k.get(d).forEach(function(b){if(!a||Math.abs(f-b.x)<Math.abs(f-a.x))a=b});return a}function pa(k,f,b){if(k){var a=qa.get(k);if(a&&a.start===f&&a.end===b)return a.rects;
a=k.caretPositions;var c=k.caretHeight,d=k.totalBounds;if(b<f){var g=f;f=b;b=g}f=Math.max(f,0);b=Math.min(b,a.length+1);g=new Map;for(var e=f;e<b;e++){var h=a[3*e],l=a[3*e+1],m=a[3*e+2],t=g.get(m);t?(t.left=Math.max(Math.min(t.left,h),d[0]),t.right=Math.min(Math.max(t.right,l),d[2])):(t={left:h,right:l,bottom:m,top:m+c},g.set(m,t))}var r=[];g.forEach(function(a){r.push(a)});qa.set(k,{start:f,end:b,rects:r})}return r}function Fa(k){var f=ra.get(k);if(!f){var b=k.caretPositions,a=k.caretHeight;f=new Map;
for(var c=0;c<b.length;c+=3){var d=b[c+2],g=f.get(d);g||f.set(d,g=[]);g.push({x:b[c],y:d,height:a,charIndex:c/3});c+3>=b.length&&g.push({x:b[c+1],y:d,height:a,charIndex:c/3+1})}}ra.set(k,f);return f}function sa(){var k=T.createDerivedMaterial(new x.MeshBasicMaterial({transparent:!0,opacity:.3,depthWrite:!1}),{uniforms:{rect:{value:new x.Vector4}},vertexDefs:"uniform vec4 rect;",vertexTransform:"\n  position.x = position.x < 0.0 ? rect.x : rect.z;\n  position.y = position.y < 0.0 ? rect.w : rect.y;\n  "});
k.instanceUniforms=["rect","diffuse"];var f=new x.Mesh((new x.BoxBufferGeometry).translate(0,0,-.5),k);return(sa=function(){return f})()}var R=G.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){var k=self,f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var g=[],e=0;e<d;e++){var h=a.readUint(b,c);c+=4;g.push(f._readFont(b,h))}return g}return[f._readFont(b,0)]},
_readFont:function(b,a){var c=f._bin,d=a;c.readFixed(b,a);a+=4;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var e="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");d={_data:b,_offset:d};for(var h={},l=0;l<g;l++){var m=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var t=c.readUint(b,a);a+=4;var r=c.readUint(b,a);a+=4;h[m]={offset:t,length:r}}for(l=0;l<e.length;l++)a=e[l],h[a]&&(d[a.trim()]=f[a.trim()].parse(b,
h[a].offset,h[a].length,d));return d},_tabOffset:function(b,a,c){var d=f._bin,g=d.readUshort(b,c+4);c+=12;for(var e=0;e<g;e++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var l=d.readUint(b,c);c+=4;d.readUint(b,c);c+=4;if(h==a)return l}return 0}};f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){var c=f._bin.t.uint8;c[0]=b[a+3];c[1]=b[a+2];c[2]=b[a+1];c[3]=b[a];return f._bin.t.int32[0]},
readInt8:function(b,a){f._bin.t.uint8[0]=b[a];return f._bin.t.int8[0]},readShort:function(b,a){var c=f._bin.t.uint8;c[1]=b[a];c[0]=b[a+1];return f._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=[],g=0;g<c;g++)d.push(f._bin.readUshort(b,a+2*g));return d},readUint:function(b,a){var c=f._bin.t.uint8;c[3]=b[a];c[2]=b[a+1];c[1]=b[a+2];c[0]=b[a+3];return f._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*f._bin.readUint(b,a)+f._bin.readUint(b,
a+4)},readASCII:function(b,a,c){for(var d="",g=0;g<c;g++)d+=String.fromCharCode(b[a+g]);return d},readUnicode:function(b,a,c){for(var d="",g=0;g<c;g++){var e=b[a++]<<8|b[a++];d+=String.fromCharCode(e)}return d},_tdec:k.TextDecoder?new k.TextDecoder:null,readUTF8:function(b,a,c){var d=f._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],g=0;g<c;g++)d.push(b[a+g]);return d},readASCIIArray:function(b,a,c){for(var d=[],g=0;g<c;g++)d.push(String.fromCharCode(b[a+
g]));return d}};f._bin.t={buff:new ArrayBuffer(8)};f._bin.t.int8=new Int8Array(f._bin.t.buff);f._bin.t.uint8=new Uint8Array(f._bin.t.buff);f._bin.t.int16=new Int16Array(f._bin.t.buff);f._bin.t.uint16=new Uint16Array(f._bin.t.buff);f._bin.t.int32=new Int32Array(f._bin.t.buff);f._bin.t.uint32=new Uint32Array(f._bin.t.buff);f._lctf={};f._lctf.parse=function(b,a,c,d,g){var e=f._bin;c={};d=a;e.readFixed(b,a);a+=4;var h=e.readUshort(b,a);a+=2;var l=e.readUshort(b,a);a=e.readUshort(b,a+2);c.scriptList=f._lctf.readScriptList(b,
d+h);c.featureList=f._lctf.readFeatureList(b,d+l);c.lookupList=f._lctf.readLookupList(b,d+a,g);return c};f._lctf.readLookupList=function(b,a,c){var d=f._bin,g=a,e=[],h=d.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var m=d.readUshort(b,a);a+=2;m=f._lctf.readLookupTable(b,g+m,c);e.push(m)}return e};f._lctf.readLookupTable=function(b,a,c){var d=f._bin,g=a,e={tabs:[]};e.ltype=d.readUshort(b,a);a+=2;e.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var m=d.readUshort(b,a);a+=
2;m=c(b,e.ltype,g+m);e.tabs.push(m)}return e};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,a){var c=f._bin,d=[],g=c.readUshort(b,a);a+=2;if(1==g){var e=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++)d.push(e+l),d.push(e+l),d.push(c.readUshort(b,a)),a+=2}if(2==g)for(g=c.readUshort(b,a),a+=2,l=0;l<g;l++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};
f._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c+1];if(b[c]<=a&&a<=d)return c}return-1};f._lctf.readCoverage=function(b,a){var c=f._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;1==d.fmt&&(d.tab=c.readUshorts(b,a,g));2==d.fmt&&(d.tab=c.readUshorts(b,a,3*g));return d};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,
d=a,g=[],e=c.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=c.readASCII(b,a,4);a+=4;var m=c.readUshort(b,a);a+=2;g.push({tag:l.trim(),tab:f._lctf.readFeatureTable(b,d+m)})}return g};f._lctf.readFeatureTable=function(b,a){var c=f._bin;c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;for(var g=[],e=0;e<d;e++)g.push(c.readUshort(b,a+2*e));return g};f._lctf.readScriptList=function(b,a){var c=f._bin,d=a,g={},e=c.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=c.readASCII(b,a,4);a+=4;var m=c.readUshort(b,
a);a+=2;g[l.trim()]=f._lctf.readScriptTable(b,d+m)}return g};f._lctf.readScriptTable=function(b,a){var c=f._bin,d=a,g={},e=c.readUshort(b,a);a+=2;g.default=f._lctf.readLangSysTable(b,d+e);e=c.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=c.readASCII(b,a,4);a+=4;var m=c.readUshort(b,a);a+=2;g[l.trim()]=f._lctf.readLangSysTable(b,d+m)}return g};f._lctf.readLangSysTable=function(b,a){var c=f._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);d.features=c.readUshorts(b,
a+2,g);return d};f.CFF={};f.CFF.parse=function(b,a,c){var d=f._bin;b=new Uint8Array(b.buffer,a,c);a=0;a++;a++;a++;a++;var g=[];a=f.CFF.readIndex(b,a,g);var e=[];for(c=0;c<g.length-1;c++)e.push(d.readASCII(b,a+g[c],g[c+1]-g[c]));a+=g[g.length-1];g=[];a=f.CFF.readIndex(b,a,g);e=[];for(c=0;c<g.length-1;c++)e.push(f.CFF.readDict(b,a+g[c],a+g[c+1]));a+=g[g.length-1];g=e[0];var h=[];a=f.CFF.readIndex(b,a,h);e=[];for(c=0;c<h.length-1;c++)e.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));a+=h[h.length-1];f.CFF.readSubrs(b,
a,g);if(g.CharStrings){a=g.CharStrings;h=[];a=f.CFF.readIndex(b,a,h);var l=[];for(c=0;c<h.length-1;c++)l.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));g.CharStrings=l}if(g.ROS){a=g.FDArray;h=[];a=f.CFF.readIndex(b,a,h);g.FDArray=[];for(c=0;c<h.length-1;c++)l=f.CFF.readDict(b,a+h[c],a+h[c+1]),f.CFF._readFDict(b,l,e),g.FDArray.push(l);a=g.FDSelect;g.FDSelect=[];c=b[a];a++;if(3==c)for(h=d.readUshort(b,a),a+=2,c=0;c<h+1;c++)g.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3;else throw c;}g.Encoding&&(g.Encoding=
f.CFF.readEncoding(b,g.Encoding,g.CharStrings.length));g.charset&&(g.charset=f.CFF.readCharset(b,g.charset,g.CharStrings.length));f.CFF._readFDict(b,g,e);return g};f.CFF._readFDict=function(b,a,c){if(a.Private){var d=a.Private[1];a.Private=f.CFF.readDict(b,d,d+a.Private[0]);a.Private.Subrs&&f.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)}for(var g in a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(g)&&(a[g]=c[a[g]-426+35])};f.CFF.readSubrs=function(b,a,c){var d=f._bin,
g=[];a=f.CFF.readIndex(b,a,g);var e=g.length;c.Bias=1240>e?107:33900>e?1131:32768;c.Subrs=[];for(e=0;e<g.length-1;e++)c.Subrs.push(d.readBytes(b,a+g[e],g[e+1]-g[e]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,
89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};f.CFF.glyphBySE=
function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};f.CFF.readEncoding=function(b,a,c){c=[".notdef"];var d=b[a];a++;if(0==d){d=b[a];a++;for(var g=0;g<d;g++)c.push(b[a+g])}else throw"error: unknown encoding format: "+d;return c};f.CFF.readCharset=function(b,a,c){var d=f._bin,g=[".notdef"],e=b[a];a++;if(0==e)for(var h=0;h<c;h++){var l=d.readUshort(b,a);a+=2;g.push(l)}else if(1==e||2==e)for(;g.length<c;){l=d.readUshort(b,a);a+=2;if(1==e){var m=b[a];a++}else m=d.readUshort(b,
a),a+=2;for(h=0;h<=m;h++)g.push(l),l++}else throw"error: format: "+e;return g};f.CFF.readIndex=function(b,a,c){var d=f._bin,g=d.readUshort(b,a)+1;a+=2;var e=b[a];a++;if(1==e)for(var h=0;h<g;h++)c.push(b[a+h]);else if(2==e)for(h=0;h<g;h++)c.push(d.readUshort(b,a+2*h));else if(3==e)for(h=0;h<g;h++)c.push(d.readUint(b,a+3*h-1)&16777215);else if(1!=g)throw"unsupported offset size: "+e+", count: "+g;return a+g*e-1};f.CFF.getCharString=function(b,a,c){var d=f._bin,g=b[a],e=b[a+1],h=1,l=null,m=null;20>=
g&&(l=g,h=1);12==g&&(l=100*g+e,h=2);21<=g&&27>=g&&(l=g,h=1);28==g&&(m=d.readShort(b,a+1),h=3);29<=g&&31>=g&&(l=g,h=1);32<=g&&246>=g&&(m=g-139,h=1);247<=g&&250>=g&&(m=256*(g-247)+e+108,h=2);251<=g&&254>=g&&(m=256*-(g-251)-e-108,h=2);255==g&&(m=d.readInt(b,a+1)/65535,h=5);c.val=null!=m?m:"o"+l;c.size=h};f.CFF.readCharString=function(b,a,c){c=a+c;for(var d=f._bin,g=[];a<c;){var e=b[a],h=b[a+1],l=1,m=null,t=null;20>=e&&(m=e,l=1);12==e&&(m=100*e+h,l=2);if(19==e||20==e)m=e,l=2;21<=e&&27>=e&&(m=e,l=1);28==
e&&(t=d.readShort(b,a+1),l=3);29<=e&&31>=e&&(m=e,l=1);32<=e&&246>=e&&(t=e-139,l=1);247<=e&&250>=e&&(t=256*(e-247)+h+108,l=2);251<=e&&254>=e&&(t=256*-(e-251)-h-108,l=2);255==e&&(t=d.readInt(b,a+1)/65535,l=5);g.push(null!=t?t:"o"+m);a+=l}return g};f.CFF.readDict=function(b,a,c){for(var d=f._bin,g={},e=[];a<c;){var h=b[a],l=b[a+1],m=1,t=null,r=null;28==h&&(r=d.readShort(b,a+1),m=3);29==h&&(r=d.readInt(b,a+1),m=5);32<=h&&246>=h&&(r=h-139,m=1);247<=h&&250>=h&&(r=256*(h-247)+l+108,m=2);251<=h&&254>=h&&
(r=256*-(h-251)-l-108,m=2);if(255==h)throw d.readInt(b,a+1),"unknown number";if(30==h){r=[];for(m=1;;){var n=b[a+m];m++;var p=n>>4;n&=15;15!=p&&r.push(p);15!=n&&r.push(n);if(15==n)break}p="";n=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var q=0;q<r.length;q++)p+=n[r[q]];r=parseFloat(p)}21>=h&&(m="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" "),
t=m[h],m=1,12==h&&(m=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"],t=m[l],m=2));null!=t?(g[t]=1==e.length?
e[0]:e,e=[]):e.push(r);a+=m}return g};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var d={};c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;var e=[];d.tables=[];for(var h=0;h<g;h++){var l=c.readUshort(b,a);a+=2;var m=c.readUshort(b,a);a+=2;var t=c.readUint(b,a);a+=4;var r="p"+l+"e"+m,n=e.indexOf(t);if(-1==n){n=d.tables.length;var p;e.push(t);var q=c.readUshort(b,t);0==q?p=f.cmap.parse0(b,t):4==q?p=f.cmap.parse4(b,t):6==q?p=f.cmap.parse6(b,t):12==q?p=f.cmap.parse12(b,
t):console.log("unknown format: "+q,l,m,t);d.tables.push(p)}if(null!=d[r])throw"multiple tables for one platform+encoding";d[r]=n}return d};f.cmap.parse0=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<g-6;c++)d.map.push(b[a+c]);return d};f.cmap.parse4=function(b,a){var c=f._bin,d=a,g={};g.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;g.searchRange=
c.readUshort(b,a);a+=2;g.entrySelector=c.readUshort(b,a);a+=2;g.rangeShift=c.readUshort(b,a);a+=2;g.endCount=c.readUshorts(b,a,h);a=a+2*h+2;g.startCount=c.readUshorts(b,a,h);a+=2*h;g.idDelta=[];for(var l=0;l<h;l++)g.idDelta.push(c.readShort(b,a)),a+=2;g.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(g.glyphIdArray=[];a<d+e;)g.glyphIdArray.push(c.readUshort(b,a)),a+=2;return g};f.cmap.parse6=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var e=0;e<g;e++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};f.cmap.parse12=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var g=c.readUint(b,a);a+=4;d.groups=[];for(var e=0;e<g;e++){var h=a+12*e,l=c.readUint(b,h+0),m=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([l,m,h])}return d};f.glyf={};f.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};f.glyf._parseGlyf=function(b,a){var c=f._bin,d=b._data,g=f._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};b.noc=c.readShort(d,g);g+=2;b.xMin=c.readShort(d,g);g+=2;b.yMin=c.readShort(d,g);g+=2;b.xMax=c.readShort(d,g);g+=2;b.yMax=c.readShort(d,g);g+=2;if(b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,g)),g+=2;a=c.readUshort(d,g);g+=2;if(d.length-g<a)return null;
b.instructions=c.readBytes(d,g,a);g+=a;var e=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<e;a++){var h=d[g];g++;b.flags.push(h);if(0!=(h&8)){var l=d[g];g++;for(var m=0;m<l;m++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<e;a++)h=0!=(b.flags[a]&2),l=0!=(b.flags[a]&16),h?(b.xs.push(l?d[g]:-d[g]),g++):l?b.xs.push(0):(b.xs.push(c.readShort(d,g)),g+=2);b.ys=[];for(a=0;a<e;a++)h=0!=(b.flags[a]&4),l=0!=(b.flags[a]&32),h?(b.ys.push(l?d[g]:-d[g]),g++):l?b.ys.push(0):(b.ys.push(c.readShort(d,g)),g+=2);for(a=g=d=0;a<
e;a++)d+=b.xs[a],g+=b.ys[a],b.xs[a]=d,b.ys[a]=g}else{b.parts=[];do a=c.readUshort(d,g),g+=2,e={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},b.parts.push(e),e.glyphIndex=c.readUshort(d,g),g+=2,a&1?(h=c.readShort(d,g),g+=2,l=c.readShort(d,g),g+=2):(h=c.readInt8(d,g),g++,l=c.readInt8(d,g),g++),a&2?(e.m.tx=h,e.m.ty=l):(e.p1=h,e.p2=l),a&8?(e.m.a=e.m.d=c.readF2dot14(d,g),g+=2):a&64?(e.m.a=c.readF2dot14(d,g),g+=2,e.m.d=c.readF2dot14(d,g),g+=2):a&128&&(e.m.a=c.readF2dot14(d,g),g+=2,e.m.b=c.readF2dot14(d,g),
g+=2,e.m.c=c.readF2dot14(d,g),g+=2,e.m.d=c.readF2dot14(d,g),g+=2);while(a&32);if(a&256)for(c=c.readUshort(d,g),g+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[g]),g++}return b};f.GPOS={};f.GPOS.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GPOS.subt)};f.GPOS.subt=function(b,a,c){var d=f._bin,g=c,e={};e.fmt=d.readUshort(b,c);c+=2;if(1==a||2==a||3==a||7==a||8==a&&2>=e.fmt){var h=d.readUshort(b,c);c+=2;e.coverage=f._lctf.readCoverage(b,h+g)}if(1==a&&1==e.fmt){var l=d.readUshort(b,c);c+=2;f._lctf.numOfOnes(l);
0!=l&&(e.pos=f.GPOS.readValueRecord(b,c,l))}else if(2==a){l=d.readUshort(b,c);c+=2;var m=d.readUshort(b,c);c+=2;a=f._lctf.numOfOnes(l);h=f._lctf.numOfOnes(m);if(1==e.fmt){e.pairsets=[];var t=d.readUshort(b,c);c+=2;for(var r=0;r<t;r++){var n=g+d.readUshort(b,c);c+=2;var p=d.readUshort(b,n);n+=2;for(var q=[],k=0;k<p;k++){var u=d.readUshort(b,n);n+=2;if(0!=l){var v=f.GPOS.readValueRecord(b,n,l);n+=2*a}if(0!=m){var y=f.GPOS.readValueRecord(b,n,m);n+=2*h}q.push({gid2:u,val1:v,val2:y})}e.pairsets.push(q)}}if(2==
e.fmt)for(v=d.readUshort(b,c),c+=2,y=d.readUshort(b,c),c+=2,l=d.readUshort(b,c),c+=2,d=d.readUshort(b,c),c+=2,e.classDef1=f._lctf.readClassDef(b,g+v),e.classDef2=f._lctf.readClassDef(b,g+y),e.matrix=[],r=0;r<l;r++){g=[];for(k=0;k<d;k++)y=v=null,0!=e.valFmt1&&(v=f.GPOS.readValueRecord(b,c,e.valFmt1),c+=2*a),0!=e.valFmt2&&(y=f.GPOS.readValueRecord(b,c,e.valFmt2),c+=2*h),g.push({val1:v,val2:y});e.matrix.push(g)}}return e};f.GPOS.readValueRecord=function(b,a,c){var d=f._bin,g=[];g.push(c&1?d.readShort(b,
a):0);a+=c&1?2:0;g.push(c&2?d.readShort(b,a):0);a+=c&2?2:0;g.push(c&4?d.readShort(b,a):0);g.push(c&8?d.readShort(b,a+(c&4?2:0)):0);return g};f.GSUB={};f.GSUB.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GSUB.subt)};f.GSUB.subt=function(b,a,c){var d=f._bin,g=c,e={};e.fmt=d.readUshort(b,c);c+=2;if(1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=e.fmt||6==a&&2>=e.fmt){var h=d.readUshort(b,c);c+=2;e.coverage=f._lctf.readCoverage(b,g+h)}if(1==a)1==e.fmt?e.delta=d.readShort(b,c):2==
e.fmt&&(h=d.readUshort(b,c),e.newg=d.readUshorts(b,c+2,h));else if(4==a)for(e.vals=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++){var l=d.readUshort(b,c);c+=2;e.vals.push(f.GSUB.readLigatureSet(b,g+l))}else if(5==a){if(2==e.fmt)for(a=d.readUshort(b,c),c+=2,e.cDef=f._lctf.readClassDef(b,g+a),e.scset=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++)l=d.readUshort(b,c),c+=2,e.scset.push(0==l?null:f.GSUB.readSubClassSet(b,g+l))}else if(6==a&&3==e.fmt){for(a=0;3>a;a++){h=d.readUshort(b,c);c+=2;l=[];for(var m=0;m<h;m++)l.push(f._lctf.readCoverage(b,
g+d.readUshort(b,c+2*m)));c+=2*h;0==a&&(e.backCvg=l);1==a&&(e.inptCvg=l);2==a&&(e.ahedCvg=l)}h=d.readUshort(b,c);e.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,h)}return e};f.GSUB.readSubClassSet=function(b,a){var c=f._bin.readUshort,d=a,g=[],e=c(b,a);a+=2;for(var h=0;h<e;h++){var l=c(b,a);a+=2;g.push(f.GSUB.readSubClassRule(b,d+l))}return g};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,d={},g=c(b,a);a+=2;var e=c(b,a);a+=2;d.input=[];for(var h=0;h<g-1;h++)d.input.push(c(b,a)),a+=
2;d.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,e);return d};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=f._bin.readUshort,g=[],e=0;e<c;e++)g.push(d(b,a),d(b,a+2)),a+=4;return g};f.GSUB.readChainSubClassSet=function(b,a){var c=f._bin,d=a,g=[],e=c.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=c.readUshort(b,a);a+=2;g.push(f.GSUB.readChainSubClassRule(b,d+l))}return g};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,d={},g=["backtrack","input","lookahead"],e=0;e<g.length;e++){var h=
c.readUshort(b,a);a+=2;1==e&&h--;d[g[e]]=c.readUshorts(b,a,h);a+=2*d[g[e]].length}h=c.readUshort(b,a);d.subst=c.readUshorts(b,a+2,2*h);return d};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,d=a,g=[],e=c.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=c.readUshort(b,a);a+=2;g.push(f.GSUB.readLigature(b,d+l))}return g};f.GSUB.readLigature=function(b,a){var c=f._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;for(var e=0;e<g-1;e++)d.chain.push(c.readUshort(b,a)),a+=
2;return d};f.head={};f.head.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);a+=4;d.fontRevision=c.readFixed(b,a);a+=4;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;d.flags=c.readUshort(b,a);a+=2;d.unitsPerEm=c.readUshort(b,a);a+=2;d.created=c.readUint64(b,a);a+=8;d.modified=c.readUint64(b,a);a+=8;d.xMin=c.readShort(b,a);a+=2;d.yMin=c.readShort(b,a);a+=2;d.xMax=c.readShort(b,a);a+=2;d.yMax=c.readShort(b,a);a+=2;d.macStyle=c.readUshort(b,a);a+=2;d.lowestRecPPEM=c.readUshort(b,a);a+=2;d.fontDirectionHint=
c.readShort(b,a);a+=2;d.indexToLocFormat=c.readShort(b,a);d.glyphDataFormat=c.readShort(b,a+2);return d};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);a+=4;d.ascender=c.readShort(b,a);a+=2;d.descender=c.readShort(b,a);a+=2;d.lineGap=c.readShort(b,a);a+=2;d.advanceWidthMax=c.readUshort(b,a);a+=2;d.minLeftSideBearing=c.readShort(b,a);a+=2;d.minRightSideBearing=c.readShort(b,a);a+=2;d.xMaxExtent=c.readShort(b,a);a+=2;d.caretSlopeRise=c.readShort(b,a);a+=2;d.caretSlopeRun=
c.readShort(b,a);a+=2;d.caretOffset=c.readShort(b,a);a=a+2+8;d.metricDataFormat=c.readShort(b,a);d.numberOfHMetrics=c.readUshort(b,a+2);return d};f.hmtx={};f.hmtx.parse=function(b,a,c,d){c=f._bin;for(var g={aWidth:[],lsBearing:[]},e=0,h=0,l=0;l<d.maxp.numGlyphs;l++)l<d.hhea.numberOfHMetrics&&(e=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),g.aWidth.push(e),g.lsBearing.push(h);return g};f.kern={};f.kern.parse=function(b,a,c,d){var g=f._bin,e=g.readUshort(b,a);a+=2;if(1==e)return f.kern.parseV1(b,
a-2,c,d);c=g.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(e=0;e<c;e++){a+=2;g.readUshort(b,a);a+=2;var h=g.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=f.kern.readFormat0(b,a,d);else throw"unknown kern table format: "+h;}return d};f.kern.parseV1=function(b,a,c,d){c=f._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var g={glyph1:[],rval:[]},e=0;e<d;e++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=f.kern.readFormat0(b,a,g);else throw"unknown kern table format: "+
h;}return g};f.kern.readFormat0=function(b,a,c){var d=f._bin,g=-1,e=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<e;h++){var l=d.readUshort(b,a);a+=2;var m=d.readUshort(b,a);a+=2;var t=d.readShort(b,a);a+=2;l!=g&&(c.glyph1.push(l),c.rval.push({glyph2:[],vals:[]}));g=c.rval[c.rval.length-1];g.glyph2.push(m);g.vals.push(t);g=l}return a};f.loca={};f.loca.parse=function(b,a,c,d){c=f._bin;var g=[],e=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==e)for(var h=0;h<d;h++)g.push(c.readUshort(b,a+(h<<1))<<1);if(1==e)for(h=0;h<d;h++)g.push(c.readUint(b,a+(h<<2)));return g};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var d={},g=c.readUint(b,a);a+=4;d.numGlyphs=c.readUshort(b,a);a+=2;65536==g&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=2,d.maxStorage=
c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),d.maxComponentDepth=c.readUshort(b,a+2));return d};f.name={};f.name.parse=function(b,a,c){c=f._bin;var d={};c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;for(var e="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
h=a,l=0;l<g;l++){var m=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;n=e[n];q=h+12*g+q;if(0==m)p=c.readUnicode(b,q,p/2);else if(3==m&&0==t)p=c.readUnicode(b,q,p/2);else if(0==t)p=c.readASCII(b,q,p);else if(1==t)p=c.readUnicode(b,q,p/2);else if(3==t)p=c.readUnicode(b,q,p/2);else if(1==m)p=c.readASCII(b,q,p),console.log("reading unknown MAC encoding "+t+" as ASCII");else throw"unknown encoding "+
t+", platformID: "+m;m="p"+m+","+r.toString(16);null==d[m]&&(d[m]={});d[m][n]=p;d[m]._lang=r}for(var k in d)if(null!=d[k].postScriptName&&1033==d[k]._lang)return d[k];for(k in d)if(null!=d[k].postScriptName&&0==d[k]._lang)return d[k];for(k in d)if(null!=d[k].postScriptName&&3084==d[k]._lang)return d[k];for(k in d)if(null!=d[k].postScriptName)return d[k];for(k in d){var u=k;break}console.log("returning name table with languageID "+d[u]._lang);return d[u]};f["OS/2"]={};f["OS/2"].parse=function(b,a,
c){c=f._bin.readUshort(b,a);a+=2;var d={};if(0==c)f["OS/2"].version0(b,a,d);else if(1==c)f["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,d);else if(5==c)f["OS/2"].version5(b,a,d);else throw"unknown OS/2 table version: "+c;return d};f["OS/2"].version0=function(b,a,c){var d=f._bin;c.xAvgCharWidth=d.readShort(b,a);a+=2;c.usWeightClass=d.readUshort(b,a);a+=2;c.usWidthClass=d.readUshort(b,a);a+=2;c.fsType=d.readUshort(b,a);a+=2;c.ySubscriptXSize=d.readShort(b,a);a+=2;c.ySubscriptYSize=
d.readShort(b,a);a+=2;c.ySubscriptXOffset=d.readShort(b,a);a+=2;c.ySubscriptYOffset=d.readShort(b,a);a+=2;c.ySuperscriptXSize=d.readShort(b,a);a+=2;c.ySuperscriptYSize=d.readShort(b,a);a+=2;c.ySuperscriptXOffset=d.readShort(b,a);a+=2;c.ySuperscriptYOffset=d.readShort(b,a);a+=2;c.yStrikeoutSize=d.readShort(b,a);a+=2;c.yStrikeoutPosition=d.readShort(b,a);a+=2;c.sFamilyClass=d.readShort(b,a);a+=2;c.panose=d.readBytes(b,a,10);a+=10;c.ulUnicodeRange1=d.readUint(b,a);a+=4;c.ulUnicodeRange2=d.readUint(b,
a);a+=4;c.ulUnicodeRange3=d.readUint(b,a);a+=4;c.ulUnicodeRange4=d.readUint(b,a);a+=4;c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)];a+=4;c.fsSelection=d.readUshort(b,a);a+=2;c.usFirstCharIndex=d.readUshort(b,a);a+=2;c.usLastCharIndex=d.readUshort(b,a);a+=2;c.sTypoAscender=d.readShort(b,a);a+=2;c.sTypoDescender=d.readShort(b,a);a+=2;c.sTypoLineGap=d.readShort(b,a);a+=2;c.usWinAscent=d.readUshort(b,a);a+=2;c.usWinDescent=d.readUshort(b,a);return a+2};f["OS/2"].version1=
function(b,a,c){var d=f._bin;a=f["OS/2"].version0(b,a,c);c.ulCodePageRange1=d.readUint(b,a);a+=4;c.ulCodePageRange2=d.readUint(b,a);return a+4};f["OS/2"].version2=function(b,a,c){var d=f._bin;a=f["OS/2"].version1(b,a,c);c.sxHeight=d.readShort(b,a);a+=2;c.sCapHeight=d.readShort(b,a);a+=2;c.usDefault=d.readUshort(b,a);a+=2;c.usBreak=d.readUshort(b,a);a+=2;c.usMaxContext=d.readUshort(b,a);return a+2};f["OS/2"].version5=function(b,a,c){var d=f._bin;a=f["OS/2"].version2(b,a,c);c.usLowerOpticalPointSize=
d.readUshort(b,a);a+=2;c.usUpperOpticalPointSize=d.readUshort(b,a);return a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var d={};d.version=c.readFixed(b,a);a+=4;d.italicAngle=c.readFixed(b,a);a+=4;d.underlinePosition=c.readShort(b,a);d.underlineThickness=c.readShort(b,a+2);return d};f.SVG={};f.SVG.parse=function(b,a,c){c=f._bin;var d={entries:[]},g=a;c.readUshort(b,a);a+=2;var e=c.readUint(b,a);c.readUint(b,a+4);a=e+g;var h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var m=c.readUshort(b,a);
a+=2;var k=c.readUshort(b,a);a+=2;var r=c.readUint(b,a);a+=4;var n=c.readUint(b,a);a+=4;r=new Uint8Array(b.buffer,g+r+e,n);for(r=c.readUTF8(r,0,r.length);m<=k;m++)d.entries[m]=r}return d};f.SVG.toPath=function(b){var a={cmds:[],crds:[]};if(null==b)return a;for(var c=(new DOMParser).parseFromString(b,"image/svg+xml").firstChild;"svg"!=c.tagName;)c=c.nextSibling;b=(b=c.getAttribute("viewBox"))?b.trim().split(" ").map(parseFloat):[0,0,1E3,1E3];f.SVG._toPath(c.children,a);for(c=0;c<a.crds.length;c+=2){var d=
a.crds[c],g=a.crds[c+1];d-=b[0];g-=b[1];g=-g;a.crds[c]=d;a.crds[c+1]=g}return a};f.SVG._toPath=function(b,a,c){for(var d=0;d<b.length;d++){var g=b[d],e=g.tagName,h=g.getAttribute("fill");null==h&&(h=c);"g"==e?f.SVG._toPath(g.children,a,h):"path"==e?(a.cmds.push(h?h:"#000000"),g=g.getAttribute("d"),g=f.SVG._tokens(g),f.SVG._toksToPath(g,a),a.cmds.push("X")):"defs"!=e&&console.log(e,g)}};f.SVG._tokens=function(b){for(var a=[],c=0,d=!1,g="";c<b.length;){var e=b.charCodeAt(c),f=b.charAt(c);c++;e=48<=
e&&57>=e||"."==f||"-"==f;d?"-"==f?(a.push(parseFloat(g)),g=f):e?g+=f:(a.push(parseFloat(g)),","!=f&&" "!=f&&a.push(f),d=!1):e?(g=f,d=!0):","!=f&&" "!=f&&a.push(f)}d&&a.push(parseFloat(g));return a};f.SVG._toksToPath=function(b,a){var c=0,d=0,g=0,e=0,h=0,l={M:2,L:2,H:1,V:1,S:4,C:6},m=a.cmds;for(a=a.crds;c<b.length;){var k=b[c];c++;if("z"==k)m.push("Z"),d=e,g=h;else for(var r=k.toUpperCase(),n=f.SVG._reps(b,c,l[r]),p=0;p<n;p++){var q=0,w=0;k!=r&&(q=d,w=g);if("M"==r)d=q+b[c++],g=w+b[c++],m.push("M"),
a.push(d,g),e=d,h=g;else if("L"==r)d=q+b[c++],g=w+b[c++],m.push("L"),a.push(d,g);else if("H"==r)d=q+b[c++],m.push("L"),a.push(d,g);else if("V"==r)g=w+b[c++],m.push("L"),a.push(d,g);else if("C"==r){d=q+b[c++];g=w+b[c++];var u=q+b[c++],v=w+b[c++];q+=b[c++];w+=b[c++];m.push("C");a.push(d,g,u,v,q,w);d=q;g=w}else"S"==r?(u=Math.max(a.length-4,0),d=d+d-a[u],g=g+g-a[u+1],u=q+b[c++],v=w+b[c++],q+=b[c++],w+=b[c++],m.push("C"),a.push(d,g,u,v,q,w),d=q,g=w):console.log("Unknown SVG command "+k)}}};f.SVG._reps=
function(b,a,c){for(var d=a;d<b.length&&"string"!=typeof b[d];)d+=c;return(d-a)/c};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3);if(-1==c)throw"no familiar platform and encoding!";b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:(0!=b.idRangeOffset[d]?
b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])&65535}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];if(null==d)return c;"string"==typeof d&&(d=f.SVG.toPath(d),b.SVG.entries[a]=d);return d}if(b.CFF){d=
{x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var g=b.CFF,e=b.CFF.Private;if(g.ROS){for(e=0;g.FDSelect[e+2]<=a;)e+=2;e=g.FDArray[g.FDSelect[e+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],d,g,e,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};f.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?f.U._simpleGlyph(d,c):f.U._compoGlyph(d,a,c))};f.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=
0==c?0:b.endPts[c-1]+1,g=b.endPts[c],e=d;e<=g;e++){var h=e==d?g:e-1,l=e==g?d:e+1,m=b.flags[e]&1,k=b.flags[h]&1,r=b.flags[l]&1,n=b.xs[e],p=b.ys[e];if(e==d)if(m)if(k)f.U.P.moveTo(a,b.xs[h],b.ys[h]);else{f.U.P.moveTo(a,n,p);continue}else k?f.U.P.moveTo(a,b.xs[h],b.ys[h]):f.U.P.moveTo(a,(b.xs[h]+n)/2,(b.ys[h]+p)/2);m?k&&f.U.P.lineTo(a,n,p):r?f.U.P.qcurveTo(a,n,p,b.xs[l],b.ys[l]):f.U.P.qcurveTo(a,n,p,(n+b.xs[l])/2,(p+b.ys[l])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var g=
{cmds:[],crds:[]},e=b.parts[d];f.U._drawGlyf(e.glyphIndex,a,g);e=e.m;for(var h=0;h<g.crds.length;h+=2){var l=g.crds[h],m=g.crds[h+1];c.crds.push(l*e.a+m*e.b+e.tx);c.crds.push(l*e.c+m*e.d+e.ty)}for(h=0;h<g.cmds.length;h++)c.cmds.push(g.cmds[h])}};f.U._getGlyphClass=function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U.getPairAdjustment=function(b,a,c){if(b.GPOS){var d=b.GPOS,g=d.lookupList;d=d.featureList;for(var e=[],h=0;h<d.length;h++){var l=d[h];if("kern"==l.tag)for(var m=0;m<l.tab.length;m++)if(!e[l.tab[m]]){e[l.tab[m]]=
!0;for(var k=g[l.tab[m]],r=0;r<k.tabs.length;r++)if(null!=k.tabs[h]){var n=k.tabs[r];if(n.coverage){var p=f._lctf.coverageIndex(n.coverage,a);if(-1==p)continue}if(1!=k.ltype&&2==k.ltype){var q;if(1==n.fmt)for(n=n.pairsets[p],h=0;h<n.length;h++)n[h].gid2==c&&(q=n[h]);else if(2==n.fmt){q=f.U._getGlyphClass(a,n.classDef1);var w=f.U._getGlyphClass(c,n.classDef2);q=n.matrix[q][w]}if(q&&q.val2)return q.val2[2]}}}}}return b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=
c))?b.kern.rval[a].vals[c]:0};f.U.stringToGlyphs=function(b,a){for(var c=[],d=0;d<a.length;d++){var g=a.codePointAt(d);65535<g&&d++;c.push(f.U.codeToGlyph(b,g))}for(d=0;d<a.length;d++){g=a.codePointAt(d);if(2367==g){var e=c[d-1];c[d-1]=c[d];c[d]=e}65535<g&&d++}d=b.GSUB;if(null==d)return c;b=d.lookupList;d=d.featureList;g="rlig liga mset isol init fina medi half pres blws".split(" ");e=[];for(var h=0;h<d.length;h++){var l=d[h];if(-1!=g.indexOf(l.tag))for(var m=0;m<l.tab.length;m++)if(!e[l.tab[m]]){e[l.tab[m]]=
!0;for(var k=b[l.tab[m]],r=0;r<c.length;r++){var n=f.U._getWPfeature(a,r);-1!="isol,init,fina,medi".indexOf(l.tag)&&l.tag!=n||f.U._applySubs(c,r,k,b)}}}return c};f.U._getWPfeature=function(b,a){var c=0==a||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a-1]),d=a==b.length-1||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a+1]);c||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a-
1])||(c=!0);d||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a])||
(d=!0);d||-1=="\ua872\u0acd\u0ad7".indexOf(b[a+1])||(d=!0);c||-1=="\ua872\u0acd\u0ad7".indexOf(b[a])||(c=!0);return c?d?"isol":"init":d?"fina":"medi"};f.U._applySubs=function(b,a,c,d){for(var g=b.length-a-1,e=0;e<c.tabs.length;e++)if(null!=c.tabs[e]){var h=c.tabs[e];if(h.coverage){var l=f._lctf.coverageIndex(h.coverage,b[a]);if(-1==l)continue}if(1==c.ltype)b[a]=1==h.fmt?b[a]+h.delta:h.newg[l];else if(4==c.ltype)for(var m=h.vals[l],k=0;k<m.length;k++){var r=m[k];h=r.chain.length;if(!(h>g)){for(var n=
!0,p=0,q=0;q<h;q++){for(;-1==b[a+p+(1+q)];)p++;r.chain[q]!=b[a+p+(1+q)]&&(n=!1)}if(n){b[a]=r.nglyph;for(q=0;q<h+p;q++)b[a+q+1]=-1;break}}}else if(5==c.ltype&&2==h.fmt)for(m=f._lctf.getInterval(h.cDef,b[a]),p=h.scset[h.cDef[m+2]],r=0;r<p.length;r++){k=p[r];var w=k.input;if(!(w.length>g)){n=!0;for(q=0;q<w.length;q++){var u=f._lctf.getInterval(h.cDef,b[a+1+q]);if(-1==m&&h.cDef[u+2]!=w[q]){n=!1;break}}if(n)for(n=k.substLookupRecords,k=0;k<n.length;k+=2);}}else if(6==c.ltype&&3==h.fmt&&f.U._glsCovered(b,
h.backCvg,a-h.backCvg.length)&&f.U._glsCovered(b,h.inptCvg,a)&&f.U._glsCovered(b,h.ahedCvg,a+h.inptCvg.length))for(n=h.lookupRec,r=0;r<n.length;r+=2)m=n[r],f.U._applySubs(b,a+m,d[n[r+1]],d)}};f.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==f._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};f.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},g=0,e=0;e<a.length;e++){var h=a[e];if(-1!=h){for(var l=e<a.length-1&&-1!=a[e+1]?a[e+1]:0,m=f.U.glyphToPath(b,h),k=0;k<m.crds.length;k+=
2)d.crds.push(m.crds[k]+g),d.crds.push(m.crds[k+1]);c&&d.cmds.push(c);for(k=0;k<m.cmds.length;k++)d.cmds.push(m.cmds[k]);c&&d.cmds.push("X");g+=b.hmtx.aWidth[h];e<a.length-1&&(g+=f.U.getPairAdjustment(b,h,l))}}return d};f.U.pathToSVG=function(b,a){null==a&&(a=5);for(var c=[],d=0,g={M:2,L:2,Q:4,C:6},e=0;e<b.cmds.length;e++){var f=b.cmds[e],l=d+(g[f]?g[f]:0);for(c.push(f);d<l;)f=b.crds[d++],c.push(parseFloat(f.toFixed(a))+(d==l?"":" "))}return c.join("")};f.U.pathToContext=function(b,a){for(var c=0,
d=b.crds,g=0;g<b.cmds.length;g++){var e=b.cmds[g];"M"==e?(a.moveTo(d[c],d[c+1]),c+=2):"L"==e?(a.lineTo(d[c],d[c+1]),c+=2):"C"==e?(a.bezierCurveTo(d[c],d[c+1],d[c+2],d[c+3],d[c+4],d[c+5]),c+=6):"Q"==e?(a.quadraticCurveTo(d[c],d[c+1],d[c+2],d[c+3]),c+=4):"#"==e.charAt(0)?(a.beginPath(),a.fillStyle=e):"Z"==e?a.closePath():"X"==e&&a.fill()}};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};f.U.P.curveTo=function(b,
a,c,d,g,e,f){b.cmds.push("C");b.crds.push(a,c,d,g,e,f)};f.U.P.qcurveTo=function(b,a,c,d,g){b.cmds.push("Q");b.crds.push(a,c,d,g)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,d,g){for(var e=a.stack,h=a.nStems,l=a.haveWidth,k=a.width,t=a.open,r=0,n=a.x,p=a.y,q,w,u,v,y,A,E,F,D,B,x={val:0,size:0};r<b.length;){f.CFF.getCharString(b,r,x);var z=x.val;r+=x.size;if("o1"==z||"o18"==z)(q=0!==e.length%2)&&!l&&(k=e.shift()+d.nominalWidthX),h+=e.length>>1,e.length=0,l=!0;else if("o3"==
z||"o23"==z)(q=0!==e.length%2)&&!l&&(k=e.shift()+d.nominalWidthX),h+=e.length>>1,e.length=0,l=!0;else if("o4"==z)1<e.length&&!l&&(k=e.shift()+d.nominalWidthX,l=!0),t&&f.U.P.closePath(g),p+=e.pop(),f.U.P.moveTo(g,n,p),t=!0;else if("o5"==z)for(;0<e.length;)n+=e.shift(),p+=e.shift(),f.U.P.lineTo(g,n,p);else if("o6"==z||"o7"==z)for(y=e.length,q="o6"==z,w=0;w<y;w++)u=e.shift(),q?n+=u:p+=u,q=!q,f.U.P.lineTo(g,n,p);else if("o8"==z||"o24"==z){y=e.length;for(A=0;A+6<=y;)q=n+e.shift(),w=p+e.shift(),u=q+e.shift(),
v=w+e.shift(),n=u+e.shift(),p=v+e.shift(),f.U.P.curveTo(g,q,w,u,v,n,p),A+=6;"o24"==z&&(n+=e.shift(),p+=e.shift(),f.U.P.lineTo(g,n,p))}else if("o11"==z)break;else if("o1234"==z||"o1235"==z||"o1236"==z||"o1237"==z)"o1234"==z&&(q=n+e.shift(),w=p,u=q+e.shift(),v=w+e.shift(),D=u+e.shift(),B=v,y=D+e.shift(),A=v,E=y+e.shift(),F=p,n=E+e.shift(),f.U.P.curveTo(g,q,w,u,v,D,B),f.U.P.curveTo(g,y,A,E,F,n,p)),"o1235"==z&&(q=n+e.shift(),w=p+e.shift(),u=q+e.shift(),v=w+e.shift(),D=u+e.shift(),B=v+e.shift(),y=D+e.shift(),
A=B+e.shift(),E=y+e.shift(),F=A+e.shift(),n=E+e.shift(),p=F+e.shift(),e.shift(),f.U.P.curveTo(g,q,w,u,v,D,B),f.U.P.curveTo(g,y,A,E,F,n,p)),"o1236"==z&&(q=n+e.shift(),w=p+e.shift(),u=q+e.shift(),v=w+e.shift(),D=u+e.shift(),B=v,y=D+e.shift(),A=v,E=y+e.shift(),F=A+e.shift(),n=E+e.shift(),f.U.P.curveTo(g,q,w,u,v,D,B),f.U.P.curveTo(g,y,A,E,F,n,p)),"o1237"==z&&(q=n+e.shift(),w=p+e.shift(),u=q+e.shift(),v=w+e.shift(),D=u+e.shift(),B=v+e.shift(),y=D+e.shift(),A=B+e.shift(),E=y+e.shift(),F=A+e.shift(),Math.abs(E-
n)>Math.abs(F-p)?n=E+e.shift():p=F+e.shift(),f.U.P.curveTo(g,q,w,u,v,D,B),f.U.P.curveTo(g,y,A,E,F,n,p));else if("o14"==z)0<e.length&&!l&&(k=e.shift()+c.nominalWidthX,l=!0),4==e.length&&(q=e.shift(),w=e.shift(),v=e.shift(),u=e.shift(),v=f.CFF.glyphBySE(c,v),u=f.CFF.glyphBySE(c,u),f.U._drawCFF(c.CharStrings[v],a,c,d,g),a.x=q,a.y=w,f.U._drawCFF(c.CharStrings[u],a,c,d,g)),t&&(f.U.P.closePath(g),t=!1);else if("o19"==z||"o20"==z)(q=0!==e.length%2)&&!l&&(k=e.shift()+d.nominalWidthX),h+=e.length>>1,e.length=
0,l=!0,r+=h+7>>3;else if("o21"==z)2<e.length&&!l&&(k=e.shift()+d.nominalWidthX,l=!0),p+=e.pop(),n+=e.pop(),t&&f.U.P.closePath(g),f.U.P.moveTo(g,n,p),t=!0;else if("o22"==z)1<e.length&&!l&&(k=e.shift()+d.nominalWidthX,l=!0),n+=e.pop(),t&&f.U.P.closePath(g),f.U.P.moveTo(g,n,p),t=!0;else if("o25"==z){for(;6<e.length;)n+=e.shift(),p+=e.shift(),f.U.P.lineTo(g,n,p);q=n+e.shift();w=p+e.shift();u=q+e.shift();v=w+e.shift();n=u+e.shift();p=v+e.shift();f.U.P.curveTo(g,q,w,u,v,n,p)}else if("o26"==z)for(e.length%
2&&(n+=e.shift());0<e.length;)q=n,w=p+e.shift(),u=q+e.shift(),v=w+e.shift(),n=u,p=v+e.shift(),f.U.P.curveTo(g,q,w,u,v,n,p);else if("o27"==z)for(e.length%2&&(p+=e.shift());0<e.length;)q=n+e.shift(),w=p,u=q+e.shift(),v=w+e.shift(),n=u+e.shift(),p=v,f.U.P.curveTo(g,q,w,u,v,n,p);else if("o10"==z||"o29"==z)q="o10"==z?d:c,0==e.length?console.log("error: empty stack"):(w=e.pop(),q=q.Subrs[w+q.Bias],a.x=n,a.y=p,a.nStems=h,a.haveWidth=l,a.width=k,a.open=t,f.U._drawCFF(q,a,c,d,g),n=a.x,p=a.y,h=a.nStems,l=a.haveWidth,
k=a.width,t=a.open);else if("o30"==z||"o31"==z)for(q=e.length,A=0,z="o31"==z,y=q&-3,A+=q-y;A<y;)z?(q=n+e.shift(),w=p,u=q+e.shift(),v=w+e.shift(),p=v+e.shift(),5==y-A?(n=u+e.shift(),A++):n=u,z=!1):(q=n,w=p+e.shift(),u=q+e.shift(),v=w+e.shift(),n=u+e.shift(),5==y-A?(p=v+e.shift(),A++):p=v,z=!0),f.U.P.curveTo(g,q,w,u,v,n,p),A+=4;else{if("o"==(z+"").charAt(0))throw console.log("Unknown operation: "+z,b),z;e.push(z)}}a.x=n;a.y=p;a.nStems=h;a.haveWidth=l;a.width=k;a.open=t};return f},function(){function k(b,
a){function c(){var a=f.getUint16(l);l+=2;return a}function d(){var a=f.getUint32(l);l+=4;return a}function g(a){y.setUint16(A,a);A+=2}function e(a){y.setUint32(A,a);A+=4}var f=new DataView(b),l=0;d();var k=d();d();var t=c();c();d();c();c();d();d();d();d();d();for(var r=0;Math.pow(2,r)<=t;)r++;r--;for(var n=16*Math.pow(2,r),p=16*t-n,q=12,w=[],u=0;u<t;u++)w.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),q+=16;var v=new Uint8Array(12+16*w.length+w.reduce(function(a,b){return a+
b.origLength+4},0));u=v.buffer;var y=new DataView(u),A=0;e(k);g(t);g(n);g(r);g(p);w.forEach(function(a){e(a.tag);e(a.origChecksum);e(q);e(a.origLength);a.outOffset=q;q+=a.origLength;0!=q%4&&(q+=4-q%4)});var E;w.forEach(function(c){var d=b.slice(c.offset,c.offset+c.compLength);if(c.compLength!=c.origLength){var e=new Uint8Array(c.origLength);a(new Uint8Array(d,2),e)}else e=new Uint8Array(d);v.set(e,c.outOffset);q=c.outOffset+c.origLength;d=0;0!=q%4&&(d=4-q%4);v.set((new Uint8Array(d)).buffer,c.outOffset+
c.origLength);E=q+d});return u.slice(0,E)}var f=function(){function b(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function a(a,c){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=c;this.destLen=0;this.ltree=new b;this.dtree=new b}function c(a,b,c,d){var e;for(e=0;e<c;++e)a[e]=0;for(e=0;e<30-c;++e)a[e+c]=e/c|0;c=d;for(e=0;30>e;++e)b[e]=c,c+=1<<a[e]}function d(a,b,c,d){var e,g;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[b[c+e]]++;for(e=g=a.table[0]=0;16>
e;++e)v[e]=g,g+=a.table[e];for(e=0;e<d;++e)b[c+e]&&(a.trans[v[b[c+e]]++]=e)}function g(a,b,c){if(!b)return c;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-b;a.tag>>>=b;a.bitcount-=b;return d+c}function e(a,b){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var c=0,d=0,e=0,g=a.tag;do d=2*d+(g&1),g>>>=1,++e,c+=b.table[e],d-=b.table[e];while(0<=d);a.tag=g;a.bitcount-=e;return b.trans[c+d]}function f(a,b,c){for(;;){var d=
e(a,b);if(256===d)return 0;if(256>d)a.dest[a.destLen++]=d;else{var f;d-=257;d=g(a,t[d],r[d]);var h=e(a,c);for(f=h=a.destLen-g(a,n[h],p[h]);f<h+d;++f)a.dest[a.destLen++]=a.dest[f]}}}var l=new b,k=new b,t=new Uint8Array(30),r=new Uint16Array(30),n=new Uint8Array(30),p=new Uint16Array(30),q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w=new b,u=new Uint8Array(320),v=new Uint16Array(16);(function(a,b){var c;for(c=0;7>c;++c)a.table[c]=0;a.table[7]=24;a.table[8]=152;a.table[9]=112;for(c=
0;24>c;++c)a.trans[c]=256+c;for(c=0;144>c;++c)a.trans[24+c]=c;for(c=0;8>c;++c)a.trans[168+c]=280+c;for(c=0;112>c;++c)a.trans[176+c]=144+c;for(c=0;5>c;++c)b.table[c]=0;b.table[5]=32;for(c=0;32>c;++c)b.trans[c]=c})(l,k);c(t,r,4,3);c(n,p,2,1);t[28]=0;r[28]=258;return function(c,b){c=new a(c,b);do{b=c;b.bitcount--||(b.tag=b.source[b.sourceIndex++],b.bitcount=7);var h=b.tag&1;b.tag>>>=1;b=h;h=g(c,2,0);switch(h){case 0:for(h=c;8<h.bitcount;)h.sourceIndex--,h.bitcount-=8;var m=h.source[h.sourceIndex+1];
m=256*m+h.source[h.sourceIndex];var n=h.source[h.sourceIndex+3];n=256*n+h.source[h.sourceIndex+2];if(m!==(~n&65535))h=-3;else{h.sourceIndex+=4;for(n=m;n;--n)h.dest[h.destLen++]=h.source[h.sourceIndex++];h=h.bitcount=0}break;case 1:h=f(c,l,k);break;case 2:var p;m=c;var r=c.ltree,t=c.dtree;n=g(m,5,257);h=g(m,5,1);var v=g(m,4,4);for(p=0;19>p;++p)u[p]=0;for(p=0;p<v;++p){var y=g(m,3,0);u[q[p]]=y}d(w,u,0,19);for(p=0;p<n+h;)switch(v=e(m,w),v){case 16:y=u[p-1];for(v=g(m,2,3);v;--v)u[p++]=y;break;case 17:for(v=
g(m,3,3);v;--v)u[p++]=0;break;case 18:for(v=g(m,7,11);v;--v)u[p++]=0;break;default:u[p++]=v}d(r,u,0,n);d(t,u,n,h);h=f(c,c.ltree,c.dtree);break;default:h=-3}if(0!==h)throw Error("Data error");}while(!b);return c.destLen<c.dest.length?"function"===typeof c.dest.slice?c.dest.slice(0,c.destLen):c.dest.subarray(0,c.destLen):c.dest}}();return function(b){return k(b,f)}},function(k,f){function b(c){var b=Object.create(null),g={unitsPerEm:c.head.unitsPerEm,ascender:c.hhea.ascender,descender:c.hhea.descender,
forEachGlyph:function(d,f,l,m){var e=0,h=1/g.unitsPerEm*f,n=0;k.U.stringToGlyphs(c,d).forEach(function(g){if(-1!==g){var q=b[g];if(!q){q=k.U.glyphToPath(c,g);var p=q.cmds,r=q.crds,t,y;if(r.length){q=t=Infinity;var A=y=-Infinity;for(var x=0,F=r.length;x<F;x+=2){var D=r[x],B=r[x+1];D<q&&(q=D);B<t&&(t=B);D>A&&(A=D);B>y&&(y=B)}}else q=A=t=y=0;q=b[g]={index:g,advanceWidth:c.hmtx.aWidth[g],xMin:q,yMin:t,xMax:A,yMax:y,pathCommandCount:p.length,forEachPathCommand:function(c){for(var b=0,d=[],e=0,g=p.length;e<
g;e++){var f=a[p[e]];d.length=1+f;d[0]=p[e];for(var h=1;h<=f;h++)d[h]=r[b++];c.apply(null,d)}}}}m.call(null,q,e,n);q.advanceWidth&&(e+=q.advanceWidth*h);l&&(e+=l*f)}n+=65535<d.codePointAt(n)?2:1});return e}};return g}var a={M:2,L:2,Q:4,C:6,Z:0};return function(a){var c=new Uint8Array(a,0,4);c=k._bin.readASCII(c,0,4);if("wOFF"===c)a=f(a);else if("wOF2"===c)throw Error("woff2 fonts not supported");return b(k.parse(a)[0])}}],init:function(k,f,b){k=k();f=f();return b(k,f)}}),O={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",
sdfGlyphSize:64,textureWidth:2048},Ba=new x.Color,ma=Object.create(null),P;R=G.defineWorkerModule({name:"FontProcessor",dependencies:[O,.125,R,function(k){function f(a,c){var b=a.minX,d=a.minY,e=a.maxX,g=a.maxY,h=a.cx,l=a.cy;b<c.minX&&(c.minX=b);d<c.minY&&(c.minY=d);e>c.maxX&&(c.maxX=e);g>c.maxY&&(c.maxY=g);var k=c.data;if(k)if(k.cx===h&&k.cy===l){for(;k.next;)k=k.next;k.next=a}else c.data=null,f(k,c),f(a,c);else h=(l<c.cy?0:2)+(h<c.cx?0:1),c[h]?f(a,c[h]):c[h]={0:null,1:null,2:null,3:null,data:a,
cx:c.cx+c.r/2*(h%2?1:-1),cy:c.cy+c.r/2*(2>h?-1:1),r:c.r/2,minX:b,minY:d,maxX:e,maxY:g}}function b(a,c){if(!1!==c(a)&&!a.data)for(var d=0;4>d;d++)null!==a[d]&&b(a[d],c)}function a(a,c){var d=!1;b(e,function(b){if(b.maxX<a||b.minY>c||b.maxY<c)return!1;for(b=b.data;b;b=b.next){var e=b.x0,g=b.y0,f=b.x1,h=b.y1;g>c!==h>c&&a<(f-e)*(c-g)/(h-g)+e&&(d=!d)}});return d}var c=k.xMin,d=k.yMin,g=k.xMax-c;k=k.yMax-d;var e={0:null,1:null,2:null,3:null,data:null,cx:Math.round(c+g/2),cy:Math.round(d+k/2),r:Math.pow(2,
Math.floor(Math.log(Math.max(g,k))*Math.LOG2E)),minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return{addLineSegment:function(a,c,b,d){f({x0:a,y0:c,x1:b,y1:d,cx:(a+b)/2,cy:(c+d)/2,minX:Math.min(a,b),minY:Math.min(c,d),maxX:Math.max(a,b),maxY:Math.max(c,d),next:null},e)},findNearestSignedDistance:function(c,d,g){var f=g,h=f*f;b(e,function(a){if(c-f>a.maxX||c+f<a.minX||d-f>a.maxY||d+f<a.minY)return!1;for(a=a.data;a;a=a.next){var b=a.x0;var e=a.y0;var g=a.x1-b,k=a.y1-e,l=g*g+k*k;l=l?Math.max(0,
Math.min(1,((c-b)*g+(d-e)*k)/l)):0;b=c-(b+l*g);e=d-(e+l*k);e=b*b+e*e;e<h&&(h=e,f=Math.sqrt(e))}});a(c,d)||(f=-f);return f}}},function(k,f){var b=f.sdfTextureSize,a=f.sdfDistancePercent;return function(c){var d=new Uint8Array(b*b),g=c.xMax-c.xMin,e=c.yMax-c.yMin,f=Math.max(g,e)*a,l=(g+2*f)/b,m=(e+2*f)/b;e=c.xMin-f-l;g=c.yMin-f-m;l=c.xMax+f+l;m=c.yMax+f+m;if(c.pathCommandCount){var t=k(c),r,n,p,q;c.forEachPathCommand(function(a,c,b,d,e,g,f){switch(a){case "M":p=r=c;q=n=b;break;case "L":c===p&&b===q||
t.addLineSegment(p,q,p=c,q=b);break;case "Q":g={x:p,y:q};for(f=1;16>f;f++){a=f/15;var h=1-a;a={x:h*h*p+2*h*a*c+a*a*d,y:h*h*q+2*h*a*b+a*a*e};t.addLineSegment(g.x,g.y,a.x,a.y);g=a}p=d;q=e;break;case "C":a={x:p,y:q};for(h=1;16>h;h++){var k=h/15;var l=1-k;k={x:l*l*l*p+3*l*l*k*c+3*l*k*k*d+k*k*k*g,y:l*l*l*q+3*l*l*k*b+3*l*k*k*e+k*k*k*f};t.addLineSegment(a.x,a.y,k.x,k.y);a=k}p=g;q=f;break;case "Z":p===r&&q===n||t.addLineSegment(p,q,r,n)}});for(c=0;c<b;c++)for(var w=0;w<b;w++){var u=t.findNearestSignedDistance(e+
(l-e)*(c+.5)/b,g+(m-g)*(w+.5)/b,f);u=isFinite(u)?Math.round(127.5*(1+u/f)):u;u=Math.max(0,Math.min(255,u));d[w*b+c]=u}}return{textureData:d,renderingBounds:[e,g,l,m]}}},function(k,f,b){function a(a,c){function b(){var d=function(c){console.error("Failure loading font "+a+(a===m?"":"; trying fallback"),c);a!==m&&(a=m,b())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=k(e.response);
c(a)}catch(v){d(v)}};e.onerror=d;e.send()}catch(u){d(u)}}b()}function c(c,b){c||(c=m);var d=t[c];if(d)d.onload?d.onload.push(b):b();else{var e=t[c]={onload:[b]};a(c,function(a){d=t[c]={fontObj:a,glyphs:{},glyphCount:0};e.onload.forEach(function(a){return a()})})}}function d(a,b){a||(a=m);c(a,function(){b(t[a])})}function g(a,c,b){var g=a.text;void 0===g&&(g="");var k=a.font;void 0===k&&(k=m);var n=a.fontSize;void 0===n&&(n=1);var p=a.letterSpacing;void 0===p&&(p=0);var r=a.lineHeight;void 0===r&&
(r="normal");var t=a.maxWidth;void 0===t&&(t=Infinity);var x=a.textAlign;void 0===x&&(x="left");var C=a.whiteSpace;void 0===C&&(C="normal");var D=a.overflowWrap;void 0===D&&(D="normal");var B=a.anchorX;void 0===B&&(B=0);var H=a.anchorY;void 0===H&&(H=0);var z=a.includeCaretPositions;void 0===z&&(z=!1);var G=a.chunkedBoundsSize;void 0===G&&(G=8192);var Q=a.colorRanges;void 0===Q&&(Q=null);void 0===b&&(b=!1);var O=h(),L={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};-1<g.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),
g=g.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));n=+n;p=+p;t=+t;r=r||"normal";d(k,function(a){var d=a.fontObj,k=isFinite(t),m=null,q=null,u=null,w=null,v=null,y=null,A=null,E=0,F=0,S="nowrap"!==C,ba=d.ascender,U=d.descender,ca=d.unitsPerEm;L.fontLoad=h()-O;var T=h(),J=n/ca;"normal"===r&&(r=(ba-U)/ca);r*=n;ca=(r-(ba-U)*J)/2;var P=-(n+ca),R=Math.min(r,(ba-U)*J),Y=(ba+U)/2*J-R/2,V=0,I=new l,W=[I];d.forEachGlyph(g,n,p,function(a,c,b){var d=g.charAt(b),e=a.advanceWidth*J,f=I.count;"isEmpty"in a||(a.isWhitespace=
!!d&&/\s/.test(d),a.isEmpty=a.xMin===a.xMax||a.yMin===a.yMax);a.isWhitespace||a.isEmpty||F++;if(S&&k&&!a.isWhitespace&&c+e+V>t&&f){if(I.glyphAt(f-1).glyphObj.isWhitespace){var h=new l;V=-c}else for(;f--;)if(0===f&&"break-word"===D){h=new l;V=-c;break}else if(I.glyphAt(f).glyphObj.isWhitespace){h=I.splitAt(f+1);f=h.glyphAt(0).x;V-=f;for(var m=h.count;m--;)h.glyphAt(m).x-=f;break}h&&(I.isSoftWrapped=!0,I=h,W.push(I),E=t)}h=I.glyphAt(I.count);h.glyphObj=a;h.x=c+V;h.width=e;h.charIndex=b;"\n"===d&&(I=
new l,W.push(I),V=-(c+e+p*n))});W.forEach(function(a){for(var c=a.count;c--;){var b=a.glyphAt(c),d=b.x,e=b.width;if(!b.glyphObj.isWhitespace){a.width=d+e;a.width>E&&(E=a.width);break}}});if(!b){var X=0,da=0;B&&("number"===typeof B?X=-B:"string"===typeof B&&(X=-E*("left"===B?0:"center"===B?.5:"right"===B?1:e(B))));H&&("number"===typeof H?da=-H:"string"===typeof H&&(d=W.length*r,da="top"===H?0:"top-baseline"===H?-P:"middle"===H?d/2:"bottom"===H?d:"bottom-baseline"===H?d-ca+U*J:e(H)*d));q=new Float32Array(4*
F);u=new Float32Array(F);y=[Infinity,Infinity,-Infinity,-Infinity];A=[];var N=P;z&&(v=new Float32Array(3*g.length));Q&&(w=new Uint8Array(3*F));var Z=0,M=-1,ea=-1,K,fa;W.forEach(function(c){var b=c.count,d=c.width;if(0<b){var e=0,k=0;if("center"===x)e=(E-d)/2;else if("right"===x)e=E-d;else if("justify"===x&&c.isSoftWrapped){k=0;for(var l=b;l--;)if(!c.glyphAt(l).glyphObj.isWhitespace){for(;l--;){if(!c.glyphAt(l).glyphObj)debugger;c.glyphAt(l).glyphObj.isWhitespace&&k++}break}k=(E-d)/k}for(d=0;d<b;d++){l=
c.glyphAt(d);var n=l.glyphObj;e&&(l.x+=e);0!==k&&n.isWhitespace&&(e+=k,l.width+=k);if(z){var p=l.charIndex;v[3*p]=l.x+X;v[3*p+1]=l.x+l.width+X;for(v[3*p+2]=N+Y+da;1<p-M;)v[3*(M+1)]=v[3*M+1],v[3*(M+1)+1]=v[3*M+1],v[3*(M+1)+2]=v[3*M+2],M++;M=p}if(Q)for(p=l.charIndex;p>ea;)ea++,Q.hasOwnProperty(ea)&&(fa=Q[ea]);if(!n.isWhitespace&&!n.isEmpty){p=Z++;var t=a.glyphs[n.index];if(!t){t=h();var B=f(n);L.sdf[g.charAt(l.charIndex)]=h()-t;B.atlasIndex=a.glyphCount++;m||(m=[]);m.push(B);t=a.glyphs[n.index]={atlasIndex:B.atlasIndex,
glyphObj:n,renderingBounds:B.renderingBounds}}var C=t.renderingBounds,D=4*p;n=q[D]=l.x+C[0]*J+X;B=q[D+1]=N+C[1]*J+da;l=q[D+2]=l.x+C[2]*J+X;C=q[D+3]=N+C[3]*J+da;n<y[0]&&(y[0]=n);B<y[1]&&(y[1]=B);l>y[2]&&(y[2]=l);C>y[3]&&(y[3]=C);0===p%G&&(K={start:p,end:p,rect:[Infinity,Infinity,-Infinity,-Infinity]},A.push(K));K.end++;n<K.rect[0]&&(K.rect[0]=n);B<K.rect[1]&&(K.rect[1]=B);l>K.rect[2]&&(K.rect[2]=l);C>K.rect[3]&&(K.rect[3]=C);u[p]=t.atlasIndex;Q&&(l=3*p,w[l]=fa>>16&255,w[l+1]=fa>>8&255,w[l+2]=fa&255)}}}N-=
r})}for(var aa in L.sdf)L.sdfTotal+=L.sdf[aa];L.layout=h()-T-L.sdfTotal;L.total=h()-O;c({glyphBounds:q,glyphAtlasIndices:u,caretPositions:v,caretHeight:R,glyphColors:w,chunkedBounds:A,ascender:ba*J,descender:U*J,lineHeight:r,topBaseline:P,totalBounds:y,totalBlockSize:[E,W.length*r],newGlyphSDFs:m,timings:L})})}function e(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function h(){return(self.performance||Date).now()}function l(){this.data=[]}var m=b.defaultFontUrl,t=
Object.create(null);l.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(a){var c=l.flyweight;c.data=this.data;c.index=a;return c},splitAt:function(a){var c=new l;c.data=this.data.splice(4*a);return c}};l.flyweight=["glyphObj","x","width","charIndex"].reduce(function(a,c,b,d){Object.defineProperty(a,c,{get:function(){return this.data[4*this.index+b]},set:function(a){this.data[4*this.index+b]=a}});return a},{data:null,index:0});return{process:g,measure:function(a,
c){g(a,function(a){c({width:a.totalBlockSize[0],height:a.totalBlockSize[1]})},{metricsOnly:!0})},loadFont:c}}],init:function(k,f,b,a,c,d){f=c(a,{sdfTextureSize:k.sdfGlyphSize,sdfDistancePercent:f});return d(b,f,{defaultFontUrl:k.defaultFontURL})}});var Ca=G.defineWorkerModule({name:"TextBuilder",dependencies:[R,G.ThenableWorkerModule],init:function(k,f){return function(b){var a=new f;k.process(b,a.resolve);return a}},getTransferables:function(k){var f=[k.glyphBounds.buffer,k.glyphAtlasIndices.buffer];
k.caretPositions&&f.push(k.caretPositions.buffer);k.newGlyphSDFs&&k.newGlyphSDFs.forEach(function(b){f.push(b.textureData.buffer)});return f}}),na={},Ga=new x.Vector3,Y=function(k){function f(){k.call(this);this.detail=1;this.boundingSphere=new x.Sphere}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;var b={detail:{configurable:!0}};f.prototype.computeBoundingSphere=function(){};b.detail.set=function(a){var c=this;if(a!==this._detail){this._detail=a;if("number"!==
typeof a||1>a)a=1;var b=Da(a);["position","normal","uv"].forEach(function(a){c.attributes[a]=b.attributes[a]});this.setIndex(b.getIndex())}};b.detail.get=function(){return this._detail};f.prototype.updateGlyphs=function(a,c,b,g,e){Z(this,"aTroikaGlyphBounds",a,4);Z(this,"aTroikaGlyphIndex",c,1);Z(this,"aTroikaGlyphColor",e,3);this._chunkedBounds=g;oa(this,c.length);a=this.boundingSphere;a.center.set((b[0]+b[2])/2,(b[1]+b[3])/2,0);a.radius=a.center.distanceTo(Ga.set(b[0],b[1],0))};f.prototype.applyClipRect=
function(a){var c=this.getAttribute("aTroikaGlyphIndex").count,b=this._chunkedBounds;if(b)for(var g=b.length;g--;){c=b[g].end;var e=b[g].rect;if(e[1]<a.w&&e[3]>a.y&&e[0]<a.z&&e[2]>a.x)break}oa(this,c)};Object.defineProperties(f.prototype,b);return f}(x.InstancedBufferGeometry);Y.prototype.setAttribute||(Y.prototype.setAttribute=function(k,f){this.attributes[k]=f;return this});var ta=new x.MeshBasicMaterial({color:16777215,side:x.DoubleSide,transparent:!0}),ha=new x.Matrix4,ua=new x.Vector3,ia=new x.Vector3,
S=[],Ha=new x.Vector3,va=new x.Mesh((new x.PlaneBufferGeometry(1,1)).translate(.5,.5,0),ta),Ia={type:"syncstart"},Ja={type:"synccomplete"};G="font fontSize letterSpacing lineHeight maxWidth overflowWrap text textAlign whiteSpace anchorX anchorY colorRanges".split(" ");var Ka=G.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),N=function(k){function f(){var a=new Y;k.call(this,a,null);this.text="";this.anchorY=this.anchorX=0;this.font=null;this.fontSize=.1;this.letterSpacing=
0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.debugSDF=!1}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;var b={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},
customDistanceMaterial:{configurable:!0}};f.prototype.sync=function(a){var c=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,this.dispatchEvent(Ia),ka({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,
colorRanges:this.colorRanges,includeCaretPositions:!0},function(b){c._isSyncing=!1;c._textRenderInfo=b;c.geometry.updateGlyphs(b.glyphBounds,b.glyphAtlasIndices,b.totalBounds,b.chunkedBounds,b.glyphColors);var d=c._queuedSyncs;d&&(c._queuedSyncs=null,c._needsSync=!0,c.sync(function(){d.forEach(function(a){return a&&a()})}));c.dispatchEvent(Ja);a&&a()})))};f.prototype.onBeforeRender=function(){this.sync();this._prepareForRender()};f.prototype.dispose=function(){this.geometry.dispose()};b.textRenderInfo.get=
function(){return this._textRenderInfo||null};b.material.get=function(){var a=this._derivedMaterial,c=this._baseMaterial||ta;a&&a.baseMaterial===c||(a=this._derivedMaterial=Ea(c),c.addEventListener("dispose",function g(){c.removeEventListener("dispose",g);a.dispose()}));return a};b.material.set=function(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a};b.glyphGeometryDetail.get=function(){return this.geometry.detail};b.glyphGeometryDetail.set=
function(a){this.geometry.detail=a};b.customDepthMaterial.get=function(){return this.material.getDepthMaterial()};b.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()};f.prototype._prepareForRender=function(){var a=this._derivedMaterial,c=a.uniforms,b=this.textRenderInfo;if(b){var f=b.sdfTexture,e=b.totalBounds;c.uTroikaSDFTexture.value=f;c.uTroikaSDFTextureSize.value.set(f.image.width,f.image.height);c.uTroikaSDFGlyphSize.value=b.sdfGlyphSize;c.uTroikaSDFMinDistancePct.value=
b.sdfMinDistancePercent;c.uTroikaTotalBounds.value.fromArray(e);c.uTroikaUseGlyphColors.value=!!b.glyphColors;(b=this.clipRect)&&Array.isArray(b)&&4===b.length?c.uTroikaClipRect.value.set(Math.max(e[0],b[0]),Math.max(e[1],b[1]),Math.min(e[2],b[2]),Math.min(e[3],b[3])):c.uTroikaClipRect.value.fromArray(e);this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=this.depthOffset||0;e=this.color;
null!=e&&a.color&&a.color.isColor&&e!==a._troikaColor&&a.color.set(a._troikaColor=e);e=this.orientation||"+x+y";if(e!==a._orientation){c=c.uTroikaOrient.value;e=e.replace(/[^-+xyz]/g,"");var h="+x+y"!==e&&e.match(/^([-+])([xyz])([-+])([xyz])$/);if(h){b=h[1];f=h[2];var k=h[3];h=h[4];ua.set(0,0,0)[f]="-"===b?1:-1;ia.set(0,0,0)[h]="-"===k?-1:1;ha.lookAt(Ha,ua.cross(ia),ia);c.setFromMatrix4(ha)}else c.identity();a._orientation=e}};f.prototype.raycast=function(a,c){var b=this.textRenderInfo;if(b)for(b=
b.totalBounds,va.matrixWorld.multiplyMatrices(this.matrixWorld,ha.set(b[2]-b[0],0,0,b[0],0,b[3]-b[1],0,b[1],0,0,1,0,0,0,0,1)),S.length=0,va.raycast(a,S),a=0;a<S.length;a++)S[a].object=this,c.push(S[a])};f.prototype.copy=function(a){var c=this;k.prototype.copy.call(this,a);Ka.forEach(function(b){c[b]=a[b]});return this};f.prototype.clone=function(){return(new this.constructor).copy(this)};Object.defineProperties(f.prototype,b);return f}(x.Mesh);G.forEach(function(k){var f="_private_"+k;Object.defineProperty(N.prototype,
k,{get:function(){return this[f]},set:function(b){b!==this[f]&&(this[f]=b,this._needsSync=!0)}})});var wa=!1;Object.defineProperty(N.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(k){this._deprecated_anchor=k;wa||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),wa=!0);Array.isArray(k)?(this.anchorX=100*(+k[0]||0)+"%",this.anchorY=100*(+k[1]||0)+"%"):this.anchorX=this.anchorY=0}});var qa=new WeakMap,ra=new WeakMap,xa=new x.Vector4,
La=function(k){function f(b){k.call(this,b);this.instancedThreeObject=sa();this._color=new x.Color;this._rect=new x.Vector4}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;f.prototype.afterUpdate=function(){var b=this.top,a=this.right,c=this.bottom,d=this.left,f=this.color;this._color.equals(f)||this.setInstanceUniform("diffuse",this._color=new x.Color(f));this._rect.equals(xa.set(d,b,a,c))||this.setInstanceUniform("rect",xa.clone());k.prototype.afterUpdate.call(this)};
f.prototype.getBoundingSphere=function(){return null};return f}(T.Instanceable3DFacade),ya=new x.Matrix4,Ma=new x.Plane,Na=new x.Vector3,za=Object.freeze([-Infinity,-Infinity,Infinity,Infinity]),Oa=function(k){function f(a,b){var c=this;k.call(this,a);var f=a.threeObject;this.rangeColor=52479;this.clipRect=za;this.template={key:function(a,c){return"rect"+c},facade:La,top:function(a){return Math.min(c.clipRect[3],Math.max(c.clipRect[1],a.top))},right:function(a){return Math.min(c.clipRect[2],Math.max(c.clipRect[0],
a.right))},bottom:function(a){return Math.min(c.clipRect[3],Math.max(c.clipRect[1],a.bottom))},left:function(a){return Math.min(c.clipRect[2],Math.max(c.clipRect[0],a.left))},z:function(a){return.25*(a.top-a.bottom)/2},scaleZ:function(a){return.25*(a.top-a.bottom)},color:function(a){return c.rangeColor},visible:function(a){var b=c.clipRect;return a.right>b[0]&&a.top>b[1]&&a.left<b[2]&&a.bottom<b[3]},renderOrder:function(a){return c.renderOrder||0}};var e=function(d){var e=c.textRenderInfo;if(e){var g=
d.intersection.point.clone().applyMatrix4(ya.getInverse(f.matrixWorld));if(e=aa(e,g.x,g.y))b(e.charIndex,e.charIndex),a.addEventListener("drag",h),a.addEventListener("dragend",l);d.preventDefault()}},h=function(a){var d=f.textRenderInfo;if(a.ray&&d){var e=a.ray.clone().applyMatrix4(ya.getInverse(f.matrixWorld)).intersectPlane(Ma.setComponents(0,0,1,0),Na);e&&(d=aa(d,e.x,e.y))&&b(c.selectionStart,d.charIndex);a.preventDefault()}},l=function(c){a.removeEventListener("drag",h);a.removeEventListener("dragend",
l)};a.addEventListener("dragstart",e);a.addEventListener("mousedown",e);this._cleanupEvents=function(){l();a.removeEventListener("dragstart",e);a.removeEventListener("mousedown",e)}}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;var b={clipRect:{configurable:!0}};f.prototype.afterUpdate=function(){this.data=pa(this.textRenderInfo,this.selectionStart,this.selectionEnd);k.prototype.afterUpdate.call(this)};b.clipRect.set=function(a){this._clipRect=a&&Array.isArray(a)&&
4===a.length?a:za};b.clipRect.get=function(){return this._clipRect};f.prototype.destructor=function(){this._cleanupEvents();k.prototype.destructor.call(this)};Object.defineProperties(f.prototype,b);return f}(T.ListFacade),Pa="text anchorX anchorY font fontSize letterSpacing lineHeight maxWidth overflowWrap textAlign whiteSpace material color colorRanges depthOffset clipRect orientation glyphGeometryDetail debugSDF".split(" ");G=function(k){function f(a){var c=this,b=new N;b.geometry.boundingSphere.version=
0;k.call(this,a,b);this.selectable=!1;this.selectionStart=this.selectionEnd=-1;this.onSyncComplete=this.onSyncStart=null;b.addEventListener("syncstart",function(a){c.notifyWorld("text3DSyncStart");if(c.onSyncStart)c.onSyncStart()});b.addEventListener("synccomplete",function(a){if(!c.isDestroying&&(b.geometry.boundingSphere.version++,c.afterUpdate(),c.notifyWorld("text3DSyncComplete"),c.notifyWorld("needsRender"),c.onSyncComplete))c.onSyncComplete()})}k&&(f.__proto__=k);f.prototype=Object.create(k&&
k.prototype);f.prototype.constructor=f;var b={textRenderInfo:{configurable:!0}};b.textRenderInfo.get=function(){return this.threeObject.textRenderInfo};f.prototype.afterUpdate=function(){var a=this,b=this.threeObject;Pa.forEach(function(c){b[c]=a[c]});b.sync();k.prototype.afterUpdate.call(this);this.text!==this._prevText&&(this.selectionStart=this.selectionEnd=-1,this._prevText=this.text);this._updateSelection()};f.prototype._updateSelection=function(){var a=this,b=this.selectable,d=this.selectionStart,
f=this.selectionEnd,e=this._selectionFacade;b!==this._selectable&&((this._selectable=b)?e=this._selectionFacade=new Oa(this,function(b,c){a.selectionStart=b;a.selectionEnd=c;a._updateSelection();a.notifyWorld("needsRender")}):(e&&(e.destructor(),e=this._selectionFacade=null),this.selectionStart=this.selectionEnd=-1));e&&(e.textRenderInfo=this.threeObject.textRenderInfo,e.selectionStart=d,e.selectionEnd=f,e.clipRect=this.clipRect,e.renderOrder=this.renderOrder,e.afterUpdate())};f.prototype.destructor=
function(){this.threeObject.dispose();this._selectionFacade&&this._selectionFacade.destructor();k.prototype.destructor.call(this)};Object.defineProperties(f.prototype,b);return f}(T.Object3DFacade);C.GlyphsGeometry=Y;C.Text3DFacade=G;C.TextMesh=N;C.configureTextBuilder=function(k){la(O,k)};C.fontProcessorWorkerModule=R;C.getCaretAtPoint=aa;C.getSelectionRects=pa;C.preloadFont=function(k,f,b){f=Array.isArray(f)?f.join("\n"):""+f;ka({font:k,text:f},b)};Object.defineProperty(C,"__esModule",{value:!0})})
