'use strict';(function(u,B){"object"===typeof exports&&"undefined"!==typeof module?B(exports,require("troika-animation"),require("react"),require("prop-types")):"function"===typeof define&&define.amd?define(["exports","troika-animation","react","prop-types"],B):(u=u||self,B(u.troika_core={},u.troika_animation,u.React,u.PropTypes))})(this,function(u,B,k,q){function P(){for(var c=arguments,a=arguments[0],e=1,b=arguments.length;e<b;e++){var d=c[e];if(d)for(var m in d)d.hasOwnProperty(m)&&(a[m]=d[m])}return a}
function Q(){for(var c=arguments,a=arguments[0],e=1,b=arguments.length;e<b;e++){var d=c[e];if(d)for(var m in d)d.hasOwnProperty(m)&&!a.hasOwnProperty(m)&&(a[m]=d[m])}return a}function R(c,a){if(a)for(var e in a)a.hasOwnProperty(e)&&(c[e]&&"object"===typeof c[e]&&"object"===typeof a[e]?R(c[e],a[e]):c[e]=a[e])}function F(c,a){var e=new WeakMap;return function(b){var d=e.get(b);d||(d=a(b),e.set(b,d));return d}}function S(c){return(c=c.$$typeof)&&c.toString&&"Symbol(react.element)"===c.toString()||!1}
function ca(c,a){return"paused"===c?void 0:Infinity===a?"Infinity":a}function da(c,a){return c.time-a.time}function G(c){return"onDoubleClick"===c?"dblclick":c.replace(/^on/,"").toLowerCase()}function ea(){function c(b,d,e,a){try{b.call(d,e,a)}catch(f){console.error(f)}}var a=this,e=Object.create(null);this.addListenerForFacade=function(b,d,a){d=e[d]||(e[d]={count:0,byFacadeId:Object.create(null)});b=b.$facadeId;var c=d.byFacadeId[b];c?Array.isArray(c)?-1===c.indexOf(a)&&(d.count++,c.push(a)):c!==
a&&(d.count++,d.byFacadeId[b]=[c,a]):(d.count++,d.byFacadeId[b]=a)};this.removeListenerForFacade=function(b,d,a){d=e[d];b=b.$facadeId;var c=d&&d.byFacadeId[b];c===a?(d.count--,delete d.byFacadeId[b]):Array.isArray(c)&&(a=c.indexOf(a),-1<a&&(d.count--,1===c.length?delete d.byFacadeId[b]:c.splice(a,1)))};this.removeAllListenersForFacade=function(b){b=b.$facadeId;for(var d in e){var a=e[d].byFacadeId[b];a&&(e[d].count-=Array.isArray(a)?a.length:1,delete e[d].byFacadeId[b])}};this.hasFacadeListenersOfType=
function(b,d){return e[d]?!!e[d].byFacadeId[b.$facadeId]:!1};this.hasAnyListenersOfType=function(b){return e[b]?0<e[b].count:!1};this.findBubblingEventTarget=function(b,d){for(;b;){if(a.hasFacadeListenersOfType(b,d))return b;b=b.parent}return null};this.forEachFacadeListenerOfType=function(b,d,a,g){d=e[d];b=b.$facadeId;if(d=d&&d.byFacadeId[b])if(Array.isArray(d))for(var m=0;m<d.length;m++)c(a,g,d[m],b);else c(a,g,d,b)};this.forEachListenerOfType=function(b,d,a){if((b=e[b])&&0<b.count)for(var g in b.byFacadeId){var m=
b.byFacadeId[g];if(Array.isArray(m))for(var h=0;h<m.length;h++)c(d,a,m[h],g);else c(d,a,m,g)}};this.dispatchEventOnFacade=function(b,d){function c(b){b.call(e,d)}var e=b;for(d.target=b;e&&!d.propagationStopped;)if(d.currentTarget=e,a.forEachFacadeListenerOfType(e,d.type,c,null),d.bubbles)e=e.parent;else break}}function H(c){return"touchend"===c.type||"touchcancel"===c.type}function fa(c){c.stopPropagation();c.preventDefault()}k=k&&Object.prototype.hasOwnProperty.call(k,"default")?k["default"]:k;q=
q&&Object.prototype.hasOwnProperty.call(q,"default")?q["default"]:q;var x=Object.assign||P,J=function(){var c=new WeakMap,a=0;return function(e){var b=c.get(e);b||c.set(e,b="$id"+ ++a);return b}}();J=Object.freeze({__proto__:null,assign:x,_assign:P,assignIf:Q,assignDeep:R,forOwn:function(c,a,e){for(var b in c)c.hasOwnProperty(b)&&a.call(e,c[b],b,c)},getIdForObject:J,memoize:function(c){var a,e,b;return function(){var d=arguments,m=!a||this!==e||arguments.length!==a.length;if(!m)for(var g=0,f=arguments.length;g<
f;g++)if(d[g]!==a[g]){m=!0;break}m&&(a=Array.prototype.slice.call(arguments),e=this,b=c.apply(this,arguments));return b}},createClassExtender:F,isReactElement:S});var p=function(c){this.$facadeId="facade"+ha++;this.parent=c};p.prototype.update=function(c){c&&"object"===typeof c&&(x(this,c),this.afterUpdate(),this.notifyWorld("needsRender"))};p.prototype.afterUpdate=function(){var c=this.ref;c!==this._lastRef&&("function"===typeof this._lastRef&&this._lastRef.call(null,null),"function"===typeof c?
(c.call(null,this),this._lastRef=c):this._lastRef=null)};p.prototype.notifyWorld=function(c,a){if(this.parent)this.parent.onNotifyWorld(this,c,a)};p.prototype.onNotifyWorld=function(c,a,e){var b=this._notifiableParent;if(b)b.onNotifyWorld.call(b,c,a,e);else{b=this.parent;for(var d=p.prototype.onNotifyWorld;b;){if(b.onNotifyWorld!==d){this._notifiableParent=b;b.onNotifyWorld(c,a,e);break}b=b.parent}}};p.prototype.traverse=function(c){c(this)};p.prototype.forEachChild=function(c){};p.prototype.addEventListener=
function(c,a){this.notifyWorld("addEventListener",{type:c,handler:a})};p.prototype.removeEventListener=function(c,a){this.notifyWorld("removeEventListener",{type:c,handler:a})};p.prototype.dispatchEvent=function(c){this.notifyWorld("dispatchEvent",c)};p.prototype.destructor=function(){this.parent&&this.notifyWorld("removeAllEventListeners");"function"===typeof this.ref&&this.ref.call(null,null);this.parent=this._notifiableParent=null};x(p.prototype,{ref:null,_lastRef:null,_notifiableParent:null});
var ha=0,ia={key:1,facade:1,transition:1,animation:1};p.isSpecialDescriptorProperty=function(c){return ia.hasOwnProperty(c)};p.defineEventProperty=function(c,a,e){var b=a+"\u27a4handler";Object.defineProperty(c.prototype,a,{get:function(){return this[b]},set:function(d){var a=this[b];(d||null)!==(a||null)&&("function"===typeof a&&this.removeEventListener(e,a),"function"===typeof d&&this.addEventListener(e,d),this[b]=d)}})};var T=[null],U=F("animatable",function(c){function a(b,d){if(!e.prototype.hasOwnProperty(b)){for(var a=
b+"\u27a4anim:actualValue",g=b+"\u27a4anim:actuallySet",f=b+"\u27a4anim:hasBeenSet",h=b+"\u27a4anim:tween",l,I,v=c.prototype;v;){var K=Object.getOwnPropertyDescriptor(v,b);if(K){I=K.set;l=K.get;if(I&&!l||l&&!I)throw Error("Animatable: property "+b+" has a custom "+(I?"setter":"getter")+" but no "+(I?"getter":"setter")+". Animatable properties must have both.");break}v=Object.getPrototypeOf(v)}var n=I?function(b){I.call(this,b);this[f]||(this[f]=!0)}:function(b){this[a]=b;this[f]||(this[f]=!0)};Object.defineProperty(e.prototype,
g,{value:n});Object.defineProperty(e.prototype,b,{get:function(){return l?l.call(this):this[f]?this[a]:c.prototype[b]},set:function(a){if(!this.animation$animatingProps||!this.animation$animatingProps[b]){var d=this.animation$runner,e=this.transition;if(e&&e[b]&&this[f]&&e.hasOwnProperty(b)){e=e[b];var c=this[h],g=!1;c?a!==c.toValue&&(d.stop(c),g=!0):a!==this[b]&&(g=!0);g&&(c=this[h]=new B.Tween(n.bind(this),this[b],a,e.duration||750,e.delay||0,e.easing||"easeOutCubic",1,"forward",e.interpolate||
"number"),d.start(c))}else n.call(this,a),(a=this[h])&&d.stop(a),this[h]=null}}})}d.hasOwnProperty(b)&&(d[b+"\u27a4anim:actualValue"]=d[b],d[b+"\u27a4anim:hasBeenSet"]=!0,delete d[b])}var e=function(b){function d(){for(var a=this,e=[],d=arguments.length;d--;)e[d]=arguments[d];b.apply(this,e);this.animation$runner=new B.Runner;this.animation$runner.onTick=function(){a.afterUpdate();a.notifyWorld("needsRender")}}b&&(d.__proto__=b);d.prototype=Object.create(b&&b.prototype);d.prototype.constructor=d;
var e={transition:{configurable:!0},animation:{configurable:!0}};e.transition.set=function(b){if(b)for(var d in b)b.hasOwnProperty(d)&&a(d,this);this.transition$descriptor=b};e.transition.get=function(){return this.transition$descriptor};e.animation.set=function(b){if(this.animation$descriptor!==b){this.animation$descriptor=b;var d=this.animation$tweens||null,e=this.animation$tweens=b?Object.create(null):null,c=this.animation$runner,g=!1;b&&!Array.isArray(b)&&(T[0]=b,b=T);if(b)for(var m=0,K=b.length;m<
K;m++){var n=b[m];if(n){var t=JSON.stringify(n,ca);if(d&&t in d){var r=d[t];n.paused?c.pause(r):c.start(r);e[t]=r}else{g=0;var k=750,p="linear",q=1;r=[];var u="forward",w;for(w in n)if(n.hasOwnProperty(w))switch(w){case "duration":k=n[w];break;case "delay":g=n[w];break;case "easing":p=n[w];break;case "iterations":q=n[w];break;case "direction":u=n[w];break;default:var z="from"===w?0:"to"===w?100:parseFloat(w);if(!isNaN(z)&&0<=z&&100>=z){r.push({time:z/100,props:n[w]});for(var y in n[w])n[w].hasOwnProperty(y)&&
(a(y,this),z=y+"\u27a4anim:tween",this[z]&&(c.stop(this[z]),this[z]=null))}}if(r.length){r.sort(da);0<r[0].time&&r.unshift(Q({time:0},r[0]));z=[];for(var x=1,A=r.length;x<A;x++){var E=r[x],F=E.props,C;for(C in F)if(F.hasOwnProperty(C)){for(var D=null,G=x;G--;)if(C in r[G].props){D=r[G];break}D&&(D=new B.Tween(this[C+"\u27a4anim:actuallySet"].bind(this),D.props[C],F[C],(E.time-D.time)*k,D.time*k,"linear",1,"forward",n.interpolate&&n.interpolate[C]||"number"),D.$$property=C,z.push(D))}}t=e[t]=new B.MultiTween(z,
k,g,p,q,u);n.paused||c.start(t);if(0===g){n=r[0].props;for(var H in n)if(n.hasOwnProperty(H))this[H+"\u27a4anim:actuallySet"](n[H])}}g=!0}}}if(d)for(var L in d)e&&e[L]||(b=d[L],b.gotoEnd(),c.stop(b),g=!0);if(g)if(e){d=this.animation$animatingProps=Object.create(null);for(var J in e)for(c=e[J].tweens,L=c.length;L--;)d[c[L].$$property]=!0}else this.animation$animatingProps=null}};e.animation.get=function(){return this.animation$descriptor};d.prototype.destructor=function(){var d=this,e=this.animation$runner;
if(this.exitAnimation&&!this.parent.isDestroying){e.stopAll();this.animation=this.exitAnimation;this.exitAnimation=this.transition=null;var a=e.onTick;e.onTick=function(){d.parent&&!d.parent.isDestroying?a():(e.onDone=null,d.destructor())};e.onDone=function(){d.notifyWorld("needsRender");d.destructor()}}else e.destructor(),b.prototype.destructor.call(this)};Object.defineProperties(d.prototype,e);return d}(c);return e}),V=F("pointerStates",function(c){function a(b,d){var e=b+"\u27a4pntr:hasBeenSet";
d[e]||(d[b+"\u27a4pntr:baseValue"]=d[b],delete d[b],d[e]=!0);if(!l.prototype.hasOwnProperty(b)){h[b]=1;var a=b+"\u27a4pntr:baseValue",g=b+"\u27a4pntr:appliedValue";Object.defineProperty(l.prototype,b,{get:function(){a:{var d=c.prototype;if(b in d)for(;d;){var e=Object.getOwnPropertyDescriptor(d,b);if(e&&e.get){d=e.get;break a}d=Object.getPrototypeOf(d)}d=null}return d?d.call(this):g in this?this[g]:this[a]},set:function(b){this[a]=b}})}}function e(b,d,e){a:{var a=c.prototype;if(d in a)for(;a;){var g=
Object.getOwnPropertyDescriptor(a,d);if(g&&g.set){a=g.set;break a}a=Object.getPrototypeOf(a)}a=null}a?a.call(b,e):b[d+"\u27a4pntr:appliedValue"]=e}function b(b){b.currentTarget["\u27a4pntr:isHovering"]=!0;f(b)}function d(b){b.currentTarget["\u27a4pntr:isHovering"]=b.currentTarget["\u27a4pntr:isActive"]=!1;f(b)}function m(b){b.currentTarget["\u27a4pntr:isActive"]=!0;f(b)}function g(b){b.currentTarget["\u27a4pntr:isActive"]=!1;f(b)}function f(b){b=b.currentTarget;for(var d=b.parent;d&&d.shouldUpdateChildren();)d.isPointerStateAware&&
(b=d),d=d.parent;b.afterUpdate();b.notifyWorld("needsRender")}var h=Object.create(null),l=function(c){function f(e){c.call(this,e);this.addEventListener("mouseover",b);this.addEventListener("mouseout",d);this.addEventListener("mousedown",m);this.addEventListener("mouseup",g)}c&&(f.__proto__=c);f.prototype=Object.create(c&&c.prototype);f.prototype.constructor=f;f.prototype.afterUpdate=function(){this._applyPointerStates();c.prototype.afterUpdate.call(this)};f.prototype._applyPointerStates=function(){var b=
this.pointerStates,d=b&&this["\u27a4pntr:isHovering"]&&b.hover||null,c=b&&this["\u27a4pntr:isActive"]&&b.active||null;b=this["\u27a4pntr:lastAppliedValues"]||h;if(d=this["\u27a4pntr:lastAppliedValues"]=d||c?x(Object.create(null),d,c):null)for(var g in d)a(g,this),e(this,g,d[g]);if(b)for(var m in b)d&&m in d||e(this,m,this[m+"\u27a4pntr:baseValue"])};return f}(c);Object.defineProperty(l.prototype,"isPointerStateAware",{value:!0});return l}),ja=function(c){function a(e){c.call(this,e);this._orderedItemKeys=
[]}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.afterUpdate=function(){var e=this.data,b=this.template,d=e&&e.length&&Array.isArray(e);if("production"!==process.env.NODE_ENV){if(e&&!Array.isArray(e))throw Error('ListFacade "data" must be an array.');if(!b||"object"!==typeof b)throw Error('ListFacade "template" must be an object.');if(!b||"function"!==typeof b.key)throw Error('ListFacade template must define a "key" function.');if(!b||"function"!==
typeof b.facade)throw Error('ListFacade template must define a "facade".');}if(this.shouldUpdateChildren()){var a=this._itemsDict||null,g=this._itemsDict=d?Object.create(null):null,f=this._orderedItemKeys;if(d){f.length=e.length;d=0;for(var h=e.length;d<h;d++){var l=e[d],k=b.key(l,d,e),v=b.facade;if("production"!==process.env.NODE_ENV){if(null==k)throw Error('ListFacade template "key" function must return a key.');g[k]&&console.warn("Duplicate key in list: "+k)}for(;g[k];)k+="|dupe";var p="function"===
typeof b.transition?b.transition(l,d,e):b.transition,n="function"===typeof b.animation?b.animation(l,d,e):b.animation,t="function"===typeof b.exitAnimation?b.exitAnimation(l,d,e):b.exitAnimation;if(p||n||t)v=U(v);t=b.pointerStates;if("function"===t?t(l,d,e):t)v=V(v);(t=a&&a[k])&&t.constructor===v?v=t:(t&&t.destructor(),v=new v(this));v.transition=p;v.animation=n;for(var r in b)b.hasOwnProperty(r)&&!c.isSpecialDescriptorProperty(r)&&(v[r]="function"===typeof b[r]?b[r](l,d,e):b[r]);v.afterUpdate();
g[k]=v;f[d]=k}}if(a)for(var q in a)g&&g[q]||a[q].destructor()}c.prototype.afterUpdate.call(this)};a.prototype.shouldUpdateChildren=function(){return!0};a.prototype.traverse=function(e,b){e.call(b,this);for(var d=this._orderedItemKeys,a=this._itemsDict,c=0,f=d.length;c<f;c++)a[d[c]].traverse(e,b)};a.prototype.forEachChild=function(a,b){for(var d=this._orderedItemKeys,e=this._itemsDict,c=0,f=d.length;c<f;c++)a.call(b,e[d[c]],d[c])};a.prototype.destructor=function(){this.isDestroying=!0;var a=this._itemsDict;
if(a)for(var b in a)a[b].destructor();c.prototype.destructor.call(this)};return a}(p),W=[null],M=function(c){function a(a){c.call(this,a);this.children=null;this._orderedChildKeys=[]}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.afterUpdate=function(){this.shouldUpdateChildren()&&this.updateChildren(this.describeChildren());c.prototype.afterUpdate.call(this)};a.prototype.describeChildren=function(){return this.children};a.prototype.shouldUpdateChildren=
function(){return!0};a.prototype.updateChildren=function(a){var b=this._childrenDict||null,d=this._childrenDict=null,e=this._orderedChildKeys;e.length=0;if(a){Array.isArray(a)||(W[0]=a,a=W);for(var g=0,f=a.length;g<f;g++){var h=a[g];if(h){d||(d=this._childrenDict=Object.create(null));var l=S(h),k=l?h.props:h;l=l?h.type:h.facade;h=h.key;if(!h){var p=0;do h="auto:"+l.name+":"+p++;while(d[h])}if("production"!==process.env.NODE_ENV&&"function"!==typeof l)throw Error('All scene objects must have a "facade" property pointing to a class/constructor');
if(d[h])for(console.warn("Duplicate key in children: "+h);d[h];)h+="|dupe";p=k.transition;var q=k.animation;if(p||q||k.exitAnimation)l=U(l);k.pointerStates&&(l=V(l));var n=b&&b[h];n&&n.constructor===l?l=n:(n&&n.destructor(),l=new l(this));l.transition=p;l.animation=q;for(var t in k)k.hasOwnProperty(t)&&!c.isSpecialDescriptorProperty(t)&&(l[t]=k[t]);d[h]=l;e.push(h);l.afterUpdate()}}}if(b)for(var r in b)d&&d[r]||b[r].destructor()};a.prototype.getChildByKey=function(a){var b=this._childrenDict;return b&&
b[a]||null};a.prototype.traverse=function(a,b){a.call(b,this);for(var d=this._orderedChildKeys,e=this._childrenDict,c=0,f=d.length;c<f;c++)e[d[c]].traverse(a,b)};a.prototype.forEachChild=function(a,b){for(var d=this._orderedChildKeys,c=this._childrenDict,e=0,f=d.length;e<f;e++)a.call(b,c[d[e]],d[e])};a.prototype.destructor=function(){this.isDestroying=!0;var a=this._childrenDict;if(a)for(var b in a)a[b].destructor();c.prototype.destructor.call(this)};return a}(p),y="onMouseOver onMouseOut onMouseMove onDragStart onDrag onDragEnter onDragOver onDragLeave".split(" "),
E="onMouseDown onMouseUp onClick onDoubleClick onDrop onDragEnd onWheel".split(" "),X=E.map(G),Y=y.map(G);y=y.concat(E);var Z=Y.concat(X),N=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.interceptsPointerEvents=function(a){if(!1===this.pointerEvents)return!1;if(this.pointerEvents)return!0;for(var b=0,d=Z.length;b<d;b++)if(a.hasFacadeListenersOfType(this,Z[b]))return!0};return a}(M);Object.defineProperty(N.prototype,
"isPointerEventTarget",{value:!0});y.forEach(function(c){p.defineEventProperty(N,c,G(c))});var ka={},la=["mousemove","mouseout","touchmove"],ma="mousedown mouseup click dblclick wheel touchstart touchend touchcancel".split(" "),aa=["mouseup","touchend","touchcancel"],na={touchstart:"mousedown",touchend:"mouseup",touchcancel:"mouseup"},oa="clientX clientY screenX screenY pageX pageY".split(" "),A=function(c,a,e,b,d){var m=this,g;for(g in c)"function"!==typeof c[g]&&(this[g]=c[g]);this.target=e;this.relatedTarget=
b;this.type=a;this.nativeEvent=c;x(this,d);if(c.touches){var f=H(c)?c.changedTouches:c.touches;1===f.length&&oa.forEach(function(b){m[b]=f[0][b]})}};A.prototype.preventDefault=function(){this.defaultPrevented=!0;this.nativeEvent.preventDefault()};A.prototype.stopPropagation=function(){this.propagationStopped=!0;this.nativeEvent.stopPropagation()};y=function(c){function a(b){c.call(this,null);this.width=this.height=1;this._element=b;this._htmlOverlays=Object.create(null);this.eventRegistry=new ea;
this._onPointerMotionEvent=this._onPointerMotionEvent.bind(this);this._onPointerActionEvent=this._onPointerActionEvent.bind(this);this._onDropEvent=this._onDropEvent.bind(this);this._togglePointerListeners(!0)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;var e={renderingScheduler:{configurable:!0}};a.prototype.afterUpdate=function(){this._queueRender();c.prototype.afterUpdate.call(this)};a.prototype.onNotifyWorld=function(b,a,c){(a=this._notifyWorldHandlers[a])&&
a.call(this,b,c)};a.prototype._isContinuousRender=function(){return this.continuousRender};e.renderingScheduler.set=function(b){b=b||window;if(b!==this.renderingScheduler){var a=this._nextFrameTimer;a&&(this.renderingScheduler.cancelAnimationFrame(a),this._nextFrameTimer=null);this._renderingScheduler=b}};e.renderingScheduler.get=function(){return this._renderingScheduler||window};a.prototype._queueRender=function(){var b=this;if(!this._nextFrameTimer){var a=this._nextFrameHandler||(this._nextFrameHandler=
function(){for(var a=[],d=arguments.length;d--;)a[d]=arguments[d];d=b.onStatsUpdate;var c=b.onBeforeRender,e=b.onAfterRender,k=d&&Date.now();c&&c(b);b.doRender.apply(b,a);d&&(a=Date.now(),d({"Render CPU Time (ms)":a-k,"Time Between Frames (ms)":b._lastFrameTime?a-b._lastFrameTime:"?",FPS:b._lastFrameTime?Math.round(1E3/(a-b._lastFrameTime)):"?"}),b._lastFrameTime=a);b._doRenderHtmlItems();e&&e(b);b._nextFrameTimer=null;b._isContinuousRender()&&b._queueRender()});this._nextFrameTimer=this.renderingScheduler.requestAnimationFrame(a)}};
a.prototype.doRender=function(){};a.prototype.getFacadeUserSpaceXYZ=function(b){};a.prototype._doRenderHtmlItems=function(){if(this.renderHtmlItems){var b=[],a=this._htmlOverlays,c;for(c in a){var e=a[c],f=this.getFacadeUserSpaceXYZ(e);0<=f.z&&(f.key=e.$facadeId,f.html=e.html,f.exact=e.exact,b.push(f))}this.renderHtmlItems(b)}};a.prototype._normalizePointerEvent=function(b){};a.prototype._onPointerMotionEvent=function(b){this._normalizePointerEvent(b);var a=this._getPointerEventState(b);if(Y.some(this.eventRegistry.hasAnyListenersOfType)){var c=
"mouseout"===b.type||H(b)?null:this._findHoverTarget(b),e=a.hoveredFacade,f=a.hoveredFacade=c&&c.facade,h=a.dragInfo;h&&(h.dragStartFired||(this._firePointerEvent("dragstart",h.dragStartEvent,h.draggedFacade,null,c),h.dragStartFired=!0),this._firePointerEvent("drag",b,h.draggedFacade,null,c));f!==e&&(e&&(this._firePointerEvent("mouseout",b,e,f,c),h&&this._firePointerEvent("dragleave",b,e,f,c)),f&&(this._firePointerEvent("mouseover",b,f,e,c),h&&this._firePointerEvent("dragenter",b,f,e,c)));f&&(this._firePointerEvent("mousemove",
b,f,null,c),h&&this._firePointerEvent("dragover",b,f,null,c))}(c=a.tapInfo)&&"touchmove"===b.type&&(b=b.changedTouches[0])&&10<Math.sqrt(Math.pow(b.clientX-c.x,2)+Math.pow(b.clientY-c.y,2))&&(a.tapInfo=null)};a.prototype._onPointerActionEvent=function(b){this._normalizePointerEvent(b);-1<aa.indexOf(b.type)&&this._onDropEvent(b);"touchstart"===b.type&&(1===b.touches.length&&this._onPointerMotionEvent(b),this._enableContextMenu(!1));var a=this.eventRegistry;if(a.hasAnyListenersOfType("dragstart")||
X.some(a.hasAnyListenersOfType)){var c=this._findHoverTarget(b),e=c&&c.facade;if(e){var f=this._getPointerEventState(b);this._firePointerEvent(na[b.type]||b.type,b,e,null,c);if(a.findBubblingEventTarget(e,"click")||a.findBubblingEventTarget(e,"dblclick")){var h=f.tapInfo;"touchstart"===b.type&&1===b.touches.length?f.tapInfo={facade:e,x:b.touches[0].clientX,y:b.touches[0].clientY,startTime:Date.now(),isDblClick:h&&300>Date.now()-h.startTime}:h&&h.facade===e&&"touchend"===b.type&&0===b.touches.length&&
1===b.changedTouches.length&&300>Date.now()-h.startTime&&(this._firePointerEvent("click",b,e,null,c),h.isDblClick&&this._firePointerEvent("dblclick",b,e,null,c))}if("mousedown"===b.type||"touchstart"===b.type)if(a=a.findBubblingEventTarget(e,"dragstart"))c=new A(b,"dragstart",a,null,{intersection:c}),f.dragInfo={draggedFacade:a,dragStartFired:!1,dragStartEvent:c},this._toggleDropListeners(!0)}b.preventDefault()}H(b)&&(1===b.changedTouches.length&&this._onPointerMotionEvent(b),this._enableContextMenu(!0))};
a.prototype._onDropEvent=function(b){var a=this._getPointerEventState(b),c=a.dragInfo;if(c){this._normalizePointerEvent(b);var e=this._findHoverTarget(b),f=e&&e.facade;f&&this._firePointerEvent("drop",b,f,null,e);this._firePointerEvent("dragend",b,c.draggedFacade,null,e);this._toggleDropListeners(!1);a.dragInfo=null}};a.prototype._firePointerEvent=function(b,a,c,e,f){b=a instanceof A?a:new A(a,b,c,e,{bubbles:!0,intersection:f});this.eventRegistry.dispatchEventOnFacade(c,b)};a.prototype._getPointerEventState=
function(b){var a=this._pointerEventStates||(this._pointerEventStates=new WeakMap);b=b.eventSource||ka;var c=a.get(b);c||a.set(b,c={});return c};a.prototype._toggleDropListeners=function(b){var a=this;aa.forEach(function(c){document[(b?"add":"remove")+"EventListener"](c,a._onDropEvent,!0)})};a.prototype._togglePointerListeners=function(b){var a=this,c=this._element;if(c&&b!==this._pointerListenersAttached){var e=(b?"add":"remove")+"EventListener";la.forEach(function(b){c[e](b,a._onPointerMotionEvent,
!1)});ma.forEach(function(b){c[e](b,a._onPointerActionEvent,!1)});this._pointerListenersAttached=b}};a.prototype._enableContextMenu=function(b){var a=this._element;if(a)a[(b?"remove":"add")+"EventListener"]("contextmenu",fa,!0)};a.prototype.getFacadesAtEvent=function(b,a){throw Error("getFacadesAtEvent: no impl");};a.prototype._findHoverTarget=function(b){var a=this;if(b.touches&&1<b.touches.length)return null;if(b=this.getFacadesAtEvent(b,function(b){return b.isPointerEventTarget&&b.interceptsPointerEvents(a.eventRegistry)})){for(var c=
b[0],e=1;e<b.length;e++)if(b[e].distance<c.distance||b[e].distance===c.distance&&(b[e].distanceBias||0)<(c.distanceBias||0))c=b[e];return c}return null};a.prototype.destructor=function(){this._nextFrameTimer&&this.renderingScheduler.cancelAnimationFrame(this._nextFrameTimer);this._togglePointerListeners(!1);this._toggleDropListeners(!1);c.prototype.destructor.call(this)};Object.defineProperties(a.prototype,e);return a}(M);Object.defineProperty(y.prototype,"isWorld",{value:!0});y.prototype._notifyWorldHandlers=
{needsRender:function(){this._queueRender()},addEventListener:function(c,a){this.eventRegistry.addListenerForFacade(c,a.type,a.handler)},removeEventListener:function(c,a){this.eventRegistry.removeListenerForFacade(c,a.type,a.handler)},removeAllEventListeners:function(c){this.eventRegistry.removeAllListenersForFacade(c)},dispatchEvent:function(c,a){a instanceof A||(a=new A(a,a.type,a.target,a.relatedTarget));this.eventRegistry.dispatchEventOnFacade(c,a)},addHtmlOverlay:function(c){this._htmlOverlays[c.$facadeId]=
c},removeHtmlOverlay:function(c){delete this._htmlOverlays[c.$facadeId]},statsUpdate:function(c,a){(c=this.onStatsUpdate)&&c(a)}};var pa={position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",transformStyle:"preserve-3d"},O=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.shouldComponentUpdate=function(a){return a.html!==this.props.html||!0===(a.html.props&&a.html.props.shouldUpdateOnMove)};
a.prototype.render=function(){var a=this.props.html;return"string"===typeof a?k.createElement("span",null,a):k.cloneElement(a)};return a}(k.Component);O.displayName="Canvas3D.HtmlOverlayContent";O.propTypes={html:q.node};var ba=function(c){function a(a){c.call(this,a);this.setItems=this.setItems.bind(this);this.state={items:null}}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.shouldComponentUpdate=function(a,b){a=this.state;return b.items&&b.items.length||
a.items&&a.items.length};a.prototype.setItems=function(a){var b=this.state.items;(a&&a.length||b&&b.length)&&this.setState({items:a||null})};a.prototype.render=function(){var a=this.state.items,b=Math.round;return a&&a.length?k.createElement("div",{className:"troika_html_overlay",style:pa},a.map(function(a){var c=a.key,e=a.html,d=a.x,h=a.y,l=a.z;a.exact||(d=b(d),h=b(h));return k.createElement("div",{key:c,style:{position:"absolute",transform:"translate3d("+d+"px, "+h+"px, "+-l+"px)"}},k.createElement(O,
{html:e}))})):null};return a}(k.Component);ba.displayName="Canvas3D.HtmlOverlay";var qa={position:"absolute",top:0,right:0,background:"rgba(0,0,0,.5)",font:"11px sans-serif",padding:10},ra=function(c){function a(a){c.call(this,a);this.state={stats:{}}}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.setStats=function(a){this.setState({stats:a})};a.prototype.render=function(){var a=this.state.stats;return k.createElement("div",{style:qa},Object.keys(a).sort().map(function(b){return k.createElement("div",
{key:b},b+": "+a[b])}))};return a}(k.Component),sa={width:"100%",height:"100%"};E=function(c){function a(a){c.call(this,a);this._stats={};this.updateStats=this.updateStats.bind(this);this.renderHtmlItems=this.renderHtmlItems.bind(this);this._bindHtmlOverlayRef=this._bindHtmlOverlayRef.bind(this);this._bindCanvasRef=this._bindCanvasRef.bind(this);this._bindStatsRef=this._bindStatsRef.bind(this)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.componentDidUpdate=
function(){this.updateWorld()};a.prototype.initWorld=function(a){a=new this.props.worldFacade(a);a.renderHtmlItems=this.renderHtmlItems;return a};a.prototype.updateWorld=function(){var a=this._world;if(a){var b=this.props,c=b.stats,k=c&&Date.now();a.width=b.width;a.height=b.height;a.pixelRatio=b.pixelRatio;a.continuousRender=b.continuousRender;a.onStatsUpdate=c?this.updateStats:null;x(a,b.worldProps);a.afterUpdate();c&&this.updateStats({"Last World Update (ms)":Date.now()-k})}};a.prototype.destroyWorld=
function(){this._world&&(this._world.destructor(),delete this._world);clearTimeout(this._statsDelay)};a.prototype.renderHtmlItems=function(a){this._htmlOverlayRef&&this._htmlOverlayRef.setItems(a)};a.prototype.updateStats=function(a){var b=this;this._stats=x({},this._stats,a);this._statsDelay||(this._statsDelay=setTimeout(function(){b._statsDelay=null;var a=b._statsRef;a&&a.setStats(b._stats)},250))};a.prototype._bindHtmlOverlayRef=function(a){this._htmlOverlayRef=a};a.prototype._bindCanvasRef=function(a){if(a)try{this._world=
this.initWorld(a),this.updateWorld()}catch(d){console.warn("Troika."+this.constructor.displayName+": world init failed, using fallback content.",d),this._failedWorldInit=!0,this._world=null,this.forceUpdate()}else this.destroyWorld();var b=this.props.onCanvasRef;b&&b(a)};a.prototype._bindStatsRef=function(a){this._statsRef=a};a.prototype.render=function(){var a=this.props;return k.createElement("div",{className:"troika "+(a.className||""),style:{position:"relative",overflow:"hidden",width:a.width,
height:a.height,cursor:a.cursor,userSelect:"none"}},this._failedWorldInit?this.props.children:k.createElement("canvas",{className:"troika_canvas",ref:this._bindCanvasRef,style:a.canvasStyle||sa}),k.createElement(ba,{ref:this._bindHtmlOverlayRef}),a.stats?k.createElement(ra,{ref:this._bindStatsRef}):null)};return a}(k.Component);E.commonPropTypes={width:q.number.isRequired,height:q.number.isRequired,pixelRatio:q.number,worldFacade:q.func,worldProps:q.object,canvasStyle:q.object,className:q.string,
continuousRender:q.bool,onCanvasRef:q.func,stats:q.bool,cursor:q.string};u.Facade=p;u.ListFacade=ja;u.ParentFacade=M;u.PointerEventTarget=N;u.ReactCanvasBase=E;u.WorldBaseFacade=y;u.utils=J;Object.defineProperty(u,"__esModule",{value:!0})})
