{"ast":null,"code":"/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n */\nimport { EventDispatcher, MOUSE, Quaternion, Vector2, Vector3 } from \"../../../build/three.module.js\";\n\nvar TrackballControls = function TrackballControls(object, domElement) {\n  if (domElement === undefined) console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\n  if (domElement === document) console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n\n  var _this = this;\n\n  var STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    ZOOM: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_ZOOM_PAN: 4\n  };\n  this.object = object;\n  this.domElement = domElement; // API\n\n  this.enabled = true;\n  this.screen = {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  };\n  this.rotateSpeed = 1.0;\n  this.zoomSpeed = 1.2;\n  this.panSpeed = 0.3;\n  this.noRotate = false;\n  this.noZoom = false;\n  this.noPan = false;\n  this.staticMoving = false;\n  this.dynamicDampingFactor = 0.2;\n  this.minDistance = 0;\n  this.maxDistance = Infinity;\n  this.keys = [65\n  /*A*/\n  , 83\n  /*S*/\n  , 68\n  /*D*/\n  ];\n  this.mouseButtons = {\n    LEFT: MOUSE.ROTATE,\n    MIDDLE: MOUSE.ZOOM,\n    RIGHT: MOUSE.PAN\n  }; // internals\n\n  this.target = new Vector3();\n  var EPS = 0.000001;\n  var lastPosition = new Vector3();\n  var lastZoom = 1;\n\n  var _state = STATE.NONE,\n      _keyState = STATE.NONE,\n      _eye = new Vector3(),\n      _movePrev = new Vector2(),\n      _moveCurr = new Vector2(),\n      _lastAxis = new Vector3(),\n      _lastAngle = 0,\n      _zoomStart = new Vector2(),\n      _zoomEnd = new Vector2(),\n      _touchZoomDistanceStart = 0,\n      _touchZoomDistanceEnd = 0,\n      _panStart = new Vector2(),\n      _panEnd = new Vector2(); // for reset\n\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.up0 = this.object.up.clone();\n  this.zoom0 = this.object.zoom; // events\n\n  var changeEvent = {\n    type: 'change'\n  };\n  var startEvent = {\n    type: 'start'\n  };\n  var endEvent = {\n    type: 'end'\n  }; // methods\n\n  this.handleResize = function () {\n    var box = this.domElement.getBoundingClientRect(); // adjustments come from similar code in the jquery offset() function\n\n    var d = this.domElement.ownerDocument.documentElement;\n    this.screen.left = box.left + window.pageXOffset - d.clientLeft;\n    this.screen.top = box.top + window.pageYOffset - d.clientTop;\n    this.screen.width = box.width;\n    this.screen.height = box.height;\n  };\n\n  var getMouseOnScreen = function () {\n    var vector = new Vector2();\n    return function getMouseOnScreen(pageX, pageY) {\n      vector.set((pageX - _this.screen.left) / _this.screen.width, (pageY - _this.screen.top) / _this.screen.height);\n      return vector;\n    };\n  }();\n\n  var getMouseOnCircle = function () {\n    var vector = new Vector2();\n    return function getMouseOnCircle(pageX, pageY) {\n      vector.set((pageX - _this.screen.width * 0.5 - _this.screen.left) / (_this.screen.width * 0.5), (_this.screen.height + 2 * (_this.screen.top - pageY)) / _this.screen.width // screen.width intentional\n      );\n      return vector;\n    };\n  }();\n\n  this.rotateCamera = function () {\n    var axis = new Vector3(),\n        quaternion = new Quaternion(),\n        eyeDirection = new Vector3(),\n        objectUpDirection = new Vector3(),\n        objectSidewaysDirection = new Vector3(),\n        moveDirection = new Vector3(),\n        angle;\n    return function rotateCamera() {\n      moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\n      angle = moveDirection.length();\n\n      if (angle) {\n        _eye.copy(_this.object.position).sub(_this.target);\n\n        eyeDirection.copy(_eye).normalize();\n        objectUpDirection.copy(_this.object.up).normalize();\n        objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n        objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\n        objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\n        moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n        axis.crossVectors(moveDirection, _eye).normalize();\n        angle *= _this.rotateSpeed;\n        quaternion.setFromAxisAngle(axis, angle);\n\n        _eye.applyQuaternion(quaternion);\n\n        _this.object.up.applyQuaternion(quaternion);\n\n        _lastAxis.copy(axis);\n\n        _lastAngle = angle;\n      } else if (!_this.staticMoving && _lastAngle) {\n        _lastAngle *= Math.sqrt(1.0 - _this.dynamicDampingFactor);\n\n        _eye.copy(_this.object.position).sub(_this.target);\n\n        quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\n\n        _eye.applyQuaternion(quaternion);\n\n        _this.object.up.applyQuaternion(quaternion);\n      }\n\n      _movePrev.copy(_moveCurr);\n    };\n  }();\n\n  this.zoomCamera = function () {\n    var factor;\n\n    if (_state === STATE.TOUCH_ZOOM_PAN) {\n      factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n      _touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n      if (_this.object.isPerspectiveCamera) {\n        _eye.multiplyScalar(factor);\n      } else if (_this.object.isOrthographicCamera) {\n        _this.object.zoom *= factor;\n\n        _this.object.updateProjectionMatrix();\n      } else {\n        console.warn('THREE.TrackballControls: Unsupported camera type');\n      }\n    } else {\n      factor = 1.0 + (_zoomEnd.y - _zoomStart.y) * _this.zoomSpeed;\n\n      if (factor !== 1.0 && factor > 0.0) {\n        if (_this.object.isPerspectiveCamera) {\n          _eye.multiplyScalar(factor);\n        } else if (_this.object.isOrthographicCamera) {\n          _this.object.zoom /= factor;\n\n          _this.object.updateProjectionMatrix();\n        } else {\n          console.warn('THREE.TrackballControls: Unsupported camera type');\n        }\n      }\n\n      if (_this.staticMoving) {\n        _zoomStart.copy(_zoomEnd);\n      } else {\n        _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\n      }\n    }\n  };\n\n  this.panCamera = function () {\n    var mouseChange = new Vector2(),\n        objectUp = new Vector3(),\n        pan = new Vector3();\n    return function panCamera() {\n      mouseChange.copy(_panEnd).sub(_panStart);\n\n      if (mouseChange.lengthSq()) {\n        if (_this.object.isOrthographicCamera) {\n          var scale_x = (_this.object.right - _this.object.left) / _this.object.zoom / _this.domElement.clientWidth;\n          var scale_y = (_this.object.top - _this.object.bottom) / _this.object.zoom / _this.domElement.clientWidth;\n          mouseChange.x *= scale_x;\n          mouseChange.y *= scale_y;\n        }\n\n        mouseChange.multiplyScalar(_eye.length() * _this.panSpeed);\n        pan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);\n        pan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));\n\n        _this.object.position.add(pan);\n\n        _this.target.add(pan);\n\n        if (_this.staticMoving) {\n          _panStart.copy(_panEnd);\n        } else {\n          _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(_this.dynamicDampingFactor));\n        }\n      }\n    };\n  }();\n\n  this.checkDistances = function () {\n    if (!_this.noZoom || !_this.noPan) {\n      if (_eye.lengthSq() > _this.maxDistance * _this.maxDistance) {\n        _this.object.position.addVectors(_this.target, _eye.setLength(_this.maxDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n\n      if (_eye.lengthSq() < _this.minDistance * _this.minDistance) {\n        _this.object.position.addVectors(_this.target, _eye.setLength(_this.minDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n    }\n  };\n\n  this.update = function () {\n    _eye.subVectors(_this.object.position, _this.target);\n\n    if (!_this.noRotate) {\n      _this.rotateCamera();\n    }\n\n    if (!_this.noZoom) {\n      _this.zoomCamera();\n    }\n\n    if (!_this.noPan) {\n      _this.panCamera();\n    }\n\n    _this.object.position.addVectors(_this.target, _eye);\n\n    if (_this.object.isPerspectiveCamera) {\n      _this.checkDistances();\n\n      _this.object.lookAt(_this.target);\n\n      if (lastPosition.distanceToSquared(_this.object.position) > EPS) {\n        _this.dispatchEvent(changeEvent);\n\n        lastPosition.copy(_this.object.position);\n      }\n    } else if (_this.object.isOrthographicCamera) {\n      _this.object.lookAt(_this.target);\n\n      if (lastPosition.distanceToSquared(_this.object.position) > EPS || lastZoom !== _this.object.zoom) {\n        _this.dispatchEvent(changeEvent);\n\n        lastPosition.copy(_this.object.position);\n        lastZoom = _this.object.zoom;\n      }\n    } else {\n      console.warn('THREE.TrackballControls: Unsupported camera type');\n    }\n  };\n\n  this.reset = function () {\n    _state = STATE.NONE;\n    _keyState = STATE.NONE;\n\n    _this.target.copy(_this.target0);\n\n    _this.object.position.copy(_this.position0);\n\n    _this.object.up.copy(_this.up0);\n\n    _this.object.zoom = _this.zoom0;\n\n    _this.object.updateProjectionMatrix();\n\n    _eye.subVectors(_this.object.position, _this.target);\n\n    _this.object.lookAt(_this.target);\n\n    _this.dispatchEvent(changeEvent);\n\n    lastPosition.copy(_this.object.position);\n    lastZoom = _this.object.zoom;\n  }; // listeners\n\n\n  function keydown(event) {\n    if (_this.enabled === false) return;\n    window.removeEventListener('keydown', keydown);\n\n    if (_keyState !== STATE.NONE) {\n      return;\n    } else if (event.keyCode === _this.keys[STATE.ROTATE] && !_this.noRotate) {\n      _keyState = STATE.ROTATE;\n    } else if (event.keyCode === _this.keys[STATE.ZOOM] && !_this.noZoom) {\n      _keyState = STATE.ZOOM;\n    } else if (event.keyCode === _this.keys[STATE.PAN] && !_this.noPan) {\n      _keyState = STATE.PAN;\n    }\n  }\n\n  function keyup() {\n    if (_this.enabled === false) return;\n    _keyState = STATE.NONE;\n    window.addEventListener('keydown', keydown, false);\n  }\n\n  function mousedown(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (_state === STATE.NONE) {\n      switch (event.button) {\n        case _this.mouseButtons.LEFT:\n          _state = STATE.ROTATE;\n          break;\n\n        case _this.mouseButtons.MIDDLE:\n          _state = STATE.ZOOM;\n          break;\n\n        case _this.mouseButtons.RIGHT:\n          _state = STATE.PAN;\n          break;\n\n        default:\n          _state = STATE.NONE;\n      }\n    }\n\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !_this.noRotate) {\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n\n      _movePrev.copy(_moveCurr);\n    } else if (state === STATE.ZOOM && !_this.noZoom) {\n      _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _zoomEnd.copy(_zoomStart);\n    } else if (state === STATE.PAN && !_this.noPan) {\n      _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _panEnd.copy(_panStart);\n    }\n\n    document.addEventListener('mousemove', mousemove, false);\n    document.addEventListener('mouseup', mouseup, false);\n\n    _this.dispatchEvent(startEvent);\n  }\n\n  function mousemove(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !_this.noRotate) {\n      _movePrev.copy(_moveCurr);\n\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n    } else if (state === STATE.ZOOM && !_this.noZoom) {\n      _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    } else if (state === STATE.PAN && !_this.noPan) {\n      _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    }\n  }\n\n  function mouseup(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    _state = STATE.NONE;\n    document.removeEventListener('mousemove', mousemove);\n    document.removeEventListener('mouseup', mouseup);\n\n    _this.dispatchEvent(endEvent);\n  }\n\n  function mousewheel(event) {\n    if (_this.enabled === false) return;\n    if (_this.noZoom === true) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.deltaMode) {\n      case 2:\n        // Zoom in pages\n        _zoomStart.y -= event.deltaY * 0.025;\n        break;\n\n      case 1:\n        // Zoom in lines\n        _zoomStart.y -= event.deltaY * 0.01;\n        break;\n\n      default:\n        // undefined, 0, assume pixels\n        _zoomStart.y -= event.deltaY * 0.00025;\n        break;\n    }\n\n    _this.dispatchEvent(startEvent);\n\n    _this.dispatchEvent(endEvent);\n  }\n\n  function touchstart(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n\n    switch (event.touches.length) {\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n\n      default:\n        // 2 or more\n        _state = STATE.TOUCH_ZOOM_PAN;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panStart.copy(getMouseOnScreen(x, y));\n\n        _panEnd.copy(_panStart);\n\n        break;\n    }\n\n    _this.dispatchEvent(startEvent);\n  }\n\n  function touchmove(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n      case 1:\n        _movePrev.copy(_moveCurr);\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        break;\n\n      default:\n        // 2 or more\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panEnd.copy(getMouseOnScreen(x, y));\n\n        break;\n    }\n  }\n\n  function touchend(event) {\n    if (_this.enabled === false) return;\n\n    switch (event.touches.length) {\n      case 0:\n        _state = STATE.NONE;\n        break;\n\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n    }\n\n    _this.dispatchEvent(endEvent);\n  }\n\n  function contextmenu(event) {\n    if (_this.enabled === false) return;\n    event.preventDefault();\n  }\n\n  this.dispose = function () {\n    this.domElement.removeEventListener('contextmenu', contextmenu, false);\n    this.domElement.removeEventListener('mousedown', mousedown, false);\n    this.domElement.removeEventListener('wheel', mousewheel, false);\n    this.domElement.removeEventListener('touchstart', touchstart, false);\n    this.domElement.removeEventListener('touchend', touchend, false);\n    this.domElement.removeEventListener('touchmove', touchmove, false);\n    document.removeEventListener('mousemove', mousemove, false);\n    document.removeEventListener('mouseup', mouseup, false);\n    window.removeEventListener('keydown', keydown, false);\n    window.removeEventListener('keyup', keyup, false);\n  };\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false);\n  this.domElement.addEventListener('mousedown', mousedown, false);\n  this.domElement.addEventListener('wheel', mousewheel, false);\n  this.domElement.addEventListener('touchstart', touchstart, false);\n  this.domElement.addEventListener('touchend', touchend, false);\n  this.domElement.addEventListener('touchmove', touchmove, false);\n  window.addEventListener('keydown', keydown, false);\n  window.addEventListener('keyup', keyup, false);\n  this.handleResize(); // force an update at start\n\n  this.update();\n};\n\nTrackballControls.prototype = Object.create(EventDispatcher.prototype);\nTrackballControls.prototype.constructor = TrackballControls;\nexport { TrackballControls };","map":{"version":3,"sources":["/Users/lairdkruger/Documents/Web Development/React Experiments/r3f-scroll-rig/node_modules/three/examples/jsm/controls/TrackballControls.js"],"names":["EventDispatcher","MOUSE","Quaternion","Vector2","Vector3","TrackballControls","object","domElement","undefined","console","warn","document","error","_this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MIDDLE","RIGHT","target","EPS","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","window","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","rotateCamera","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","angle","x","y","length","copy","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","Math","sqrt","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","panCamera","mouseChange","objectUp","pan","lengthSq","scale_x","right","clientWidth","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","dispatchEvent","reset","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","state","mousemove","mouseup","mousewheel","deltaMode","deltaY","touchstart","touches","dx","dy","touchmove","touchend","contextmenu","dispose","prototype","Object","create","constructor"],"mappings":"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","sourcesContent":["/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n */\n\nimport {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tVector2,\n\tVector3\n} from \"../../../build/three.module.js\";\n\nvar TrackballControls = function ( object, domElement ) {\n\n\tif ( domElement === undefined ) console.warn( 'THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.' );\n\tif ( domElement === document ) console.error( 'THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\tvar _this = this;\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\tthis.object = object;\n\tthis.domElement = domElement;\n\n\t// API\n\n\tthis.enabled = true;\n\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\tthis.rotateSpeed = 1.0;\n\tthis.zoomSpeed = 1.2;\n\tthis.panSpeed = 0.3;\n\n\tthis.noRotate = false;\n\tthis.noZoom = false;\n\tthis.noPan = false;\n\n\tthis.staticMoving = false;\n\tthis.dynamicDampingFactor = 0.2;\n\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.ZOOM, RIGHT: MOUSE.PAN };\n\n\t// internals\n\n\tthis.target = new Vector3();\n\n\tvar EPS = 0.000001;\n\n\tvar lastPosition = new Vector3();\n\tvar lastZoom = 1;\n\n\tvar _state = STATE.NONE,\n\t\t_keyState = STATE.NONE,\n\n\t\t_eye = new Vector3(),\n\n\t\t_movePrev = new Vector2(),\n\t\t_moveCurr = new Vector2(),\n\n\t\t_lastAxis = new Vector3(),\n\t\t_lastAngle = 0,\n\n\t\t_zoomStart = new Vector2(),\n\t\t_zoomEnd = new Vector2(),\n\n\t\t_touchZoomDistanceStart = 0,\n\t\t_touchZoomDistanceEnd = 0,\n\n\t\t_panStart = new Vector2(),\n\t\t_panEnd = new Vector2();\n\n\t// for reset\n\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.up0 = this.object.up.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\n\t// methods\n\n\tthis.handleResize = function () {\n\n\t\tvar box = this.domElement.getBoundingClientRect();\n\t\t// adjustments come from similar code in the jquery offset() function\n\t\tvar d = this.domElement.ownerDocument.documentElement;\n\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\tthis.screen.width = box.width;\n\t\tthis.screen.height = box.height;\n\n\t};\n\n\tvar getMouseOnScreen = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\n\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tvar getMouseOnCircle = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\n\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tthis.rotateCamera = ( function () {\n\n\t\tvar axis = new Vector3(),\n\t\t\tquaternion = new Quaternion(),\n\t\t\teyeDirection = new Vector3(),\n\t\t\tobjectUpDirection = new Vector3(),\n\t\t\tobjectSidewaysDirection = new Vector3(),\n\t\t\tmoveDirection = new Vector3(),\n\t\t\tangle;\n\n\t\treturn function rotateCamera() {\n\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\tangle = moveDirection.length();\n\n\t\t\tif ( angle ) {\n\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\n\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\tangle *= _this.rotateSpeed;\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t_lastAngle = angle;\n\n\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\n\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t}\n\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t};\n\n\t}() );\n\n\n\tthis.zoomCamera = function () {\n\n\t\tvar factor;\n\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t_this.object.zoom *= factor;\n\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\n\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\t_this.object.zoom /= factor;\n\t\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t} else {\n\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.panCamera = ( function () {\n\n\t\tvar mouseChange = new Vector2(),\n\t\t\tobjectUp = new Vector3(),\n\t\t\tpan = new Vector3();\n\n\t\treturn function panCamera() {\n\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\tif ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\tvar scale_x = ( _this.object.right - _this.object.left ) / _this.object.zoom / _this.domElement.clientWidth;\n\t\t\t\t\tvar scale_y = ( _this.object.top - _this.object.bottom ) / _this.object.zoom / _this.domElement.clientWidth;\n\n\t\t\t\t\tmouseChange.x *= scale_x;\n\t\t\t\t\tmouseChange.y *= scale_y;\n\n\t\t\t\t}\n\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\n\n\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\n\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\t_this.object.position.add( pan );\n\t\t\t\t_this.target.add( pan );\n\n\t\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t}() );\n\n\tthis.checkDistances = function () {\n\n\t\tif ( ! _this.noZoom || ! _this.noPan ) {\n\n\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.update = function () {\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\tif ( ! _this.noRotate ) {\n\n\t\t\t_this.rotateCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noZoom ) {\n\n\t\t\t_this.zoomCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noPan ) {\n\n\t\t\t_this.panCamera();\n\n\t\t}\n\n\t\t_this.object.position.addVectors( _this.target, _eye );\n\n\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t_this.checkDistances();\n\n\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\n\n\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( _this.object.position );\n\n\t\t\t}\n\n\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS || lastZoom !== _this.object.zoom ) {\n\n\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( _this.object.position );\n\t\t\t\tlastZoom = _this.object.zoom;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t}\n\n\t};\n\n\tthis.reset = function () {\n\n\t\t_state = STATE.NONE;\n\t\t_keyState = STATE.NONE;\n\n\t\t_this.target.copy( _this.target0 );\n\t\t_this.object.position.copy( _this.position0 );\n\t\t_this.object.up.copy( _this.up0 );\n\t\t_this.object.zoom = _this.zoom0;\n\n\t\t_this.object.updateProjectionMatrix();\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\t_this.object.lookAt( _this.target );\n\n\t\t_this.dispatchEvent( changeEvent );\n\n\t\tlastPosition.copy( _this.object.position );\n\t\tlastZoom = _this.object.zoom;\n\n\t};\n\n\t// listeners\n\n\tfunction keydown( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\twindow.removeEventListener( 'keydown', keydown );\n\n\t\tif ( _keyState !== STATE.NONE ) {\n\n\t\t\treturn;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.ROTATE ] && ! _this.noRotate ) {\n\n\t\t\t_keyState = STATE.ROTATE;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.ZOOM ] && ! _this.noZoom ) {\n\n\t\t\t_keyState = STATE.ZOOM;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.PAN ] && ! _this.noPan ) {\n\n\t\t\t_keyState = STATE.PAN;\n\n\t\t}\n\n\t}\n\n\tfunction keyup() {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\t_keyState = STATE.NONE;\n\n\t\twindow.addEventListener( 'keydown', keydown, false );\n\n\t}\n\n\tfunction mousedown( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( _state === STATE.NONE ) {\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase _this.mouseButtons.LEFT:\n\t\t\t\t\t_state = STATE.ROTATE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase _this.mouseButtons.MIDDLE:\n\t\t\t\t\t_state = STATE.ZOOM;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase _this.mouseButtons.RIGHT:\n\t\t\t\t\t_state = STATE.PAN;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t_state = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_panEnd.copy( _panStart );\n\n\t\t}\n\n\t\tdocument.addEventListener( 'mousemove', mousemove, false );\n\t\tdocument.addEventListener( 'mouseup', mouseup, false );\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction mousemove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t}\n\n\t}\n\n\tfunction mouseup( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\t_state = STATE.NONE;\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove );\n\t\tdocument.removeEventListener( 'mouseup', mouseup );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction mousewheel( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tif ( _this.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.deltaMode ) {\n\n\t\t\tcase 2:\n\t\t\t\t// Zoom in pages\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t// Zoom in lines\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction touchstart( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction touchmove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction touchend( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 0:\n\t\t\t\t_state = STATE.NONE;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction contextmenu( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\n\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\n\n\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\n\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\n\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\n\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\n\n\t\twindow.removeEventListener( 'keydown', keydown, false );\n\t\twindow.removeEventListener( 'keyup', keyup, false );\n\n\t};\n\n\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\n\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\twindow.addEventListener( 'keydown', keydown, false );\n\twindow.addEventListener( 'keyup', keyup, false );\n\n\tthis.handleResize();\n\n\t// force an update at start\n\tthis.update();\n\n};\n\nTrackballControls.prototype = Object.create( EventDispatcher.prototype );\nTrackballControls.prototype.constructor = TrackballControls;\n\nexport { TrackballControls };\n"]},"metadata":{},"sourceType":"module"}