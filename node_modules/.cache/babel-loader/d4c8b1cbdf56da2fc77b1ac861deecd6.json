{"ast":null,"code":"/**\n * @author arodic / https://github.com/arodic\n */\nimport { BoxBufferGeometry, BufferGeometry, Color, CylinderBufferGeometry, DoubleSide, Euler, Float32BufferAttribute, Line, LineBasicMaterial, Matrix4, Mesh, MeshBasicMaterial, Object3D, OctahedronBufferGeometry, PlaneBufferGeometry, Quaternion, Raycaster, SphereBufferGeometry, TorusBufferGeometry, Vector3 } from \"../../../build/three.module.js\";\n\nvar TransformControls = function TransformControls(camera, domElement) {\n  if (domElement === undefined) {\n    console.warn('THREE.TransformControls: The second parameter \"domElement\" is now mandatory.');\n    domElement = document;\n  }\n\n  Object3D.call(this);\n  this.visible = false;\n  this.domElement = domElement;\n\n  var _gizmo = new TransformControlsGizmo();\n\n  this.add(_gizmo);\n\n  var _plane = new TransformControlsPlane();\n\n  this.add(_plane);\n  var scope = this; // Define properties with getters/setter\n  // Setting the defined property will automatically trigger change event\n  // Defined properties are passed down to gizmo and plane\n\n  defineProperty(\"camera\", camera);\n  defineProperty(\"object\", undefined);\n  defineProperty(\"enabled\", true);\n  defineProperty(\"axis\", null);\n  defineProperty(\"mode\", \"translate\");\n  defineProperty(\"translationSnap\", null);\n  defineProperty(\"rotationSnap\", null);\n  defineProperty(\"scaleSnap\", null);\n  defineProperty(\"space\", \"world\");\n  defineProperty(\"size\", 1);\n  defineProperty(\"dragging\", false);\n  defineProperty(\"showX\", true);\n  defineProperty(\"showY\", true);\n  defineProperty(\"showZ\", true);\n  var changeEvent = {\n    type: \"change\"\n  };\n  var mouseDownEvent = {\n    type: \"mouseDown\"\n  };\n  var mouseUpEvent = {\n    type: \"mouseUp\",\n    mode: scope.mode\n  };\n  var objectChangeEvent = {\n    type: \"objectChange\"\n  }; // Reusable utility variables\n\n  var raycaster = new Raycaster();\n\n  function intersectObjectWithRay(object, raycaster, includeInvisible) {\n    var allIntersections = raycaster.intersectObject(object, true);\n\n    for (var i = 0; i < allIntersections.length; i++) {\n      if (allIntersections[i].object.visible || includeInvisible) {\n        return allIntersections[i];\n      }\n    }\n\n    return false;\n  }\n\n  var _tempVector = new Vector3();\n\n  var _tempVector2 = new Vector3();\n\n  var _tempQuaternion = new Quaternion();\n\n  var _unit = {\n    X: new Vector3(1, 0, 0),\n    Y: new Vector3(0, 1, 0),\n    Z: new Vector3(0, 0, 1)\n  };\n  var pointStart = new Vector3();\n  var pointEnd = new Vector3();\n  var offset = new Vector3();\n  var rotationAxis = new Vector3();\n  var startNorm = new Vector3();\n  var endNorm = new Vector3();\n  var rotationAngle = 0;\n  var cameraPosition = new Vector3();\n  var cameraQuaternion = new Quaternion();\n  var cameraScale = new Vector3();\n  var parentPosition = new Vector3();\n  var parentQuaternion = new Quaternion();\n  var parentQuaternionInv = new Quaternion();\n  var parentScale = new Vector3();\n  var worldPositionStart = new Vector3();\n  var worldQuaternionStart = new Quaternion();\n  var worldScaleStart = new Vector3();\n  var worldPosition = new Vector3();\n  var worldQuaternion = new Quaternion();\n  var worldQuaternionInv = new Quaternion();\n  var worldScale = new Vector3();\n  var eye = new Vector3();\n  var positionStart = new Vector3();\n  var quaternionStart = new Quaternion();\n  var scaleStart = new Vector3(); // TODO: remove properties unused in plane and gizmo\n\n  defineProperty(\"worldPosition\", worldPosition);\n  defineProperty(\"worldPositionStart\", worldPositionStart);\n  defineProperty(\"worldQuaternion\", worldQuaternion);\n  defineProperty(\"worldQuaternionStart\", worldQuaternionStart);\n  defineProperty(\"cameraPosition\", cameraPosition);\n  defineProperty(\"cameraQuaternion\", cameraQuaternion);\n  defineProperty(\"pointStart\", pointStart);\n  defineProperty(\"pointEnd\", pointEnd);\n  defineProperty(\"rotationAxis\", rotationAxis);\n  defineProperty(\"rotationAngle\", rotationAngle);\n  defineProperty(\"eye\", eye);\n  {\n    domElement.addEventListener(\"mousedown\", onPointerDown, false);\n    domElement.addEventListener(\"touchstart\", onPointerDown, false);\n    domElement.addEventListener(\"mousemove\", onPointerHover, false);\n    domElement.addEventListener(\"touchmove\", onPointerHover, false);\n    domElement.addEventListener(\"touchmove\", onPointerMove, false);\n    scope.domElement.ownerDocument.addEventListener(\"mouseup\", onPointerUp, false);\n    domElement.addEventListener(\"touchend\", onPointerUp, false);\n    domElement.addEventListener(\"touchcancel\", onPointerUp, false);\n    domElement.addEventListener(\"touchleave\", onPointerUp, false);\n  }\n\n  this.dispose = function () {\n    domElement.removeEventListener(\"mousedown\", onPointerDown);\n    domElement.removeEventListener(\"touchstart\", onPointerDown);\n    domElement.removeEventListener(\"mousemove\", onPointerHover);\n    scope.domElement.ownerDocument.removeEventListener(\"mousemove\", onPointerMove);\n    domElement.removeEventListener(\"touchmove\", onPointerHover);\n    domElement.removeEventListener(\"touchmove\", onPointerMove);\n    scope.domElement.ownerDocument.removeEventListener(\"mouseup\", onPointerUp);\n    domElement.removeEventListener(\"touchend\", onPointerUp);\n    domElement.removeEventListener(\"touchcancel\", onPointerUp);\n    domElement.removeEventListener(\"touchleave\", onPointerUp);\n    this.traverse(function (child) {\n      if (child.geometry) child.geometry.dispose();\n      if (child.material) child.material.dispose();\n    });\n  }; // Set current object\n\n\n  this.attach = function (object) {\n    this.object = object;\n    this.visible = true;\n    return this;\n  }; // Detatch from object\n\n\n  this.detach = function () {\n    this.object = undefined;\n    this.visible = false;\n    this.axis = null;\n    return this;\n  }; // Defined getter, setter and store for a property\n\n\n  function defineProperty(propName, defaultValue) {\n    var propValue = defaultValue;\n    Object.defineProperty(scope, propName, {\n      get: function get() {\n        return propValue !== undefined ? propValue : defaultValue;\n      },\n      set: function set(value) {\n        if (propValue !== value) {\n          propValue = value;\n          _plane[propName] = value;\n          _gizmo[propName] = value;\n          scope.dispatchEvent({\n            type: propName + \"-changed\",\n            value: value\n          });\n          scope.dispatchEvent(changeEvent);\n        }\n      }\n    });\n    scope[propName] = defaultValue;\n    _plane[propName] = defaultValue;\n    _gizmo[propName] = defaultValue;\n  } // updateMatrixWorld  updates key transformation variables\n\n\n  this.updateMatrixWorld = function () {\n    if (this.object !== undefined) {\n      this.object.updateMatrixWorld();\n\n      if (this.object.parent === null) {\n        console.error('TransformControls: The attached 3D object must be a part of the scene graph.');\n      } else {\n        this.object.parent.matrixWorld.decompose(parentPosition, parentQuaternion, parentScale);\n      }\n\n      this.object.matrixWorld.decompose(worldPosition, worldQuaternion, worldScale);\n      parentQuaternionInv.copy(parentQuaternion).inverse();\n      worldQuaternionInv.copy(worldQuaternion).inverse();\n    }\n\n    this.camera.updateMatrixWorld();\n    this.camera.matrixWorld.decompose(cameraPosition, cameraQuaternion, cameraScale);\n    eye.copy(cameraPosition).sub(worldPosition).normalize();\n    Object3D.prototype.updateMatrixWorld.call(this);\n  };\n\n  this.pointerHover = function (pointer) {\n    if (this.object === undefined || this.dragging === true || pointer.button !== undefined && pointer.button !== 0) return;\n    raycaster.setFromCamera(pointer, this.camera);\n    var intersect = intersectObjectWithRay(_gizmo.picker[this.mode], raycaster);\n\n    if (intersect) {\n      this.axis = intersect.object.name;\n    } else {\n      this.axis = null;\n    }\n  };\n\n  this.pointerDown = function (pointer) {\n    if (this.object === undefined || this.dragging === true || pointer.button !== undefined && pointer.button !== 0) return;\n\n    if ((pointer.button === 0 || pointer.button === undefined) && this.axis !== null) {\n      raycaster.setFromCamera(pointer, this.camera);\n      var planeIntersect = intersectObjectWithRay(_plane, raycaster, true);\n\n      if (planeIntersect) {\n        var space = this.space;\n\n        if (this.mode === 'scale') {\n          space = 'local';\n        } else if (this.axis === 'E' || this.axis === 'XYZE' || this.axis === 'XYZ') {\n          space = 'world';\n        }\n\n        if (space === 'local' && this.mode === 'rotate') {\n          var snap = this.rotationSnap;\n          if (this.axis === 'X' && snap) this.object.rotation.x = Math.round(this.object.rotation.x / snap) * snap;\n          if (this.axis === 'Y' && snap) this.object.rotation.y = Math.round(this.object.rotation.y / snap) * snap;\n          if (this.axis === 'Z' && snap) this.object.rotation.z = Math.round(this.object.rotation.z / snap) * snap;\n        }\n\n        this.object.updateMatrixWorld();\n        this.object.parent.updateMatrixWorld();\n        positionStart.copy(this.object.position);\n        quaternionStart.copy(this.object.quaternion);\n        scaleStart.copy(this.object.scale);\n        this.object.matrixWorld.decompose(worldPositionStart, worldQuaternionStart, worldScaleStart);\n        pointStart.copy(planeIntersect.point).sub(worldPositionStart);\n      }\n\n      this.dragging = true;\n      mouseDownEvent.mode = this.mode;\n      this.dispatchEvent(mouseDownEvent);\n    }\n  };\n\n  this.pointerMove = function (pointer) {\n    var axis = this.axis;\n    var mode = this.mode;\n    var object = this.object;\n    var space = this.space;\n\n    if (mode === 'scale') {\n      space = 'local';\n    } else if (axis === 'E' || axis === 'XYZE' || axis === 'XYZ') {\n      space = 'world';\n    }\n\n    if (object === undefined || axis === null || this.dragging === false || pointer.button !== undefined && pointer.button !== 0) return;\n    raycaster.setFromCamera(pointer, this.camera);\n    var planeIntersect = intersectObjectWithRay(_plane, raycaster, true);\n    if (!planeIntersect) return;\n    pointEnd.copy(planeIntersect.point).sub(worldPositionStart);\n\n    if (mode === 'translate') {\n      // Apply translate\n      offset.copy(pointEnd).sub(pointStart);\n\n      if (space === 'local' && axis !== 'XYZ') {\n        offset.applyQuaternion(worldQuaternionInv);\n      }\n\n      if (axis.indexOf('X') === -1) offset.x = 0;\n      if (axis.indexOf('Y') === -1) offset.y = 0;\n      if (axis.indexOf('Z') === -1) offset.z = 0;\n\n      if (space === 'local' && axis !== 'XYZ') {\n        offset.applyQuaternion(quaternionStart).divide(parentScale);\n      } else {\n        offset.applyQuaternion(parentQuaternionInv).divide(parentScale);\n      }\n\n      object.position.copy(offset).add(positionStart); // Apply translation snap\n\n      if (this.translationSnap) {\n        if (space === 'local') {\n          object.position.applyQuaternion(_tempQuaternion.copy(quaternionStart).inverse());\n\n          if (axis.search('X') !== -1) {\n            object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n          }\n\n          if (axis.search('Y') !== -1) {\n            object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n          }\n\n          if (axis.search('Z') !== -1) {\n            object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n          }\n\n          object.position.applyQuaternion(quaternionStart);\n        }\n\n        if (space === 'world') {\n          if (object.parent) {\n            object.position.add(_tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n          }\n\n          if (axis.search('X') !== -1) {\n            object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n          }\n\n          if (axis.search('Y') !== -1) {\n            object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n          }\n\n          if (axis.search('Z') !== -1) {\n            object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n          }\n\n          if (object.parent) {\n            object.position.sub(_tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n          }\n        }\n      }\n    } else if (mode === 'scale') {\n      if (axis.search('XYZ') !== -1) {\n        var d = pointEnd.length() / pointStart.length();\n        if (pointEnd.dot(pointStart) < 0) d *= -1;\n\n        _tempVector2.set(d, d, d);\n      } else {\n        _tempVector.copy(pointStart);\n\n        _tempVector2.copy(pointEnd);\n\n        _tempVector.applyQuaternion(worldQuaternionInv);\n\n        _tempVector2.applyQuaternion(worldQuaternionInv);\n\n        _tempVector2.divide(_tempVector);\n\n        if (axis.search('X') === -1) {\n          _tempVector2.x = 1;\n        }\n\n        if (axis.search('Y') === -1) {\n          _tempVector2.y = 1;\n        }\n\n        if (axis.search('Z') === -1) {\n          _tempVector2.z = 1;\n        }\n      } // Apply scale\n\n\n      object.scale.copy(scaleStart).multiply(_tempVector2);\n\n      if (this.scaleSnap) {\n        if (axis.search('X') !== -1) {\n          object.scale.x = Math.round(object.scale.x / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n        }\n\n        if (axis.search('Y') !== -1) {\n          object.scale.y = Math.round(object.scale.y / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n        }\n\n        if (axis.search('Z') !== -1) {\n          object.scale.z = Math.round(object.scale.z / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n        }\n      }\n    } else if (mode === 'rotate') {\n      offset.copy(pointEnd).sub(pointStart);\n      var ROTATION_SPEED = 20 / worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));\n\n      if (axis === 'E') {\n        rotationAxis.copy(eye);\n        rotationAngle = pointEnd.angleTo(pointStart);\n        startNorm.copy(pointStart).normalize();\n        endNorm.copy(pointEnd).normalize();\n        rotationAngle *= endNorm.cross(startNorm).dot(eye) < 0 ? 1 : -1;\n      } else if (axis === 'XYZE') {\n        rotationAxis.copy(offset).cross(eye).normalize();\n        rotationAngle = offset.dot(_tempVector.copy(rotationAxis).cross(this.eye)) * ROTATION_SPEED;\n      } else if (axis === 'X' || axis === 'Y' || axis === 'Z') {\n        rotationAxis.copy(_unit[axis]);\n\n        _tempVector.copy(_unit[axis]);\n\n        if (space === 'local') {\n          _tempVector.applyQuaternion(worldQuaternion);\n        }\n\n        rotationAngle = offset.dot(_tempVector.cross(eye).normalize()) * ROTATION_SPEED;\n      } // Apply rotation snap\n\n\n      if (this.rotationSnap) rotationAngle = Math.round(rotationAngle / this.rotationSnap) * this.rotationSnap;\n      this.rotationAngle = rotationAngle; // Apply rotate\n\n      if (space === 'local' && axis !== 'E' && axis !== 'XYZE') {\n        object.quaternion.copy(quaternionStart);\n        object.quaternion.multiply(_tempQuaternion.setFromAxisAngle(rotationAxis, rotationAngle)).normalize();\n      } else {\n        rotationAxis.applyQuaternion(parentQuaternionInv);\n        object.quaternion.copy(_tempQuaternion.setFromAxisAngle(rotationAxis, rotationAngle));\n        object.quaternion.multiply(quaternionStart).normalize();\n      }\n    }\n\n    this.dispatchEvent(changeEvent);\n    this.dispatchEvent(objectChangeEvent);\n  };\n\n  this.pointerUp = function (pointer) {\n    if (pointer.button !== undefined && pointer.button !== 0) return;\n\n    if (this.dragging && this.axis !== null) {\n      mouseUpEvent.mode = this.mode;\n      this.dispatchEvent(mouseUpEvent);\n    }\n\n    this.dragging = false;\n    if (pointer.button === undefined) this.axis = null;\n  }; // normalize mouse / touch pointer and remap {x,y} to view space.\n\n\n  function getPointer(event) {\n    if (scope.domElement.ownerDocument.pointerLockElement) {\n      return {\n        x: 0,\n        y: 0,\n        button: event.button\n      };\n    } else {\n      var pointer = event.changedTouches ? event.changedTouches[0] : event;\n      var rect = domElement.getBoundingClientRect();\n      return {\n        x: (pointer.clientX - rect.left) / rect.width * 2 - 1,\n        y: -(pointer.clientY - rect.top) / rect.height * 2 + 1,\n        button: event.button\n      };\n    }\n  } // mouse / touch event handlers\n\n\n  function onPointerHover(event) {\n    if (!scope.enabled) return;\n    scope.pointerHover(getPointer(event));\n  }\n\n  function onPointerDown(event) {\n    if (!scope.enabled) return;\n    scope.domElement.ownerDocument.addEventListener(\"mousemove\", onPointerMove, false);\n    scope.pointerHover(getPointer(event));\n    scope.pointerDown(getPointer(event));\n  }\n\n  function onPointerMove(event) {\n    if (!scope.enabled) return;\n    scope.pointerMove(getPointer(event));\n  }\n\n  function onPointerUp(event) {\n    if (!scope.enabled) return;\n    scope.domElement.ownerDocument.removeEventListener(\"mousemove\", onPointerMove, false);\n    scope.pointerUp(getPointer(event));\n  } // TODO: deprecate\n\n\n  this.getMode = function () {\n    return scope.mode;\n  };\n\n  this.setMode = function (mode) {\n    scope.mode = mode;\n  };\n\n  this.setTranslationSnap = function (translationSnap) {\n    scope.translationSnap = translationSnap;\n  };\n\n  this.setRotationSnap = function (rotationSnap) {\n    scope.rotationSnap = rotationSnap;\n  };\n\n  this.setScaleSnap = function (scaleSnap) {\n    scope.scaleSnap = scaleSnap;\n  };\n\n  this.setSize = function (size) {\n    scope.size = size;\n  };\n\n  this.setSpace = function (space) {\n    scope.space = space;\n  };\n\n  this.update = function () {\n    console.warn('THREE.TransformControls: update function has no more functionality and therefore has been deprecated.');\n  };\n};\n\nTransformControls.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: TransformControls,\n  isTransformControls: true\n});\n\nvar TransformControlsGizmo = function TransformControlsGizmo() {\n  'use strict';\n\n  Object3D.call(this);\n  this.type = 'TransformControlsGizmo'; // shared materials\n\n  var gizmoMaterial = new MeshBasicMaterial({\n    depthTest: false,\n    depthWrite: false,\n    transparent: true,\n    side: DoubleSide,\n    fog: false,\n    toneMapped: false\n  });\n  var gizmoLineMaterial = new LineBasicMaterial({\n    depthTest: false,\n    depthWrite: false,\n    transparent: true,\n    linewidth: 1,\n    fog: false,\n    toneMapped: false\n  }); // Make unique material for each axis/color\n\n  var matInvisible = gizmoMaterial.clone();\n  matInvisible.opacity = 0.15;\n  var matHelper = gizmoMaterial.clone();\n  matHelper.opacity = 0.33;\n  var matRed = gizmoMaterial.clone();\n  matRed.color.set(0xff0000);\n  var matGreen = gizmoMaterial.clone();\n  matGreen.color.set(0x00ff00);\n  var matBlue = gizmoMaterial.clone();\n  matBlue.color.set(0x0000ff);\n  var matWhiteTransparent = gizmoMaterial.clone();\n  matWhiteTransparent.opacity = 0.25;\n  var matYellowTransparent = matWhiteTransparent.clone();\n  matYellowTransparent.color.set(0xffff00);\n  var matCyanTransparent = matWhiteTransparent.clone();\n  matCyanTransparent.color.set(0x00ffff);\n  var matMagentaTransparent = matWhiteTransparent.clone();\n  matMagentaTransparent.color.set(0xff00ff);\n  var matYellow = gizmoMaterial.clone();\n  matYellow.color.set(0xffff00);\n  var matLineRed = gizmoLineMaterial.clone();\n  matLineRed.color.set(0xff0000);\n  var matLineGreen = gizmoLineMaterial.clone();\n  matLineGreen.color.set(0x00ff00);\n  var matLineBlue = gizmoLineMaterial.clone();\n  matLineBlue.color.set(0x0000ff);\n  var matLineCyan = gizmoLineMaterial.clone();\n  matLineCyan.color.set(0x00ffff);\n  var matLineMagenta = gizmoLineMaterial.clone();\n  matLineMagenta.color.set(0xff00ff);\n  var matLineYellow = gizmoLineMaterial.clone();\n  matLineYellow.color.set(0xffff00);\n  var matLineGray = gizmoLineMaterial.clone();\n  matLineGray.color.set(0x787878);\n  var matLineYellowTransparent = matLineYellow.clone();\n  matLineYellowTransparent.opacity = 0.25; // reusable geometry\n\n  var arrowGeometry = new CylinderBufferGeometry(0, 0.05, 0.2, 12, 1, false);\n  var scaleHandleGeometry = new BoxBufferGeometry(0.125, 0.125, 0.125);\n  var lineGeometry = new BufferGeometry();\n  lineGeometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 0, 0], 3));\n\n  var CircleGeometry = function CircleGeometry(radius, arc) {\n    var geometry = new BufferGeometry();\n    var vertices = [];\n\n    for (var i = 0; i <= 64 * arc; ++i) {\n      vertices.push(0, Math.cos(i / 32 * Math.PI) * radius, Math.sin(i / 32 * Math.PI) * radius);\n    }\n\n    geometry.setAttribute('position', new Float32BufferAttribute(vertices, 3));\n    return geometry;\n  }; // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\n  var TranslateHelperGeometry = function TranslateHelperGeometry() {\n    var geometry = new BufferGeometry();\n    geometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 1, 1], 3));\n    return geometry;\n  }; // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\n  var gizmoTranslate = {\n    X: [[new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, -Math.PI / 2], null, 'fwd'], [new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, Math.PI / 2], null, 'bwd'], [new Line(lineGeometry, matLineRed)]],\n    Y: [[new Mesh(arrowGeometry, matGreen), [0, 1, 0], null, null, 'fwd'], [new Mesh(arrowGeometry, matGreen), [0, 1, 0], [Math.PI, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2]]],\n    Z: [[new Mesh(arrowGeometry, matBlue), [0, 0, 1], [Math.PI / 2, 0, 0], null, 'fwd'], [new Mesh(arrowGeometry, matBlue), [0, 0, 1], [-Math.PI / 2, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0]]],\n    XYZ: [[new Mesh(new OctahedronBufferGeometry(0.1, 0), matWhiteTransparent.clone()), [0, 0, 0], [0, 0, 0]]],\n    XY: [[new Mesh(new PlaneBufferGeometry(0.295, 0.295), matYellowTransparent.clone()), [0.15, 0.15, 0]], [new Line(lineGeometry, matLineYellow), [0.18, 0.3, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.3, 0.18, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n    YZ: [[new Mesh(new PlaneBufferGeometry(0.295, 0.295), matCyanTransparent.clone()), [0, 0.15, 0.15], [0, Math.PI / 2, 0]], [new Line(lineGeometry, matLineCyan), [0, 0.18, 0.3], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.3, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n    XZ: [[new Mesh(new PlaneBufferGeometry(0.295, 0.295), matMagentaTransparent.clone()), [0.15, 0, 0.15], [-Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineMagenta), [0.18, 0, 0.3], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.3, 0, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]]\n  };\n  var pickerTranslate = {\n    X: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0.6, 0, 0], [0, 0, -Math.PI / 2]]],\n    Y: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0.6, 0]]],\n    Z: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0, 0.6], [Math.PI / 2, 0, 0]]],\n    XYZ: [[new Mesh(new OctahedronBufferGeometry(0.2, 0), matInvisible)]],\n    XY: [[new Mesh(new PlaneBufferGeometry(0.4, 0.4), matInvisible), [0.2, 0.2, 0]]],\n    YZ: [[new Mesh(new PlaneBufferGeometry(0.4, 0.4), matInvisible), [0, 0.2, 0.2], [0, Math.PI / 2, 0]]],\n    XZ: [[new Mesh(new PlaneBufferGeometry(0.4, 0.4), matInvisible), [0.2, 0, 0.2], [-Math.PI / 2, 0, 0]]]\n  };\n  var helperTranslate = {\n    START: [[new Mesh(new OctahedronBufferGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n    END: [[new Mesh(new OctahedronBufferGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n    DELTA: [[new Line(TranslateHelperGeometry(), matHelper), null, null, null, 'helper']],\n    X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n    Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n    Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n  };\n  var gizmoRotate = {\n    X: [[new Line(CircleGeometry(1, 0.5), matLineRed)], [new Mesh(new OctahedronBufferGeometry(0.04, 0), matRed), [0, 0, 0.99], null, [1, 3, 1]]],\n    Y: [[new Line(CircleGeometry(1, 0.5), matLineGreen), null, [0, 0, -Math.PI / 2]], [new Mesh(new OctahedronBufferGeometry(0.04, 0), matGreen), [0, 0, 0.99], null, [3, 1, 1]]],\n    Z: [[new Line(CircleGeometry(1, 0.5), matLineBlue), null, [0, Math.PI / 2, 0]], [new Mesh(new OctahedronBufferGeometry(0.04, 0), matBlue), [0.99, 0, 0], null, [1, 3, 1]]],\n    E: [[new Line(CircleGeometry(1.25, 1), matLineYellowTransparent), null, [0, Math.PI / 2, 0]], [new Mesh(new CylinderBufferGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [1.17, 0, 0], [0, 0, -Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderBufferGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [-1.17, 0, 0], [0, 0, Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderBufferGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, -1.17, 0], [Math.PI, 0, 0], [1, 1, 0.001]], [new Mesh(new CylinderBufferGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, 1.17, 0], [0, 0, 0], [1, 1, 0.001]]],\n    XYZE: [[new Line(CircleGeometry(1, 1), matLineGray), null, [0, Math.PI / 2, 0]]]\n  };\n  var helperRotate = {\n    AXIS: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']]\n  };\n  var pickerRotate = {\n    X: [[new Mesh(new TorusBufferGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, -Math.PI / 2, -Math.PI / 2]]],\n    Y: [[new Mesh(new TorusBufferGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [Math.PI / 2, 0, 0]]],\n    Z: [[new Mesh(new TorusBufferGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, 0, -Math.PI / 2]]],\n    E: [[new Mesh(new TorusBufferGeometry(1.25, 0.1, 2, 24), matInvisible)]],\n    XYZE: [[new Mesh(new SphereBufferGeometry(0.7, 10, 8), matInvisible)]]\n  };\n  var gizmoScale = {\n    X: [[new Mesh(scaleHandleGeometry, matRed), [0.8, 0, 0], [0, 0, -Math.PI / 2]], [new Line(lineGeometry, matLineRed), null, null, [0.8, 1, 1]]],\n    Y: [[new Mesh(scaleHandleGeometry, matGreen), [0, 0.8, 0]], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2], [0.8, 1, 1]]],\n    Z: [[new Mesh(scaleHandleGeometry, matBlue), [0, 0, 0.8], [Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0], [0.8, 1, 1]]],\n    XY: [[new Mesh(scaleHandleGeometry, matYellowTransparent), [0.85, 0.85, 0], null, [2, 2, 0.2]], [new Line(lineGeometry, matLineYellow), [0.855, 0.98, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.98, 0.855, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n    YZ: [[new Mesh(scaleHandleGeometry, matCyanTransparent), [0, 0.85, 0.85], null, [0.2, 2, 2]], [new Line(lineGeometry, matLineCyan), [0, 0.855, 0.98], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.98, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n    XZ: [[new Mesh(scaleHandleGeometry, matMagentaTransparent), [0.85, 0, 0.85], null, [2, 0.2, 2]], [new Line(lineGeometry, matLineMagenta), [0.855, 0, 0.98], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.98, 0, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n    XYZX: [[new Mesh(new BoxBufferGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [1.1, 0, 0]]],\n    XYZY: [[new Mesh(new BoxBufferGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 1.1, 0]]],\n    XYZZ: [[new Mesh(new BoxBufferGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 0, 1.1]]]\n  };\n  var pickerScale = {\n    X: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0.5, 0, 0], [0, 0, -Math.PI / 2]]],\n    Y: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0.5, 0]]],\n    Z: [[new Mesh(new CylinderBufferGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0, 0.5], [Math.PI / 2, 0, 0]]],\n    XY: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0.85, 0], null, [3, 3, 0.2]]],\n    YZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0, 0.85, 0.85], null, [0.2, 3, 3]]],\n    XZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0, 0.85], null, [3, 0.2, 3]]],\n    XYZX: [[new Mesh(new BoxBufferGeometry(0.2, 0.2, 0.2), matInvisible), [1.1, 0, 0]]],\n    XYZY: [[new Mesh(new BoxBufferGeometry(0.2, 0.2, 0.2), matInvisible), [0, 1.1, 0]]],\n    XYZZ: [[new Mesh(new BoxBufferGeometry(0.2, 0.2, 0.2), matInvisible), [0, 0, 1.1]]]\n  };\n  var helperScale = {\n    X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n    Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n    Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n  }; // Creates an Object3D with gizmos described in custom hierarchy definition.\n\n  var setupGizmo = function setupGizmo(gizmoMap) {\n    var gizmo = new Object3D();\n\n    for (var name in gizmoMap) {\n      for (var i = gizmoMap[name].length; i--;) {\n        var object = gizmoMap[name][i][0].clone();\n        var position = gizmoMap[name][i][1];\n        var rotation = gizmoMap[name][i][2];\n        var scale = gizmoMap[name][i][3];\n        var tag = gizmoMap[name][i][4]; // name and tag properties are essential for picking and updating logic.\n\n        object.name = name;\n        object.tag = tag;\n\n        if (position) {\n          object.position.set(position[0], position[1], position[2]);\n        }\n\n        if (rotation) {\n          object.rotation.set(rotation[0], rotation[1], rotation[2]);\n        }\n\n        if (scale) {\n          object.scale.set(scale[0], scale[1], scale[2]);\n        }\n\n        object.updateMatrix();\n        var tempGeometry = object.geometry.clone();\n        tempGeometry.applyMatrix4(object.matrix);\n        object.geometry = tempGeometry;\n        object.renderOrder = Infinity;\n        object.position.set(0, 0, 0);\n        object.rotation.set(0, 0, 0);\n        object.scale.set(1, 1, 1);\n        gizmo.add(object);\n      }\n    }\n\n    return gizmo;\n  }; // Reusable utility variables\n\n\n  var tempVector = new Vector3(0, 0, 0);\n  var tempEuler = new Euler();\n  var alignVector = new Vector3(0, 1, 0);\n  var zeroVector = new Vector3(0, 0, 0);\n  var lookAtMatrix = new Matrix4();\n  var tempQuaternion = new Quaternion();\n  var tempQuaternion2 = new Quaternion();\n  var identityQuaternion = new Quaternion();\n  var unitX = new Vector3(1, 0, 0);\n  var unitY = new Vector3(0, 1, 0);\n  var unitZ = new Vector3(0, 0, 1); // Gizmo creation\n\n  this.gizmo = {};\n  this.picker = {};\n  this.helper = {};\n  this.add(this.gizmo[\"translate\"] = setupGizmo(gizmoTranslate));\n  this.add(this.gizmo[\"rotate\"] = setupGizmo(gizmoRotate));\n  this.add(this.gizmo[\"scale\"] = setupGizmo(gizmoScale));\n  this.add(this.picker[\"translate\"] = setupGizmo(pickerTranslate));\n  this.add(this.picker[\"rotate\"] = setupGizmo(pickerRotate));\n  this.add(this.picker[\"scale\"] = setupGizmo(pickerScale));\n  this.add(this.helper[\"translate\"] = setupGizmo(helperTranslate));\n  this.add(this.helper[\"rotate\"] = setupGizmo(helperRotate));\n  this.add(this.helper[\"scale\"] = setupGizmo(helperScale)); // Pickers should be hidden always\n\n  this.picker[\"translate\"].visible = false;\n  this.picker[\"rotate\"].visible = false;\n  this.picker[\"scale\"].visible = false; // updateMatrixWorld will update transformations and appearance of individual handles\n\n  this.updateMatrixWorld = function () {\n    var space = this.space;\n    if (this.mode === 'scale') space = 'local'; // scale always oriented to local rotation\n\n    var quaternion = space === \"local\" ? this.worldQuaternion : identityQuaternion; // Show only gizmos for current transform mode\n\n    this.gizmo[\"translate\"].visible = this.mode === \"translate\";\n    this.gizmo[\"rotate\"].visible = this.mode === \"rotate\";\n    this.gizmo[\"scale\"].visible = this.mode === \"scale\";\n    this.helper[\"translate\"].visible = this.mode === \"translate\";\n    this.helper[\"rotate\"].visible = this.mode === \"rotate\";\n    this.helper[\"scale\"].visible = this.mode === \"scale\";\n    var handles = [];\n    handles = handles.concat(this.picker[this.mode].children);\n    handles = handles.concat(this.gizmo[this.mode].children);\n    handles = handles.concat(this.helper[this.mode].children);\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i]; // hide aligned to camera\n\n      handle.visible = true;\n      handle.rotation.set(0, 0, 0);\n      handle.position.copy(this.worldPosition);\n      var factor;\n\n      if (this.camera.isOrthographicCamera) {\n        factor = (this.camera.top - this.camera.bottom) / this.camera.zoom;\n      } else {\n        factor = this.worldPosition.distanceTo(this.cameraPosition) * Math.min(1.9 * Math.tan(Math.PI * this.camera.fov / 360) / this.camera.zoom, 7);\n      }\n\n      handle.scale.set(1, 1, 1).multiplyScalar(factor * this.size / 7); // TODO: simplify helpers and consider decoupling from gizmo\n\n      if (handle.tag === 'helper') {\n        handle.visible = false;\n\n        if (handle.name === 'AXIS') {\n          handle.position.copy(this.worldPositionStart);\n          handle.visible = !!this.axis;\n\n          if (this.axis === 'X') {\n            tempQuaternion.setFromEuler(tempEuler.set(0, 0, 0));\n            handle.quaternion.copy(quaternion).multiply(tempQuaternion);\n\n            if (Math.abs(alignVector.copy(unitX).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n              handle.visible = false;\n            }\n          }\n\n          if (this.axis === 'Y') {\n            tempQuaternion.setFromEuler(tempEuler.set(0, 0, Math.PI / 2));\n            handle.quaternion.copy(quaternion).multiply(tempQuaternion);\n\n            if (Math.abs(alignVector.copy(unitY).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n              handle.visible = false;\n            }\n          }\n\n          if (this.axis === 'Z') {\n            tempQuaternion.setFromEuler(tempEuler.set(0, Math.PI / 2, 0));\n            handle.quaternion.copy(quaternion).multiply(tempQuaternion);\n\n            if (Math.abs(alignVector.copy(unitZ).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n              handle.visible = false;\n            }\n          }\n\n          if (this.axis === 'XYZE') {\n            tempQuaternion.setFromEuler(tempEuler.set(0, Math.PI / 2, 0));\n            alignVector.copy(this.rotationAxis);\n            handle.quaternion.setFromRotationMatrix(lookAtMatrix.lookAt(zeroVector, alignVector, unitY));\n            handle.quaternion.multiply(tempQuaternion);\n            handle.visible = this.dragging;\n          }\n\n          if (this.axis === 'E') {\n            handle.visible = false;\n          }\n        } else if (handle.name === 'START') {\n          handle.position.copy(this.worldPositionStart);\n          handle.visible = this.dragging;\n        } else if (handle.name === 'END') {\n          handle.position.copy(this.worldPosition);\n          handle.visible = this.dragging;\n        } else if (handle.name === 'DELTA') {\n          handle.position.copy(this.worldPositionStart);\n          handle.quaternion.copy(this.worldQuaternionStart);\n          tempVector.set(1e-10, 1e-10, 1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1);\n          tempVector.applyQuaternion(this.worldQuaternionStart.clone().inverse());\n          handle.scale.copy(tempVector);\n          handle.visible = this.dragging;\n        } else {\n          handle.quaternion.copy(quaternion);\n\n          if (this.dragging) {\n            handle.position.copy(this.worldPositionStart);\n          } else {\n            handle.position.copy(this.worldPosition);\n          }\n\n          if (this.axis) {\n            handle.visible = this.axis.search(handle.name) !== -1;\n          }\n        } // If updating helper, skip rest of the loop\n\n\n        continue;\n      } // Align handles to current local or world rotation\n\n\n      handle.quaternion.copy(quaternion);\n\n      if (this.mode === 'translate' || this.mode === 'scale') {\n        // Hide translate and scale axis facing the camera\n        var AXIS_HIDE_TRESHOLD = 0.99;\n        var PLANE_HIDE_TRESHOLD = 0.2;\n        var AXIS_FLIP_TRESHOLD = 0.0;\n\n        if (handle.name === 'X' || handle.name === 'XYZX') {\n          if (Math.abs(alignVector.copy(unitX).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name === 'Y' || handle.name === 'XYZY') {\n          if (Math.abs(alignVector.copy(unitY).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name === 'Z' || handle.name === 'XYZZ') {\n          if (Math.abs(alignVector.copy(unitZ).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name === 'XY') {\n          if (Math.abs(alignVector.copy(unitZ).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name === 'YZ') {\n          if (Math.abs(alignVector.copy(unitX).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name === 'XZ') {\n          if (Math.abs(alignVector.copy(unitY).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n            handle.scale.set(1e-10, 1e-10, 1e-10);\n            handle.visible = false;\n          }\n        } // Flip translate and scale axis ocluded behind another axis\n\n\n        if (handle.name.search('X') !== -1) {\n          if (alignVector.copy(unitX).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n            if (handle.tag === 'fwd') {\n              handle.visible = false;\n            } else {\n              handle.scale.x *= -1;\n            }\n          } else if (handle.tag === 'bwd') {\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name.search('Y') !== -1) {\n          if (alignVector.copy(unitY).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n            if (handle.tag === 'fwd') {\n              handle.visible = false;\n            } else {\n              handle.scale.y *= -1;\n            }\n          } else if (handle.tag === 'bwd') {\n            handle.visible = false;\n          }\n        }\n\n        if (handle.name.search('Z') !== -1) {\n          if (alignVector.copy(unitZ).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n            if (handle.tag === 'fwd') {\n              handle.visible = false;\n            } else {\n              handle.scale.z *= -1;\n            }\n          } else if (handle.tag === 'bwd') {\n            handle.visible = false;\n          }\n        }\n      } else if (this.mode === 'rotate') {\n        // Align handles to current local or world rotation\n        tempQuaternion2.copy(quaternion);\n        alignVector.copy(this.eye).applyQuaternion(tempQuaternion.copy(quaternion).inverse());\n\n        if (handle.name.search(\"E\") !== -1) {\n          handle.quaternion.setFromRotationMatrix(lookAtMatrix.lookAt(this.eye, zeroVector, unitY));\n        }\n\n        if (handle.name === 'X') {\n          tempQuaternion.setFromAxisAngle(unitX, Math.atan2(-alignVector.y, alignVector.z));\n          tempQuaternion.multiplyQuaternions(tempQuaternion2, tempQuaternion);\n          handle.quaternion.copy(tempQuaternion);\n        }\n\n        if (handle.name === 'Y') {\n          tempQuaternion.setFromAxisAngle(unitY, Math.atan2(alignVector.x, alignVector.z));\n          tempQuaternion.multiplyQuaternions(tempQuaternion2, tempQuaternion);\n          handle.quaternion.copy(tempQuaternion);\n        }\n\n        if (handle.name === 'Z') {\n          tempQuaternion.setFromAxisAngle(unitZ, Math.atan2(alignVector.y, alignVector.x));\n          tempQuaternion.multiplyQuaternions(tempQuaternion2, tempQuaternion);\n          handle.quaternion.copy(tempQuaternion);\n        }\n      } // Hide disabled axes\n\n\n      handle.visible = handle.visible && (handle.name.indexOf(\"X\") === -1 || this.showX);\n      handle.visible = handle.visible && (handle.name.indexOf(\"Y\") === -1 || this.showY);\n      handle.visible = handle.visible && (handle.name.indexOf(\"Z\") === -1 || this.showZ);\n      handle.visible = handle.visible && (handle.name.indexOf(\"E\") === -1 || this.showX && this.showY && this.showZ); // highlight selected axis\n\n      handle.material._opacity = handle.material._opacity || handle.material.opacity;\n      handle.material._color = handle.material._color || handle.material.color.clone();\n      handle.material.color.copy(handle.material._color);\n      handle.material.opacity = handle.material._opacity;\n\n      if (!this.enabled) {\n        handle.material.opacity *= 0.5;\n        handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n      } else if (this.axis) {\n        if (handle.name === this.axis) {\n          handle.material.opacity = 1.0;\n          handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n        } else if (this.axis.split('').some(function (a) {\n          return handle.name === a;\n        })) {\n          handle.material.opacity = 1.0;\n          handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n        } else {\n          handle.material.opacity *= 0.25;\n          handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n        }\n      }\n    }\n\n    Object3D.prototype.updateMatrixWorld.call(this);\n  };\n};\n\nTransformControlsGizmo.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: TransformControlsGizmo,\n  isTransformControlsGizmo: true\n});\n\nvar TransformControlsPlane = function TransformControlsPlane() {\n  'use strict';\n\n  Mesh.call(this, new PlaneBufferGeometry(100000, 100000, 2, 2), new MeshBasicMaterial({\n    visible: false,\n    wireframe: true,\n    side: DoubleSide,\n    transparent: true,\n    opacity: 0.1,\n    toneMapped: false\n  }));\n  this.type = 'TransformControlsPlane';\n  var unitX = new Vector3(1, 0, 0);\n  var unitY = new Vector3(0, 1, 0);\n  var unitZ = new Vector3(0, 0, 1);\n  var tempVector = new Vector3();\n  var dirVector = new Vector3();\n  var alignVector = new Vector3();\n  var tempMatrix = new Matrix4();\n  var identityQuaternion = new Quaternion();\n\n  this.updateMatrixWorld = function () {\n    var space = this.space;\n    this.position.copy(this.worldPosition);\n    if (this.mode === 'scale') space = 'local'; // scale always oriented to local rotation\n\n    unitX.set(1, 0, 0).applyQuaternion(space === \"local\" ? this.worldQuaternion : identityQuaternion);\n    unitY.set(0, 1, 0).applyQuaternion(space === \"local\" ? this.worldQuaternion : identityQuaternion);\n    unitZ.set(0, 0, 1).applyQuaternion(space === \"local\" ? this.worldQuaternion : identityQuaternion); // Align the plane for current transform mode, axis and space.\n\n    alignVector.copy(unitY);\n\n    switch (this.mode) {\n      case 'translate':\n      case 'scale':\n        switch (this.axis) {\n          case 'X':\n            alignVector.copy(this.eye).cross(unitX);\n            dirVector.copy(unitX).cross(alignVector);\n            break;\n\n          case 'Y':\n            alignVector.copy(this.eye).cross(unitY);\n            dirVector.copy(unitY).cross(alignVector);\n            break;\n\n          case 'Z':\n            alignVector.copy(this.eye).cross(unitZ);\n            dirVector.copy(unitZ).cross(alignVector);\n            break;\n\n          case 'XY':\n            dirVector.copy(unitZ);\n            break;\n\n          case 'YZ':\n            dirVector.copy(unitX);\n            break;\n\n          case 'XZ':\n            alignVector.copy(unitZ);\n            dirVector.copy(unitY);\n            break;\n\n          case 'XYZ':\n          case 'E':\n            dirVector.set(0, 0, 0);\n            break;\n        }\n\n        break;\n\n      case 'rotate':\n      default:\n        // special case for rotate\n        dirVector.set(0, 0, 0);\n    }\n\n    if (dirVector.length() === 0) {\n      // If in rotate mode, make the plane parallel to camera\n      this.quaternion.copy(this.cameraQuaternion);\n    } else {\n      tempMatrix.lookAt(tempVector.set(0, 0, 0), dirVector, alignVector);\n      this.quaternion.setFromRotationMatrix(tempMatrix);\n    }\n\n    Object3D.prototype.updateMatrixWorld.call(this);\n  };\n};\n\nTransformControlsPlane.prototype = Object.assign(Object.create(Mesh.prototype), {\n  constructor: TransformControlsPlane,\n  isTransformControlsPlane: true\n});\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };","map":{"version":3,"sources":["/Users/lairdkruger/Documents/Web Development/Work/inst19-20/inst19-20/node_modules/three/examples/jsm/controls/TransformControls.js"],"names":["BoxBufferGeometry","BufferGeometry","Color","CylinderBufferGeometry","DoubleSide","Euler","Float32BufferAttribute","Line","LineBasicMaterial","Matrix4","Mesh","MeshBasicMaterial","Object3D","OctahedronBufferGeometry","PlaneBufferGeometry","Quaternion","Raycaster","SphereBufferGeometry","TorusBufferGeometry","Vector3","TransformControls","camera","domElement","undefined","console","warn","document","call","visible","_gizmo","TransformControlsGizmo","add","_plane","TransformControlsPlane","scope","defineProperty","changeEvent","type","mouseDownEvent","mouseUpEvent","mode","objectChangeEvent","raycaster","intersectObjectWithRay","object","includeInvisible","allIntersections","intersectObject","i","length","_tempVector","_tempVector2","_tempQuaternion","_unit","X","Y","Z","pointStart","pointEnd","offset","rotationAxis","startNorm","endNorm","rotationAngle","cameraPosition","cameraQuaternion","cameraScale","parentPosition","parentQuaternion","parentQuaternionInv","parentScale","worldPositionStart","worldQuaternionStart","worldScaleStart","worldPosition","worldQuaternion","worldQuaternionInv","worldScale","eye","positionStart","quaternionStart","scaleStart","addEventListener","onPointerDown","onPointerHover","onPointerMove","ownerDocument","onPointerUp","dispose","removeEventListener","traverse","child","geometry","material","attach","detach","axis","propName","defaultValue","propValue","Object","get","set","value","dispatchEvent","updateMatrixWorld","parent","error","matrixWorld","decompose","copy","inverse","sub","normalize","prototype","pointerHover","pointer","dragging","button","setFromCamera","intersect","picker","name","pointerDown","planeIntersect","space","snap","rotationSnap","rotation","x","Math","round","y","z","position","quaternion","scale","point","pointerMove","applyQuaternion","indexOf","divide","translationSnap","search","setFromMatrixPosition","d","dot","multiply","scaleSnap","ROTATION_SPEED","distanceTo","angleTo","cross","setFromAxisAngle","pointerUp","getPointer","event","pointerLockElement","changedTouches","rect","getBoundingClientRect","clientX","left","width","clientY","top","height","enabled","getMode","setMode","setTranslationSnap","setRotationSnap","setScaleSnap","setSize","size","setSpace","update","assign","create","constructor","isTransformControls","gizmoMaterial","depthTest","depthWrite","transparent","side","fog","toneMapped","gizmoLineMaterial","linewidth","matInvisible","clone","opacity","matHelper","matRed","color","matGreen","matBlue","matWhiteTransparent","matYellowTransparent","matCyanTransparent","matMagentaTransparent","matYellow","matLineRed","matLineGreen","matLineBlue","matLineCyan","matLineMagenta","matLineYellow","matLineGray","matLineYellowTransparent","arrowGeometry","scaleHandleGeometry","lineGeometry","setAttribute","CircleGeometry","radius","arc","vertices","push","cos","PI","sin","TranslateHelperGeometry","gizmoTranslate","XYZ","XY","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","gizmoRotate","E","XYZE","helperRotate","AXIS","pickerRotate","gizmoScale","XYZX","XYZY","XYZZ","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","tag","updateMatrix","tempGeometry","applyMatrix4","matrix","renderOrder","Infinity","tempVector","tempEuler","alignVector","zeroVector","lookAtMatrix","tempQuaternion","tempQuaternion2","identityQuaternion","unitX","unitY","unitZ","helper","handles","concat","children","handle","factor","isOrthographicCamera","bottom","zoom","min","tan","fov","multiplyScalar","setFromEuler","abs","setFromRotationMatrix","lookAt","AXIS_HIDE_TRESHOLD","PLANE_HIDE_TRESHOLD","AXIS_FLIP_TRESHOLD","atan2","multiplyQuaternions","showX","showY","showZ","_opacity","_color","lerp","split","some","a","isTransformControlsGizmo","wireframe","dirVector","tempMatrix","isTransformControlsPlane"],"mappings":"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","sourcesContent":["/**\n * @author arodic / https://github.com/arodic\n */\n\nimport {\n\tBoxBufferGeometry,\n\tBufferGeometry,\n\tColor,\n\tCylinderBufferGeometry,\n\tDoubleSide,\n\tEuler,\n\tFloat32BufferAttribute,\n\tLine,\n\tLineBasicMaterial,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tObject3D,\n\tOctahedronBufferGeometry,\n\tPlaneBufferGeometry,\n\tQuaternion,\n\tRaycaster,\n\tSphereBufferGeometry,\n\tTorusBufferGeometry,\n\tVector3\n} from \"../../../build/three.module.js\";\n\nvar TransformControls = function ( camera, domElement ) {\n\n\tif ( domElement === undefined ) {\n\n\t\tconsole.warn( 'THREE.TransformControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tdomElement = document;\n\n\t}\n\n\tObject3D.call( this );\n\n\tthis.visible = false;\n\tthis.domElement = domElement;\n\n\tvar _gizmo = new TransformControlsGizmo();\n\tthis.add( _gizmo );\n\n\tvar _plane = new TransformControlsPlane();\n\tthis.add( _plane );\n\n\tvar scope = this;\n\n\t// Define properties with getters/setter\n\t// Setting the defined property will automatically trigger change event\n\t// Defined properties are passed down to gizmo and plane\n\n\tdefineProperty( \"camera\", camera );\n\tdefineProperty( \"object\", undefined );\n\tdefineProperty( \"enabled\", true );\n\tdefineProperty( \"axis\", null );\n\tdefineProperty( \"mode\", \"translate\" );\n\tdefineProperty( \"translationSnap\", null );\n\tdefineProperty( \"rotationSnap\", null );\n\tdefineProperty( \"scaleSnap\", null );\n\tdefineProperty( \"space\", \"world\" );\n\tdefineProperty( \"size\", 1 );\n\tdefineProperty( \"dragging\", false );\n\tdefineProperty( \"showX\", true );\n\tdefineProperty( \"showY\", true );\n\tdefineProperty( \"showZ\", true );\n\n\tvar changeEvent = { type: \"change\" };\n\tvar mouseDownEvent = { type: \"mouseDown\" };\n\tvar mouseUpEvent = { type: \"mouseUp\", mode: scope.mode };\n\tvar objectChangeEvent = { type: \"objectChange\" };\n\n\t// Reusable utility variables\n\n\tvar raycaster = new Raycaster();\n\n\tfunction intersectObjectWithRay( object, raycaster, includeInvisible ) {\n\n\t\tvar allIntersections = raycaster.intersectObject( object, true );\n\n\t\tfor ( var i = 0; i < allIntersections.length; i ++ ) {\n\n\t\t\tif ( allIntersections[ i ].object.visible || includeInvisible ) {\n\n\t\t\t\treturn allIntersections[ i ];\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvar _tempVector = new Vector3();\n\tvar _tempVector2 = new Vector3();\n\tvar _tempQuaternion = new Quaternion();\n\tvar _unit = {\n\t\tX: new Vector3( 1, 0, 0 ),\n\t\tY: new Vector3( 0, 1, 0 ),\n\t\tZ: new Vector3( 0, 0, 1 )\n\t};\n\n\tvar pointStart = new Vector3();\n\tvar pointEnd = new Vector3();\n\tvar offset = new Vector3();\n\tvar rotationAxis = new Vector3();\n\tvar startNorm = new Vector3();\n\tvar endNorm = new Vector3();\n\tvar rotationAngle = 0;\n\n\tvar cameraPosition = new Vector3();\n\tvar cameraQuaternion = new Quaternion();\n\tvar cameraScale = new Vector3();\n\n\tvar parentPosition = new Vector3();\n\tvar parentQuaternion = new Quaternion();\n\tvar parentQuaternionInv = new Quaternion();\n\tvar parentScale = new Vector3();\n\n\tvar worldPositionStart = new Vector3();\n\tvar worldQuaternionStart = new Quaternion();\n\tvar worldScaleStart = new Vector3();\n\n\tvar worldPosition = new Vector3();\n\tvar worldQuaternion = new Quaternion();\n\tvar worldQuaternionInv = new Quaternion();\n\tvar worldScale = new Vector3();\n\n\tvar eye = new Vector3();\n\n\tvar positionStart = new Vector3();\n\tvar quaternionStart = new Quaternion();\n\tvar scaleStart = new Vector3();\n\n\t// TODO: remove properties unused in plane and gizmo\n\n\tdefineProperty( \"worldPosition\", worldPosition );\n\tdefineProperty( \"worldPositionStart\", worldPositionStart );\n\tdefineProperty( \"worldQuaternion\", worldQuaternion );\n\tdefineProperty( \"worldQuaternionStart\", worldQuaternionStart );\n\tdefineProperty( \"cameraPosition\", cameraPosition );\n\tdefineProperty( \"cameraQuaternion\", cameraQuaternion );\n\tdefineProperty( \"pointStart\", pointStart );\n\tdefineProperty( \"pointEnd\", pointEnd );\n\tdefineProperty( \"rotationAxis\", rotationAxis );\n\tdefineProperty( \"rotationAngle\", rotationAngle );\n\tdefineProperty( \"eye\", eye );\n\n\t{\n\n\t\tdomElement.addEventListener( \"mousedown\", onPointerDown, false );\n\t\tdomElement.addEventListener( \"touchstart\", onPointerDown, false );\n\t\tdomElement.addEventListener( \"mousemove\", onPointerHover, false );\n\t\tdomElement.addEventListener( \"touchmove\", onPointerHover, false );\n\t\tdomElement.addEventListener( \"touchmove\", onPointerMove, false );\n\t\tscope.domElement.ownerDocument.addEventListener( \"mouseup\", onPointerUp, false );\n\t\tdomElement.addEventListener( \"touchend\", onPointerUp, false );\n\t\tdomElement.addEventListener( \"touchcancel\", onPointerUp, false );\n\t\tdomElement.addEventListener( \"touchleave\", onPointerUp, false );\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tdomElement.removeEventListener( \"mousedown\", onPointerDown );\n\t\tdomElement.removeEventListener( \"touchstart\", onPointerDown );\n\t\tdomElement.removeEventListener( \"mousemove\", onPointerHover );\n\t\tscope.domElement.ownerDocument.removeEventListener( \"mousemove\", onPointerMove );\n\t\tdomElement.removeEventListener( \"touchmove\", onPointerHover );\n\t\tdomElement.removeEventListener( \"touchmove\", onPointerMove );\n\t\tscope.domElement.ownerDocument.removeEventListener( \"mouseup\", onPointerUp );\n\t\tdomElement.removeEventListener( \"touchend\", onPointerUp );\n\t\tdomElement.removeEventListener( \"touchcancel\", onPointerUp );\n\t\tdomElement.removeEventListener( \"touchleave\", onPointerUp );\n\n\t\tthis.traverse( function ( child ) {\n\n\t\t\tif ( child.geometry ) child.geometry.dispose();\n\t\t\tif ( child.material ) child.material.dispose();\n\n\t\t} );\n\n\t};\n\n\t// Set current object\n\tthis.attach = function ( object ) {\n\n\t\tthis.object = object;\n\t\tthis.visible = true;\n\n\t\treturn this;\n\n\t};\n\n\t// Detatch from object\n\tthis.detach = function () {\n\n\t\tthis.object = undefined;\n\t\tthis.visible = false;\n\t\tthis.axis = null;\n\n\t\treturn this;\n\n\t};\n\n\t// Defined getter, setter and store for a property\n\tfunction defineProperty( propName, defaultValue ) {\n\n\t\tvar propValue = defaultValue;\n\n\t\tObject.defineProperty( scope, propName, {\n\n\t\t\tget: function () {\n\n\t\t\t\treturn propValue !== undefined ? propValue : defaultValue;\n\n\t\t\t},\n\n\t\t\tset: function ( value ) {\n\n\t\t\t\tif ( propValue !== value ) {\n\n\t\t\t\t\tpropValue = value;\n\t\t\t\t\t_plane[ propName ] = value;\n\t\t\t\t\t_gizmo[ propName ] = value;\n\n\t\t\t\t\tscope.dispatchEvent( { type: propName + \"-changed\", value: value } );\n\t\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\tscope[ propName ] = defaultValue;\n\t\t_plane[ propName ] = defaultValue;\n\t\t_gizmo[ propName ] = defaultValue;\n\n\t}\n\n\t// updateMatrixWorld  updates key transformation variables\n\tthis.updateMatrixWorld = function () {\n\n\t\tif ( this.object !== undefined ) {\n\n\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\tif ( this.object.parent === null ) {\n\n\t\t\t\tconsole.error( 'TransformControls: The attached 3D object must be a part of the scene graph.' );\n\n\t\t\t} else {\n\n\t\t\t\tthis.object.parent.matrixWorld.decompose( parentPosition, parentQuaternion, parentScale );\n\n\t\t\t}\n\n\t\t\tthis.object.matrixWorld.decompose( worldPosition, worldQuaternion, worldScale );\n\n\t\t\tparentQuaternionInv.copy( parentQuaternion ).inverse();\n\t\t\tworldQuaternionInv.copy( worldQuaternion ).inverse();\n\n\t\t}\n\n\t\tthis.camera.updateMatrixWorld();\n\t\tthis.camera.matrixWorld.decompose( cameraPosition, cameraQuaternion, cameraScale );\n\n\t\teye.copy( cameraPosition ).sub( worldPosition ).normalize();\n\n\t\tObject3D.prototype.updateMatrixWorld.call( this );\n\n\t};\n\n\tthis.pointerHover = function ( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n\t\traycaster.setFromCamera( pointer, this.camera );\n\n\t\tvar intersect = intersectObjectWithRay( _gizmo.picker[ this.mode ], raycaster );\n\n\t\tif ( intersect ) {\n\n\t\t\tthis.axis = intersect.object.name;\n\n\t\t} else {\n\n\t\t\tthis.axis = null;\n\n\t\t}\n\n\t};\n\n\tthis.pointerDown = function ( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n\t\tif ( ( pointer.button === 0 || pointer.button === undefined ) && this.axis !== null ) {\n\n\t\t\traycaster.setFromCamera( pointer, this.camera );\n\n\t\t\tvar planeIntersect = intersectObjectWithRay( _plane, raycaster, true );\n\n\t\t\tif ( planeIntersect ) {\n\n\t\t\t\tvar space = this.space;\n\n\t\t\t\tif ( this.mode === 'scale' ) {\n\n\t\t\t\t\tspace = 'local';\n\n\t\t\t\t} else if ( this.axis === 'E' || this.axis === 'XYZE' || this.axis === 'XYZ' ) {\n\n\t\t\t\t\tspace = 'world';\n\n\t\t\t\t}\n\n\t\t\t\tif ( space === 'local' && this.mode === 'rotate' ) {\n\n\t\t\t\t\tvar snap = this.rotationSnap;\n\n\t\t\t\t\tif ( this.axis === 'X' && snap ) this.object.rotation.x = Math.round( this.object.rotation.x / snap ) * snap;\n\t\t\t\t\tif ( this.axis === 'Y' && snap ) this.object.rotation.y = Math.round( this.object.rotation.y / snap ) * snap;\n\t\t\t\t\tif ( this.axis === 'Z' && snap ) this.object.rotation.z = Math.round( this.object.rotation.z / snap ) * snap;\n\n\t\t\t\t}\n\n\t\t\t\tthis.object.updateMatrixWorld();\n\t\t\t\tthis.object.parent.updateMatrixWorld();\n\n\t\t\t\tpositionStart.copy( this.object.position );\n\t\t\t\tquaternionStart.copy( this.object.quaternion );\n\t\t\t\tscaleStart.copy( this.object.scale );\n\n\t\t\t\tthis.object.matrixWorld.decompose( worldPositionStart, worldQuaternionStart, worldScaleStart );\n\n\t\t\t\tpointStart.copy( planeIntersect.point ).sub( worldPositionStart );\n\n\t\t\t}\n\n\t\t\tthis.dragging = true;\n\t\t\tmouseDownEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( mouseDownEvent );\n\n\t\t}\n\n\t};\n\n\tthis.pointerMove = function ( pointer ) {\n\n\t\tvar axis = this.axis;\n\t\tvar mode = this.mode;\n\t\tvar object = this.object;\n\t\tvar space = this.space;\n\n\t\tif ( mode === 'scale' ) {\n\n\t\t\tspace = 'local';\n\n\t\t} else if ( axis === 'E' || axis === 'XYZE' || axis === 'XYZ' ) {\n\n\t\t\tspace = 'world';\n\n\t\t}\n\n\t\tif ( object === undefined || axis === null || this.dragging === false || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n\t\traycaster.setFromCamera( pointer, this.camera );\n\n\t\tvar planeIntersect = intersectObjectWithRay( _plane, raycaster, true );\n\n\t\tif ( ! planeIntersect ) return;\n\n\t\tpointEnd.copy( planeIntersect.point ).sub( worldPositionStart );\n\n\t\tif ( mode === 'translate' ) {\n\n\t\t\t// Apply translate\n\n\t\t\toffset.copy( pointEnd ).sub( pointStart );\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\toffset.applyQuaternion( worldQuaternionInv );\n\n\t\t\t}\n\n\t\t\tif ( axis.indexOf( 'X' ) === - 1 ) offset.x = 0;\n\t\t\tif ( axis.indexOf( 'Y' ) === - 1 ) offset.y = 0;\n\t\t\tif ( axis.indexOf( 'Z' ) === - 1 ) offset.z = 0;\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\toffset.applyQuaternion( quaternionStart ).divide( parentScale );\n\n\t\t\t} else {\n\n\t\t\t\toffset.applyQuaternion( parentQuaternionInv ).divide( parentScale );\n\n\t\t\t}\n\n\t\t\tobject.position.copy( offset ).add( positionStart );\n\n\t\t\t// Apply translation snap\n\n\t\t\tif ( this.translationSnap ) {\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\tobject.position.applyQuaternion( _tempQuaternion.copy( quaternionStart ).inverse() );\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.position.applyQuaternion( quaternionStart );\n\n\t\t\t\t}\n\n\t\t\t\tif ( space === 'world' ) {\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( mode === 'scale' ) {\n\n\t\t\tif ( axis.search( 'XYZ' ) !== - 1 ) {\n\n\t\t\t\tvar d = pointEnd.length() / pointStart.length();\n\n\t\t\t\tif ( pointEnd.dot( pointStart ) < 0 ) d *= - 1;\n\n\t\t\t\t_tempVector2.set( d, d, d );\n\n\t\t\t} else {\n\n\t\t\t\t_tempVector.copy( pointStart );\n\t\t\t\t_tempVector2.copy( pointEnd );\n\n\t\t\t\t_tempVector.applyQuaternion( worldQuaternionInv );\n\t\t\t\t_tempVector2.applyQuaternion( worldQuaternionInv );\n\n\t\t\t\t_tempVector2.divide( _tempVector );\n\n\t\t\t\tif ( axis.search( 'X' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.x = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.y = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.z = 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Apply scale\n\n\t\t\tobject.scale.copy( scaleStart ).multiply( _tempVector2 );\n\n\t\t\tif ( this.scaleSnap ) {\n\n\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.x = Math.round( object.scale.x / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.y = Math.round( object.scale.y / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.z = Math.round( object.scale.z / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( mode === 'rotate' ) {\n\n\t\t\toffset.copy( pointEnd ).sub( pointStart );\n\n\t\t\tvar ROTATION_SPEED = 20 / worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n\t\t\tif ( axis === 'E' ) {\n\n\t\t\t\trotationAxis.copy( eye );\n\t\t\t\trotationAngle = pointEnd.angleTo( pointStart );\n\n\t\t\t\tstartNorm.copy( pointStart ).normalize();\n\t\t\t\tendNorm.copy( pointEnd ).normalize();\n\n\t\t\t\trotationAngle *= ( endNorm.cross( startNorm ).dot( eye ) < 0 ? 1 : - 1 );\n\n\t\t\t} else if ( axis === 'XYZE' ) {\n\n\t\t\t\trotationAxis.copy( offset ).cross( eye ).normalize();\n\t\t\t\trotationAngle = offset.dot( _tempVector.copy( rotationAxis ).cross( this.eye ) ) * ROTATION_SPEED;\n\n\t\t\t} else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n\t\t\t\trotationAxis.copy( _unit[ axis ] );\n\n\t\t\t\t_tempVector.copy( _unit[ axis ] );\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\t_tempVector.applyQuaternion( worldQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\trotationAngle = offset.dot( _tempVector.cross( eye ).normalize() ) * ROTATION_SPEED;\n\n\t\t\t}\n\n\t\t\t// Apply rotation snap\n\n\t\t\tif ( this.rotationSnap ) rotationAngle = Math.round( rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n\t\t\tthis.rotationAngle = rotationAngle;\n\n\t\t\t// Apply rotate\n\t\t\tif ( space === 'local' && axis !== 'E' && axis !== 'XYZE' ) {\n\n\t\t\t\tobject.quaternion.copy( quaternionStart );\n\t\t\t\tobject.quaternion.multiply( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) ).normalize();\n\n\t\t\t} else {\n\n\t\t\t\trotationAxis.applyQuaternion( parentQuaternionInv );\n\t\t\t\tobject.quaternion.copy( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n\t\t\t\tobject.quaternion.multiply( quaternionStart ).normalize();\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.dispatchEvent( changeEvent );\n\t\tthis.dispatchEvent( objectChangeEvent );\n\n\t};\n\n\tthis.pointerUp = function ( pointer ) {\n\n\t\tif ( pointer.button !== undefined && pointer.button !== 0 ) return;\n\n\t\tif ( this.dragging && ( this.axis !== null ) ) {\n\n\t\t\tmouseUpEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( mouseUpEvent );\n\n\t\t}\n\n\t\tthis.dragging = false;\n\n\t\tif ( pointer.button === undefined ) this.axis = null;\n\n\t};\n\n\t// normalize mouse / touch pointer and remap {x,y} to view space.\n\n\tfunction getPointer( event ) {\n\n\t\tif ( scope.domElement.ownerDocument.pointerLockElement ) {\n\n\t\t\treturn {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tbutton: event.button\n\t\t\t};\n\n\t\t} else {\n\n\t\t\tvar pointer = event.changedTouches ? event.changedTouches[ 0 ] : event;\n\n\t\t\tvar rect = domElement.getBoundingClientRect();\n\n\t\t\treturn {\n\t\t\t\tx: ( pointer.clientX - rect.left ) / rect.width * 2 - 1,\n\t\t\t\ty: - ( pointer.clientY - rect.top ) / rect.height * 2 + 1,\n\t\t\t\tbutton: event.button\n\t\t\t};\n\n\t\t}\n\n\t}\n\n\t// mouse / touch event handlers\n\n\tfunction onPointerHover( event ) {\n\n\t\tif ( ! scope.enabled ) return;\n\n\t\tscope.pointerHover( getPointer( event ) );\n\n\t}\n\n\tfunction onPointerDown( event ) {\n\n\t\tif ( ! scope.enabled ) return;\n\n\t\tscope.domElement.ownerDocument.addEventListener( \"mousemove\", onPointerMove, false );\n\n\t\tscope.pointerHover( getPointer( event ) );\n\t\tscope.pointerDown( getPointer( event ) );\n\n\t}\n\n\tfunction onPointerMove( event ) {\n\n\t\tif ( ! scope.enabled ) return;\n\n\t\tscope.pointerMove( getPointer( event ) );\n\n\t}\n\n\tfunction onPointerUp( event ) {\n\n\t\tif ( ! scope.enabled ) return;\n\n\t\tscope.domElement.ownerDocument.removeEventListener( \"mousemove\", onPointerMove, false );\n\n\t\tscope.pointerUp( getPointer( event ) );\n\n\t}\n\n\t// TODO: deprecate\n\n\tthis.getMode = function () {\n\n\t\treturn scope.mode;\n\n\t};\n\n\tthis.setMode = function ( mode ) {\n\n\t\tscope.mode = mode;\n\n\t};\n\n\tthis.setTranslationSnap = function ( translationSnap ) {\n\n\t\tscope.translationSnap = translationSnap;\n\n\t};\n\n\tthis.setRotationSnap = function ( rotationSnap ) {\n\n\t\tscope.rotationSnap = rotationSnap;\n\n\t};\n\n\tthis.setScaleSnap = function ( scaleSnap ) {\n\n\t\tscope.scaleSnap = scaleSnap;\n\n\t};\n\n\tthis.setSize = function ( size ) {\n\n\t\tscope.size = size;\n\n\t};\n\n\tthis.setSpace = function ( space ) {\n\n\t\tscope.space = space;\n\n\t};\n\n\tthis.update = function () {\n\n\t\tconsole.warn( 'THREE.TransformControls: update function has no more functionality and therefore has been deprecated.' );\n\n\t};\n\n};\n\nTransformControls.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: TransformControls,\n\n\tisTransformControls: true\n\n} );\n\n\nvar TransformControlsGizmo = function () {\n\n\t'use strict';\n\n\tObject3D.call( this );\n\n\tthis.type = 'TransformControlsGizmo';\n\n\t// shared materials\n\n\tvar gizmoMaterial = new MeshBasicMaterial( {\n\t\tdepthTest: false,\n\t\tdepthWrite: false,\n\t\ttransparent: true,\n\t\tside: DoubleSide,\n\t\tfog: false,\n\t\ttoneMapped: false\n\t} );\n\n\tvar gizmoLineMaterial = new LineBasicMaterial( {\n\t\tdepthTest: false,\n\t\tdepthWrite: false,\n\t\ttransparent: true,\n\t\tlinewidth: 1,\n\t\tfog: false,\n\t\ttoneMapped: false\n\t} );\n\n\t// Make unique material for each axis/color\n\n\tvar matInvisible = gizmoMaterial.clone();\n\tmatInvisible.opacity = 0.15;\n\n\tvar matHelper = gizmoMaterial.clone();\n\tmatHelper.opacity = 0.33;\n\n\tvar matRed = gizmoMaterial.clone();\n\tmatRed.color.set( 0xff0000 );\n\n\tvar matGreen = gizmoMaterial.clone();\n\tmatGreen.color.set( 0x00ff00 );\n\n\tvar matBlue = gizmoMaterial.clone();\n\tmatBlue.color.set( 0x0000ff );\n\n\tvar matWhiteTransparent = gizmoMaterial.clone();\n\tmatWhiteTransparent.opacity = 0.25;\n\n\tvar matYellowTransparent = matWhiteTransparent.clone();\n\tmatYellowTransparent.color.set( 0xffff00 );\n\n\tvar matCyanTransparent = matWhiteTransparent.clone();\n\tmatCyanTransparent.color.set( 0x00ffff );\n\n\tvar matMagentaTransparent = matWhiteTransparent.clone();\n\tmatMagentaTransparent.color.set( 0xff00ff );\n\n\tvar matYellow = gizmoMaterial.clone();\n\tmatYellow.color.set( 0xffff00 );\n\n\tvar matLineRed = gizmoLineMaterial.clone();\n\tmatLineRed.color.set( 0xff0000 );\n\n\tvar matLineGreen = gizmoLineMaterial.clone();\n\tmatLineGreen.color.set( 0x00ff00 );\n\n\tvar matLineBlue = gizmoLineMaterial.clone();\n\tmatLineBlue.color.set( 0x0000ff );\n\n\tvar matLineCyan = gizmoLineMaterial.clone();\n\tmatLineCyan.color.set( 0x00ffff );\n\n\tvar matLineMagenta = gizmoLineMaterial.clone();\n\tmatLineMagenta.color.set( 0xff00ff );\n\n\tvar matLineYellow = gizmoLineMaterial.clone();\n\tmatLineYellow.color.set( 0xffff00 );\n\n\tvar matLineGray = gizmoLineMaterial.clone();\n\tmatLineGray.color.set( 0x787878 );\n\n\tvar matLineYellowTransparent = matLineYellow.clone();\n\tmatLineYellowTransparent.opacity = 0.25;\n\n\t// reusable geometry\n\n\tvar arrowGeometry = new CylinderBufferGeometry( 0, 0.05, 0.2, 12, 1, false );\n\n\tvar scaleHandleGeometry = new BoxBufferGeometry( 0.125, 0.125, 0.125 );\n\n\tvar lineGeometry = new BufferGeometry();\n\tlineGeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n\tvar CircleGeometry = function ( radius, arc ) {\n\n\t\tvar geometry = new BufferGeometry( );\n\t\tvar vertices = [];\n\n\t\tfor ( var i = 0; i <= 64 * arc; ++ i ) {\n\n\t\t\tvertices.push( 0, Math.cos( i / 32 * Math.PI ) * radius, Math.sin( i / 32 * Math.PI ) * radius );\n\n\t\t}\n\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\n\t\treturn geometry;\n\n\t};\n\n\t// Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\tvar TranslateHelperGeometry = function () {\n\n\t\tvar geometry = new BufferGeometry();\n\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n\t\treturn geometry;\n\n\t};\n\n\t// Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\tvar gizmoTranslate = {\n\t\tX: [\n\t\t\t[ new Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, - Math.PI / 2 ], null, 'fwd' ],\n\t\t\t[ new Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, Math.PI / 2 ], null, 'bwd' ],\n\t\t\t[ new Line( lineGeometry, matLineRed ) ]\n\t\t],\n\t\tY: [\n\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], null, null, 'fwd' ],\n\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], [ Math.PI, 0, 0 ], null, 'bwd' ],\n\t\t\t[ new Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ]]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ Math.PI / 2, 0, 0 ], null, 'fwd' ],\n\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ - Math.PI / 2, 0, 0 ], null, 'bwd' ],\n\t\t\t[ new Line( lineGeometry, matLineBlue ), null, [ 0, - Math.PI / 2, 0 ]]\n\t\t],\n\t\tXYZ: [\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.1, 0 ), matWhiteTransparent.clone() ), [ 0, 0, 0 ], [ 0, 0, 0 ]]\n\t\t],\n\t\tXY: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.295, 0.295 ), matYellowTransparent.clone() ), [ 0.15, 0.15, 0 ]],\n\t\t\t[ new Line( lineGeometry, matLineYellow ), [ 0.18, 0.3, 0 ], null, [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineYellow ), [ 0.3, 0.18, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ]]\n\t\t],\n\t\tYZ: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.295, 0.295 ), matCyanTransparent.clone() ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]],\n\t\t\t[ new Line( lineGeometry, matLineCyan ), [ 0, 0.18, 0.3 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineCyan ), [ 0, 0.3, 0.18 ], [ 0, - Math.PI / 2, 0 ], [ 0.125, 1, 1 ]]\n\t\t],\n\t\tXZ: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.295, 0.295 ), matMagentaTransparent.clone() ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]],\n\t\t\t[ new Line( lineGeometry, matLineMagenta ), [ 0.18, 0, 0.3 ], null, [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineMagenta ), [ 0.3, 0, 0.18 ], [ 0, - Math.PI / 2, 0 ], [ 0.125, 1, 1 ]]\n\t\t]\n\t};\n\n\tvar pickerTranslate = {\n\t\tX: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0.6, 0, 0 ], [ 0, 0, - Math.PI / 2 ]]\n\t\t],\n\t\tY: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0.6, 0 ]]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0, 0.6 ], [ Math.PI / 2, 0, 0 ]]\n\t\t],\n\t\tXYZ: [\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.2, 0 ), matInvisible ) ]\n\t\t],\n\t\tXY: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0.2, 0 ]]\n\t\t],\n\t\tYZ: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0, 0.2, 0.2 ], [ 0, Math.PI / 2, 0 ]]\n\t\t],\n\t\tXZ: [\n\t\t\t[ new Mesh( new PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0, 0.2 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t]\n\t};\n\n\tvar helperTranslate = {\n\t\tSTART: [\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t],\n\t\tEND: [\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t],\n\t\tDELTA: [\n\t\t\t[ new Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n\t\t],\n\t\tX: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t],\n\t\tY: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t]\n\t};\n\n\tvar gizmoRotate = {\n\t\tX: [\n\t\t\t[ new Line( CircleGeometry( 1, 0.5 ), matLineRed ) ],\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), matRed ), [ 0, 0, 0.99 ], null, [ 1, 3, 1 ]],\n\t\t],\n\t\tY: [\n\t\t\t[ new Line( CircleGeometry( 1, 0.5 ), matLineGreen ), null, [ 0, 0, - Math.PI / 2 ]],\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), matGreen ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ]],\n\t\t],\n\t\tZ: [\n\t\t\t[ new Line( CircleGeometry( 1, 0.5 ), matLineBlue ), null, [ 0, Math.PI / 2, 0 ]],\n\t\t\t[ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), matBlue ), [ 0.99, 0, 0 ], null, [ 1, 3, 1 ]],\n\t\t],\n\t\tE: [\n\t\t\t[ new Line( CircleGeometry( 1.25, 1 ), matLineYellowTransparent ), null, [ 0, Math.PI / 2, 0 ]],\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 1.17, 0, 0 ], [ 0, 0, - Math.PI / 2 ], [ 1, 1, 0.001 ]],\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ - 1.17, 0, 0 ], [ 0, 0, Math.PI / 2 ], [ 1, 1, 0.001 ]],\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, - 1.17, 0 ], [ Math.PI, 0, 0 ], [ 1, 1, 0.001 ]],\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, 1.17, 0 ], [ 0, 0, 0 ], [ 1, 1, 0.001 ]],\n\t\t],\n\t\tXYZE: [\n\t\t\t[ new Line( CircleGeometry( 1, 1 ), matLineGray ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t]\n\t};\n\n\tvar helperRotate = {\n\t\tAXIS: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t]\n\t};\n\n\tvar pickerRotate = {\n\t\tX: [\n\t\t\t[ new Mesh( new TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, - Math.PI / 2, - Math.PI / 2 ]],\n\t\t],\n\t\tY: [\n\t\t\t[ new Mesh( new TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ]],\n\t\t],\n\t\tZ: [\n\t\t\t[ new Mesh( new TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t],\n\t\tE: [\n\t\t\t[ new Mesh( new TorusBufferGeometry( 1.25, 0.1, 2, 24 ), matInvisible ) ]\n\t\t],\n\t\tXYZE: [\n\t\t\t[ new Mesh( new SphereBufferGeometry( 0.7, 10, 8 ), matInvisible ) ]\n\t\t]\n\t};\n\n\tvar gizmoScale = {\n\t\tX: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matRed ), [ 0.8, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t[ new Line( lineGeometry, matLineRed ), null, null, [ 0.8, 1, 1 ]]\n\t\t],\n\t\tY: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.8, 0 ]],\n\t\t\t[ new Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ], [ 0.8, 1, 1 ]]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.8 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t[ new Line( lineGeometry, matLineBlue ), null, [ 0, - Math.PI / 2, 0 ], [ 0.8, 1, 1 ]]\n\t\t],\n\t\tXY: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matYellowTransparent ), [ 0.85, 0.85, 0 ], null, [ 2, 2, 0.2 ]],\n\t\t\t[ new Line( lineGeometry, matLineYellow ), [ 0.855, 0.98, 0 ], null, [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineYellow ), [ 0.98, 0.855, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ]]\n\t\t],\n\t\tYZ: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matCyanTransparent ), [ 0, 0.85, 0.85 ], null, [ 0.2, 2, 2 ]],\n\t\t\t[ new Line( lineGeometry, matLineCyan ), [ 0, 0.855, 0.98 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineCyan ), [ 0, 0.98, 0.855 ], [ 0, - Math.PI / 2, 0 ], [ 0.125, 1, 1 ]]\n\t\t],\n\t\tXZ: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matMagentaTransparent ), [ 0.85, 0, 0.85 ], null, [ 2, 0.2, 2 ]],\n\t\t\t[ new Line( lineGeometry, matLineMagenta ), [ 0.855, 0, 0.98 ], null, [ 0.125, 1, 1 ]],\n\t\t\t[ new Line( lineGeometry, matLineMagenta ), [ 0.98, 0, 0.855 ], [ 0, - Math.PI / 2, 0 ], [ 0.125, 1, 1 ]]\n\t\t],\n\t\tXYZX: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransparent.clone() ), [ 1.1, 0, 0 ]],\n\t\t],\n\t\tXYZY: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransparent.clone() ), [ 0, 1.1, 0 ]],\n\t\t],\n\t\tXYZZ: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransparent.clone() ), [ 0, 0, 1.1 ]],\n\t\t]\n\t};\n\n\tvar pickerScale = {\n\t\tX: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0.5, 0, 0 ], [ 0, 0, - Math.PI / 2 ]]\n\t\t],\n\t\tY: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0.5, 0 ]]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Mesh( new CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ]]\n\t\t],\n\t\tXY: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0.85, 0 ], null, [ 3, 3, 0.2 ]],\n\t\t],\n\t\tYZ: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matInvisible ), [ 0, 0.85, 0.85 ], null, [ 0.2, 3, 3 ]],\n\t\t],\n\t\tXZ: [\n\t\t\t[ new Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0, 0.85 ], null, [ 3, 0.2, 3 ]],\n\t\t],\n\t\tXYZX: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 1.1, 0, 0 ]],\n\t\t],\n\t\tXYZY: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 1.1, 0 ]],\n\t\t],\n\t\tXYZZ: [\n\t\t\t[ new Mesh( new BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 1.1 ]],\n\t\t]\n\t};\n\n\tvar helperScale = {\n\t\tX: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t],\n\t\tY: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t],\n\t\tZ: [\n\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t]\n\t};\n\n\t// Creates an Object3D with gizmos described in custom hierarchy definition.\n\n\tvar setupGizmo = function ( gizmoMap ) {\n\n\t\tvar gizmo = new Object3D();\n\n\t\tfor ( var name in gizmoMap ) {\n\n\t\t\tfor ( var i = gizmoMap[ name ].length; i --; ) {\n\n\t\t\t\tvar object = gizmoMap[ name ][ i ][ 0 ].clone();\n\t\t\t\tvar position = gizmoMap[ name ][ i ][ 1 ];\n\t\t\t\tvar rotation = gizmoMap[ name ][ i ][ 2 ];\n\t\t\t\tvar scale = gizmoMap[ name ][ i ][ 3 ];\n\t\t\t\tvar tag = gizmoMap[ name ][ i ][ 4 ];\n\n\t\t\t\t// name and tag properties are essential for picking and updating logic.\n\t\t\t\tobject.name = name;\n\t\t\t\tobject.tag = tag;\n\n\t\t\t\tif ( position ) {\n\n\t\t\t\t\tobject.position.set( position[ 0 ], position[ 1 ], position[ 2 ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( rotation ) {\n\n\t\t\t\t\tobject.rotation.set( rotation[ 0 ], rotation[ 1 ], rotation[ 2 ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scale ) {\n\n\t\t\t\t\tobject.scale.set( scale[ 0 ], scale[ 1 ], scale[ 2 ] );\n\n\t\t\t\t}\n\n\t\t\t\tobject.updateMatrix();\n\n\t\t\t\tvar tempGeometry = object.geometry.clone();\n\t\t\t\ttempGeometry.applyMatrix4( object.matrix );\n\t\t\t\tobject.geometry = tempGeometry;\n\t\t\t\tobject.renderOrder = Infinity;\n\n\t\t\t\tobject.position.set( 0, 0, 0 );\n\t\t\t\tobject.rotation.set( 0, 0, 0 );\n\t\t\t\tobject.scale.set( 1, 1, 1 );\n\n\t\t\t\tgizmo.add( object );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn gizmo;\n\n\t};\n\n\t// Reusable utility variables\n\n\tvar tempVector = new Vector3( 0, 0, 0 );\n\tvar tempEuler = new Euler();\n\tvar alignVector = new Vector3( 0, 1, 0 );\n\tvar zeroVector = new Vector3( 0, 0, 0 );\n\tvar lookAtMatrix = new Matrix4();\n\tvar tempQuaternion = new Quaternion();\n\tvar tempQuaternion2 = new Quaternion();\n\tvar identityQuaternion = new Quaternion();\n\n\tvar unitX = new Vector3( 1, 0, 0 );\n\tvar unitY = new Vector3( 0, 1, 0 );\n\tvar unitZ = new Vector3( 0, 0, 1 );\n\n\t// Gizmo creation\n\n\tthis.gizmo = {};\n\tthis.picker = {};\n\tthis.helper = {};\n\n\tthis.add( this.gizmo[ \"translate\" ] = setupGizmo( gizmoTranslate ) );\n\tthis.add( this.gizmo[ \"rotate\" ] = setupGizmo( gizmoRotate ) );\n\tthis.add( this.gizmo[ \"scale\" ] = setupGizmo( gizmoScale ) );\n\tthis.add( this.picker[ \"translate\" ] = setupGizmo( pickerTranslate ) );\n\tthis.add( this.picker[ \"rotate\" ] = setupGizmo( pickerRotate ) );\n\tthis.add( this.picker[ \"scale\" ] = setupGizmo( pickerScale ) );\n\tthis.add( this.helper[ \"translate\" ] = setupGizmo( helperTranslate ) );\n\tthis.add( this.helper[ \"rotate\" ] = setupGizmo( helperRotate ) );\n\tthis.add( this.helper[ \"scale\" ] = setupGizmo( helperScale ) );\n\n\t// Pickers should be hidden always\n\n\tthis.picker[ \"translate\" ].visible = false;\n\tthis.picker[ \"rotate\" ].visible = false;\n\tthis.picker[ \"scale\" ].visible = false;\n\n\t// updateMatrixWorld will update transformations and appearance of individual handles\n\n\tthis.updateMatrixWorld = function () {\n\n\t\tvar space = this.space;\n\n\t\tif ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n\t\tvar quaternion = space === \"local\" ? this.worldQuaternion : identityQuaternion;\n\n\t\t// Show only gizmos for current transform mode\n\n\t\tthis.gizmo[ \"translate\" ].visible = this.mode === \"translate\";\n\t\tthis.gizmo[ \"rotate\" ].visible = this.mode === \"rotate\";\n\t\tthis.gizmo[ \"scale\" ].visible = this.mode === \"scale\";\n\n\t\tthis.helper[ \"translate\" ].visible = this.mode === \"translate\";\n\t\tthis.helper[ \"rotate\" ].visible = this.mode === \"rotate\";\n\t\tthis.helper[ \"scale\" ].visible = this.mode === \"scale\";\n\n\n\t\tvar handles = [];\n\t\thandles = handles.concat( this.picker[ this.mode ].children );\n\t\thandles = handles.concat( this.gizmo[ this.mode ].children );\n\t\thandles = handles.concat( this.helper[ this.mode ].children );\n\n\t\tfor ( var i = 0; i < handles.length; i ++ ) {\n\n\t\t\tvar handle = handles[ i ];\n\n\t\t\t// hide aligned to camera\n\n\t\t\thandle.visible = true;\n\t\t\thandle.rotation.set( 0, 0, 0 );\n\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\tvar factor;\n\n\t\t\tif ( this.camera.isOrthographicCamera ) {\n\n\t\t\t\tfactor = ( this.camera.top - this.camera.bottom ) / this.camera.zoom;\n\n\t\t\t} else {\n\n\t\t\t\tfactor = this.worldPosition.distanceTo( this.cameraPosition ) * Math.min( 1.9 * Math.tan( Math.PI * this.camera.fov / 360 ) / this.camera.zoom, 7 );\n\n\t\t\t}\n\n\t\t\thandle.scale.set( 1, 1, 1 ).multiplyScalar( factor * this.size / 7 );\n\n\t\t\t// TODO: simplify helpers and consider decoupling from gizmo\n\n\t\t\tif ( handle.tag === 'helper' ) {\n\n\t\t\t\thandle.visible = false;\n\n\t\t\t\tif ( handle.name === 'AXIS' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.visible = !! this.axis;\n\n\t\t\t\t\tif ( this.axis === 'X' ) {\n\n\t\t\t\t\t\ttempQuaternion.setFromEuler( tempEuler.set( 0, 0, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Y' ) {\n\n\t\t\t\t\t\ttempQuaternion.setFromEuler( tempEuler.set( 0, 0, Math.PI / 2 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Z' ) {\n\n\t\t\t\t\t\ttempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'XYZE' ) {\n\n\t\t\t\t\t\ttempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\talignVector.copy( this.rotationAxis );\n\t\t\t\t\t\thandle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( zeroVector, alignVector, unitY ) );\n\t\t\t\t\t\thandle.quaternion.multiply( tempQuaternion );\n\t\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'E' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t} else if ( handle.name === 'START' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'END' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPosition );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'DELTA' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.quaternion.copy( this.worldQuaternionStart );\n\t\t\t\t\ttempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( - 1 );\n\t\t\t\t\ttempVector.applyQuaternion( this.worldQuaternionStart.clone().inverse() );\n\t\t\t\t\thandle.scale.copy( tempVector );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else {\n\n\t\t\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\t\t\tif ( this.dragging ) {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis ) {\n\n\t\t\t\t\t\thandle.visible = this.axis.search( handle.name ) !== - 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// If updating helper, skip rest of the loop\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\t// Align handles to current local or world rotation\n\n\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\tif ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n\t\t\t\t// Hide translate and scale axis facing the camera\n\n\t\t\t\tvar AXIS_HIDE_TRESHOLD = 0.99;\n\t\t\t\tvar PLANE_HIDE_TRESHOLD = 0.2;\n\t\t\t\tvar AXIS_FLIP_TRESHOLD = 0.0;\n\n\n\t\t\t\tif ( handle.name === 'X' || handle.name === 'XYZX' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' || handle.name === 'XYZY' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' || handle.name === 'XYZZ' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XY' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'YZ' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XZ' ) {\n\n\t\t\t\t\tif ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Flip translate and scale axis ocluded behind another axis\n\n\t\t\t\tif ( handle.name.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\tif ( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n\n\t\t\t\t\t\tif ( handle.tag === 'fwd' ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\thandle.scale.x *= - 1;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( handle.tag === 'bwd' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\tif ( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n\n\t\t\t\t\t\tif ( handle.tag === 'fwd' ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\thandle.scale.y *= - 1;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( handle.tag === 'bwd' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\tif ( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n\n\t\t\t\t\t\tif ( handle.tag === 'fwd' ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\thandle.scale.z *= - 1;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( handle.tag === 'bwd' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( this.mode === 'rotate' ) {\n\n\t\t\t\t// Align handles to current local or world rotation\n\n\t\t\t\ttempQuaternion2.copy( quaternion );\n\t\t\t\talignVector.copy( this.eye ).applyQuaternion( tempQuaternion.copy( quaternion ).inverse() );\n\n\t\t\t\tif ( handle.name.search( \"E\" ) !== - 1 ) {\n\n\t\t\t\t\thandle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( this.eye, zeroVector, unitY ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'X' ) {\n\n\t\t\t\t\ttempQuaternion.setFromAxisAngle( unitX, Math.atan2( - alignVector.y, alignVector.z ) );\n\t\t\t\t\ttempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' ) {\n\n\t\t\t\t\ttempQuaternion.setFromAxisAngle( unitY, Math.atan2( alignVector.x, alignVector.z ) );\n\t\t\t\t\ttempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' ) {\n\n\t\t\t\t\ttempQuaternion.setFromAxisAngle( unitZ, Math.atan2( alignVector.y, alignVector.x ) );\n\t\t\t\t\ttempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Hide disabled axes\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( \"X\" ) === - 1 || this.showX );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( \"Y\" ) === - 1 || this.showY );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( \"Z\" ) === - 1 || this.showZ );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( \"E\" ) === - 1 || ( this.showX && this.showY && this.showZ ) );\n\n\t\t\t// highlight selected axis\n\n\t\t\thandle.material._opacity = handle.material._opacity || handle.material.opacity;\n\t\t\thandle.material._color = handle.material._color || handle.material.color.clone();\n\n\t\t\thandle.material.color.copy( handle.material._color );\n\t\t\thandle.material.opacity = handle.material._opacity;\n\n\t\t\tif ( ! this.enabled ) {\n\n\t\t\t\thandle.material.opacity *= 0.5;\n\t\t\t\thandle.material.color.lerp( new Color( 1, 1, 1 ), 0.5 );\n\n\t\t\t} else if ( this.axis ) {\n\n\t\t\t\tif ( handle.name === this.axis ) {\n\n\t\t\t\t\thandle.material.opacity = 1.0;\n\t\t\t\t\thandle.material.color.lerp( new Color( 1, 1, 1 ), 0.5 );\n\n\t\t\t\t} else if ( this.axis.split( '' ).some( function ( a ) {\n\n\t\t\t\t\treturn handle.name === a;\n\n\t\t\t\t} ) ) {\n\n\t\t\t\t\thandle.material.opacity = 1.0;\n\t\t\t\t\thandle.material.color.lerp( new Color( 1, 1, 1 ), 0.5 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\thandle.material.opacity *= 0.25;\n\t\t\t\t\thandle.material.color.lerp( new Color( 1, 1, 1 ), 0.5 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tObject3D.prototype.updateMatrixWorld.call( this );\n\n\t};\n\n};\n\nTransformControlsGizmo.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: TransformControlsGizmo,\n\n\tisTransformControlsGizmo: true\n\n} );\n\n\nvar TransformControlsPlane = function () {\n\n\t'use strict';\n\n\tMesh.call( this,\n\t\tnew PlaneBufferGeometry( 100000, 100000, 2, 2 ),\n\t\tnew MeshBasicMaterial( { visible: false, wireframe: true, side: DoubleSide, transparent: true, opacity: 0.1, toneMapped: false } )\n\t);\n\n\tthis.type = 'TransformControlsPlane';\n\n\tvar unitX = new Vector3( 1, 0, 0 );\n\tvar unitY = new Vector3( 0, 1, 0 );\n\tvar unitZ = new Vector3( 0, 0, 1 );\n\n\tvar tempVector = new Vector3();\n\tvar dirVector = new Vector3();\n\tvar alignVector = new Vector3();\n\tvar tempMatrix = new Matrix4();\n\tvar identityQuaternion = new Quaternion();\n\n\tthis.updateMatrixWorld = function () {\n\n\t\tvar space = this.space;\n\n\t\tthis.position.copy( this.worldPosition );\n\n\t\tif ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n\t\tunitX.set( 1, 0, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\t\tunitY.set( 0, 1, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\t\tunitZ.set( 0, 0, 1 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\n\t\t// Align the plane for current transform mode, axis and space.\n\n\t\talignVector.copy( unitY );\n\n\t\tswitch ( this.mode ) {\n\n\t\t\tcase 'translate':\n\t\t\tcase 'scale':\n\t\t\t\tswitch ( this.axis ) {\n\n\t\t\t\t\tcase 'X':\n\t\t\t\t\t\talignVector.copy( this.eye ).cross( unitX );\n\t\t\t\t\t\tdirVector.copy( unitX ).cross( alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Y':\n\t\t\t\t\t\talignVector.copy( this.eye ).cross( unitY );\n\t\t\t\t\t\tdirVector.copy( unitY ).cross( alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Z':\n\t\t\t\t\t\talignVector.copy( this.eye ).cross( unitZ );\n\t\t\t\t\t\tdirVector.copy( unitZ ).cross( alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XY':\n\t\t\t\t\t\tdirVector.copy( unitZ );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'YZ':\n\t\t\t\t\t\tdirVector.copy( unitX );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XZ':\n\t\t\t\t\t\talignVector.copy( unitZ );\n\t\t\t\t\t\tdirVector.copy( unitY );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XYZ':\n\t\t\t\t\tcase 'E':\n\t\t\t\t\t\tdirVector.set( 0, 0, 0 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'rotate':\n\t\t\tdefault:\n\t\t\t\t// special case for rotate\n\t\t\t\tdirVector.set( 0, 0, 0 );\n\n\t\t}\n\n\t\tif ( dirVector.length() === 0 ) {\n\n\t\t\t// If in rotate mode, make the plane parallel to camera\n\t\t\tthis.quaternion.copy( this.cameraQuaternion );\n\n\t\t} else {\n\n\t\t\ttempMatrix.lookAt( tempVector.set( 0, 0, 0 ), dirVector, alignVector );\n\n\t\t\tthis.quaternion.setFromRotationMatrix( tempMatrix );\n\n\t\t}\n\n\t\tObject3D.prototype.updateMatrixWorld.call( this );\n\n\t};\n\n};\n\nTransformControlsPlane.prototype = Object.assign( Object.create( Mesh.prototype ), {\n\n\tconstructor: TransformControlsPlane,\n\n\tisTransformControlsPlane: true\n\n} );\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };\n"]},"metadata":{},"sourceType":"module"}